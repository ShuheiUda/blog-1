<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2023-05-13T23:48:49.317Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Verified ID と Identity Governance の統合 - より正確なアクセス権の付与と迅速なオンボーディング</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/identity-govenance-with-verified-id/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/identity-govenance-with-verified-id/</id>
    <published>2023-05-14T00:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.317Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure ID チームの小出です。</p><p>本記事は、2023 年 4 月 7 日に公開されました  <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/entra-identity-governance-with-entra-verified-id-higher-fidelity/ba-p/2466934">Entra Identity Governance with Entra Verified ID – Higher Fidelity Access Rights + Faster Onboarding</a> の記事を日本語に意訳した内容になります。ご不明点などございましたらお気軽にサポートまでお問い合わせください。</p><hr><p>この度、Entra Identity Governance エンタイトルメント管理と、先日ご紹介した Microsoft Entra Verified ID の統合を発表できることを嬉しく思います！</p><p>従業員、請負業者、パートナー、その他のビジネス ゲストを含む新しいユーザーをオンボードするために何が必要かを考えてみると、多くの場合、ID 情報や資格情報の確認が必要となります。このプロセスは面倒で時間がかかり、ユーザーは冗長なオンライン フォームに記入したり事務作業をしたりする必要があるため、最終的に採用スケジュールや立ち上げ期間に遅れが生じることになります。</p><p>この負担を緩和するために、弊社では以前、<a href="https://jpazureid.github.io/blog/azure-active-directory/onboard-partners-more-easily-with-new-azure-ad-entitlement/">新しい Azure AD エンタイトルメント管理機能でパートナー (外部ユーザー) との連携をより簡単に</a> の記事で案内したようにカスタム質問と属性収集の機能を導入しました。エンタイトルメント管理における Microsoft Entra Verified ID のチェック機能の統合により、このオンボーディング処理がさらに簡単になりました。</p><p>この新機能の詳細を以下にご紹介しますので、アクセス要求の管理の流れにおいてどのように本機能が作用するかをご覧いただければ幸いです。 </p><h2 id="シナリオ-独自に検証された資格情報を要求して機密リソースへのアクセスを承認する"><a href="#シナリオ-独自に検証された資格情報を要求して機密リソースへのアクセスを承認する" class="headerlink" title="シナリオ: 独自に検証された資格情報を要求して機密リソースへのアクセスを承認する"></a>シナリオ: 独自に検証された資格情報を要求して機密リソースへのアクセスを承認する</h2><p>新規顧客のプロジェクトで、外部のマーケティング会社と協力しているとします。あなたの組織は、コンサルタントが新しいプロジェクトに参加する前に、ベンダーとしての認定を取得する必要があります。このため、コンサルタントは、オンボーディングの手続きを開始する前に、証明書のコピーを電子メールで送信する必要があります。これでは大変不便ですし、時間もかかってしまいます。</p><p>この必要な認定ベンダーの証明書を発行する機関が、Verified ID の発行を開始したことを最近知りました。現在、あなたはプロジェクトに必要なリソースを含む <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-overview#what-are-access-packages-and-what-resources-can-i-manage-with-them">アクセス パッケージ</a>）を利用しています。このため、コンサルタントがアクセス パッケージへのアクセスを要求する際に、すでにあるオンボーディング プロセスに Verified ID のチェックを組み込むことにしました。</p><p>その方法は次のとおりです。</p><h2 id="わずか-3-ステップで-Verified-ID-を使用したアクセス-パッケージへの自動アクセスを設定する！"><a href="#わずか-3-ステップで-Verified-ID-を使用したアクセス-パッケージへの自動アクセスを設定する！" class="headerlink" title="わずか 3 ステップで Verified ID を使用したアクセス パッケージへの自動アクセスを設定する！"></a>わずか 3 ステップで Verified ID を使用したアクセス パッケージへの自動アクセスを設定する！</h2><ol><li><strong>検証済み ID をアクセス パッケージの要件として追加します</strong>: [Entra Identity Governance アクセス パッケージ]<a href="https://entra.microsoft.com/#view/Microsoft_AAD_ERM/DashboardBlade/~/elmEntitlement">https://entra.microsoft.com/#view/Microsoft_AAD_ERM/DashboardBlade/~/elmEntitlement</a> にアクセスして、保護したいアクセス パッケージを選択します。<strong>ポリシー</strong> セクションに行き、**+ ポリシーの追加** をクリックして新しいポリシーを追加する流れです。<strong>要求</strong> タブで、<strong>必須の確認済み ID</strong> セクションを確認します。</li></ol><p><img src="./identity-governance-with-verified-id/identity-governance-with-verified-id1.png"></p><p><strong>+ 発行者の追加</strong> をクリックします。ドロップダウンを使用して Entra Verified ID ネットワークで Contoso Supplier Agency を検索し、Verified Vendor の資格情報の種類を選択します。</p><p><img src="./identity-governance-with-verified-id/identity-governance-with-verified-id2.png"></p><ol start="2"><li><strong>手動での承認を削除する</strong>: Verified Vendor の資格情報は、信頼された発行元によるユーザー認定の証明として検証されたものであるため、承認者が手動で承認する必要はありません。これにより、オンボーディングが一層スムーズになります。</li></ol><p><img src="./identity-governance-with-verified-id/identity-governance-with-verified-id3.png"></p><p>プロジェクトに参加するコンサルタントが <a href="https://myaccess.microsoft.com/">My Access ポータル</a> からアクセス パッケージへのアクセスを要求する際、Microsoft Authenticator から Verified Vendor の資格情報の提示が求められます。</p><p><img src="./identity-governance-with-verified-id/identity-governance-with-verified-id4.png"></p><p><img src="./identity-governance-with-verified-id/identity-governance-with-verified-id5.png"></p><p>必要なのは、画面に表示された QR コードをスキャンすることだけです。これにより、資格証明書を提示することができ、アクセス パッケージ ポリシーでは承認者による手動レビューが必要ないため、発行機関により資格情報が確認されたら、コンサルタントは自動的にアクセスを得ることができます。例えば、このような感じです：</p><p><img src="./identity-governance-with-verified-id/identity-governance-with-verified-id6.png"></p><ol start="3"><li><strong>要求アクティビティについて監査ログを確認する</strong>: <a href="https://entra.microsoft.com/#view/Microsoft_AAD_ERM/DashboardBlade/~/Audit%20logs">Entra Identity Governance 監査ログ</a> に移動し、Verified ID が提示された際に、アクセス パッケージへのアクセスが許可されていることを確認できます。</li></ol><p><img src="./identity-governance-with-verified-id/identity-governance-with-verified-id7.png"></p><h2 id="お客様の声"><a href="#お客様の声" class="headerlink" title="お客様の声"></a>お客様の声</h2><p>Swiss IT はマイクロソフトのパートナーであり、ユーザーが機密データにアクセスする必要がある場合に、対面での作業により ID の証明を行っている顧客を支援する業務を行っています。Swiss IT は、必要なデジタル証明書を含む Verified ID を発行しています。この統合により、Swiss IT は、ユーザーがアクセス要求を提出する際に、そのユーザーの市民権の有無を自動的に検証することができるようになります。</p><blockquote><p>“Entra Verified ID を Entra Identity Governance に統合することで、エンタイトルメント管理のフローにおいて ID の検証や承認を自動化することができるようになります。これにより、企業の規制や契約上の義務を遵守しながら、医薬品開発のような機密性の高いデータのコラボレーション環境を安全に保つことができるようになりました。” - Jens Lorenz (Swiss IT 社 戦略コンサルタント、CISSP、CCSP、CIPT)</p></blockquote><p>同様に、一部のお客様は、強い権限を持たない生産性アプリケーションであっても、外部ユーザーのアクセスについて手動でレビュー プロセスを実施している場合も多く見られます。このようなお客様は、必要な Verified ID を提供すればゲストに自動的に権限が割り当てられるようなスコープ付きのアクセス パッケージを設定することで、組織外の人々とコラボレーションを行うことも可能となります。 </p><blockquote><p>“多くの大企業では、複数のサービス プロバイダーと連携しており、個人としてどのような人が作業に来るのかは必ずしも把握しておらず、むしろその人がどの企業に所属しているかという雇用主の方を信頼しているはずです。そのような場合、長時間の事前オンボーディングは困難です。Verified ID とエンタイトルメント管理を組み合わせることで、アクセス要求プロセスの中で本人確認を行い、すぐその場でアクセス要求を行うことができるようになりました。” - Erik Siebler（IAM リード、DXC）  </p></blockquote><h2 id="Entra-Identity-Governance-のエンタイトルメント管理でリソースへのアクセスを保護してアクセス要求のフローに-Entra-Verified-ID-を組み込みましょう！"><a href="#Entra-Identity-Governance-のエンタイトルメント管理でリソースへのアクセスを保護してアクセス要求のフローに-Entra-Verified-ID-を組み込みましょう！" class="headerlink" title="Entra Identity Governance のエンタイトルメント管理でリソースへのアクセスを保護してアクセス要求のフローに Entra Verified ID を組み込みましょう！"></a>Entra Identity Governance のエンタイトルメント管理でリソースへのアクセスを保護してアクセス要求のフローに Entra Verified ID を組み込みましょう！</h2><p>Entra Identity Governanceのエンタイトルメント管理を始めるには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-first">アクセス パッケージをセットアップする方法についてステップバイステップのガイド</a> をご覧ください。アクセス パッケージを設定したら、Verified ID を要件にしてアクセス パッケージを設定する方法について、<a href="https://learn.microsoft.com/en-us/azure/active-directory/governance/entitlement-management-verified-id-settings">このガイド</a> も参照ください。</p><p>エンタイトルメント管理の要求の流れで Verified ID を利用するには、テナントを Verified ID サービスにオンボードする必要があります。Microsoft Entra Verified ID を使用するためにテナントを設定する方法については、<a href="https://learn.microsoft.com/en-us/azure/active-directory/verifiable-credentials/verifiable-credentials-configure-tenant">このチュートリアル</a> を参照ください。</p><p>この機能を試すために、ぜひ今日からユーザーに Verified ID を発行し、Verified ID を要件とするアクセス パッケージを構成ください！</p><p>お客様のご意見をお聞かせいただき、ユーザー ID を一緒に進化させていきたいと思います！</p><p>Joseph Dadzie, Partner Director of Product Management<br>LinkedIn: <a href="https://www.linkedin.com/in/joedadzie/">@joedadzie</a><br>Twitter: <a href="https://twitter.com/joe_dadzie">@joe_dadzie</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 7 日に公開されました  &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-bl</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Identity Governance" scheme="https://jpazureid.github.io/blog/tags/Identity-Governance/"/>
    
    <category term="Verified ID" scheme="https://jpazureid.github.io/blog/tags/Verified-ID/"/>
    
  </entry>
  
  <entry>
    <title>認証方法の管理画面を刷新</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/modernizing-authentication-management/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/modernizing-authentication-management/</id>
    <published>2023-05-12T22:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.417Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 長谷川 です。</p><p>本記事は、2023 年 5 月 9 日に米国の Microsoft Entra (Azure AD) Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/modernizing-authentication-management/ba-p/2365669">Modernizing Authentication Management</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>この度、お客様の認証体験の管理方法について 2 つの重要なアップデートを発表できることを嬉しく思います。一つ目が統合された認証方法の一般提供 (GA) 開始と、もう一つが刷新された多要素認証 (MFA) の疑わしいアクティビティのレポートのパブリック プレビューです。</p><p>統合された認証方法の一般提供 (GA) により、認証やパスワード リセットに使用されるすべての方法を一元管理できるとともに、対象ユーザーやグループを絞った細かい制御が可能となりました。</p><p>MFA における最新の “疑わしいアクティビティ” のレポート機能のパブリック プレビューでは、設定箇所が認証方法ポリシーに組み込まれ、このユーザーから報告された疑わしい MFA 要求の情報を Identity Protection に統合しました。</p><h2 id="統合された認証方法"><a href="#統合された認証方法" class="headerlink" title="統合された認証方法"></a>統合された認証方法</h2><p>従来は、MFA 用とセルフサービス パスワード リセット用の認証方法を別々に管理する必要がありました。現在では、FIDO2 セキュリティ キーや証明書ベースの認証のようなパスワードレス認証の方法と併せ、1 つの画面で両方を管理することができるようになりました。新たに追加された認証方法には、SMS、音声通話、サードパーティ製 OATH ソフトウェア トークン、電子メール ワンタイム パスコード認証があります。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management1.png"></p><p>認証方法をよりきめ細かく管理できるようになり、すべてのユーザーではなく特定のユーザーやグループに対して認証方法を有効にしたり、ユーザーのグループを対象から除外したりする機能が追加されました。つまり、試験的に一部のグループで認証方法を試したり、SMS や音声通話などのセキュリティ レベルの低い認証方法の利用については、少数のユーザー グループに限定したりすることもできます。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management2.png"></p><p>また、従来の MFA および セルフサービス パスワード リセット ポリシーから統合された認証方法に管理を移行する際に利用できる移行の制御機能も追加されました。この機能を使用することで、認証方法を個別に移行したりテストしたりしたうえで、従来のポリシーで認証方法を無効にするということができます。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management3.png"></p><p>2024 年後半には、レガシー ポリシーで認証方法を管理する機能を廃止する予定です。統合された認証方法への移行にあたっては、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">セキュリティ対策を強化するために、これを機に SMS や音声通話の認証を取りやめ</a>、Microsoft Authenticator や FIDO2 セキュリティ キーなど、より安全な認証方法を有効にすることをお勧めします (まだの方は、ぜひご検討ください)。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-methods-manage">認証方法の管理</a> と <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-authentication-methods-manage">認証方法ポリシーへの移行</a> の詳細を確認し、できるだけ早く移行ください !</p><h2 id="疑わしいアクティビティのレポート"><a href="#疑わしいアクティビティのレポート" class="headerlink" title="疑わしいアクティビティのレポート"></a>疑わしいアクティビティのレポート</h2><p>Azure Active Directory (Azure AD) には、Microsoft Authenticator アプリや電話で受け取った疑わしい MFA 要求をユーザーが報告できる “MFA の不正アクセス アラート” 機能がありました。この機能によりブロック ストに追加されたユーザーはそのリストから消されるまで MFA 要求を受け取らないようになりますが、ブロック リストからの削除は管理者の手動作業でした。また、不正アクセスのアラートとブロック リストの管理にはすべてグローバル管理者権限が必要でした。今回、不正アクセスのアラート機能を疑わしいアクティビティのレポート機能と共に刷新し、この機能の設定を認証方法ポリシーに移動するとともに、他の認証関連の設定と同じ場所で設定できるようにしました。また、ユーザーが不審なプロンプトを報告した際に、より包括的なアクションをとれるようにアラート イベントを Identity Protection に統合しました。</p><p>疑わしいアクティビティのレポート機能を有効にし、全ユーザーか一部ユーザーをその対象とするには、認証方法の画面にある新しい “設定” から行うか、または認証方法の Microsoft Graph API を使用ください。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management4.png"></p><p>この機能が有効になると、ユーザーが Microsoft Authenticator アプリのプッシュ通知や音声での MFA 要求を疑わしいと報告した場合、そのユーザー アカウントはユーザー リスク高とマークされます。その後、リスクベースのポリシーを使用して、これらのユーザーの回復方法をより細かく制御することができます。例えば、セルフサービスのパスワード リセットによる即時のパスワード変更を要求したり、リスクが改善されるまですべての認証に MFA を要求したり、リスクが改善されるまで認証をブロックするなどが挙げられます。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management5.png"></p><p>もし Azure AD Premium P2 ライセンスをお持ちでない場合は、レガシー MFA ブロック リストと同様の機能として、リスク イベントを使用して、リスクが改善されるまでアカウントを無効にすることも可能です。</p><p>疑わしいアクティビティのレポート機能は、プレビュー中は従来の MFA の不正なアクセスのアラート機能と並行して機能するため、不正なアクセスのアラート機能を有効にして自動ブロックしている場合は、ユーザーの修復を行う際に、疑わしいアクティビティのレポート機能の適用範囲内のユーザーのリスクを改善することに加えて、MFA のブロック リストからユーザーを削除する必要もあります。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-mfa-mfasettings#report-suspicious-activity">疑わしいアクティビティのレポート機能</a> の構成と <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-policies">リスクベースのポリシー</a> の詳細を確認いただき、今すぐ疑わしいアクティビティのレポート機能をお試しください。</p><p>いつものように、フィードバックをお聞かせください。よろしくお願いします。</p><p>Alex Weinert (<a href="https://twitter.com/Alex_T_Weinert">@Alex_T_Weinert</a>)<br>VP Director of Identity Security, Microsoft</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 長谷川 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 9 日に米国の Microsoft Entra (Azure AD) Blog で公開された &lt;a href=&quot;https://techcommuni</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra Verified ID で LinkedIn 上での職場を証明する新しい方法の紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-a-new-way-to-verify-your-workplace-on-linkedIn-with-microsoft-entra-verified-id/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-a-new-way-to-verify-your-workplace-on-linkedIn-with-microsoft-entra-verified-id/</id>
    <published>2023-05-11T23:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.329Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 張替 です。</p><p>本記事は、2023 年 4 月 12 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/introducing-a-new-way-to-verify-your-workplace-on-linkedin-with/ba-p/3627349">Introducing a new way to verify your workplace on LinkedIn with Microsoft Entra Verified ID - Microsoft Community Hub</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>本日、LinkedIn をお使いの何百万もの方々が、Microsoft Entra Verified ID の資格情報を使用して、職場の認証ができるようになることをお知らせします。職場の認証は、LinkedIn メンバーのプロフィールに表示され、一覧にある勤務先が正確であることを確認するとともに、他のメンバーや組織に対して信頼と信憑性の印として機能します。</p><h2 id="職場の認証を行うための従業員-ID-の発行方法"><a href="#職場の認証を行うための従業員-ID-の発行方法" class="headerlink" title="職場の認証を行うための従業員 ID の発行方法"></a>職場の認証を行うための従業員 ID の発行方法</h2><p>組織は、わずか数分で Verified ID を使用して、ブランドやビジネス ニーズに合わせたデジタル従業員 ID を作成することが可能です。LinkedIn メンバーは、プロフィール上の「職場を認証する」ボタンをクリックし、携帯電話で数回タップするだけで、組織が発行するデジタル従業員 ID を受け取ることができます。従業員 ID の認証情報が LinkedIn と共有されると、職場の認証がプロフィールに表示されます。</p><p><img src="/blog/azure-active-directory/introducing-a-new-way-to-verify-your-workplace-on-linkedIn-with-microsoft-entra-verified-id/introducing-a-new-way-to-verify-your-workplace-on-linkedIn-with-microsoft-entra-verified-id1.png" alt="LinkedIn モバイル アプリの画面で、メンバーのプロフィールには「職場」の横にチェックマークが表示され、メンバーが職場の認証をしたことが示されます。"></p><p>職場の認証の詳細と実装方法については、マイクロソフトの ID およびネットワーク アクセス担当のプレジデントである Joy Chik による <a href="https://www.microsoft.com/en-us/security/blog/2023/04/12/linkedin-and-microsoft-entra-introduce-a-new-way-to-verify-your-workplace/">このブログ記事</a> をぜひお読みください。</p><h2 id="LinkedIn-で従業員-ID-を発行して勤務先を確認するための準備を整える"><a href="#LinkedIn-で従業員-ID-を発行して勤務先を確認するための準備を整える" class="headerlink" title="LinkedIn で従業員 ID を発行して勤務先を確認するための準備を整える"></a>LinkedIn で従業員 ID を発行して勤務先を確認するための準備を整える</h2><p>組織のグローバル管理者の方で、LinkedIn での職場認証の準備をされたい方は、<a href="https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR5RXCPyJ0yZAs6VJmUULNKZUQlJVOEFIVEpPS1Y1M1hMSUZMN0c1WEpPTS4u">こちらのフォーム</a> からパイロット プログラムにご登録をお願いします。</p><h2 id="今すぐ検証済み-ID-を発行しましょう"><a href="#今すぐ検証済み-ID-を発行しましょう" class="headerlink" title="今すぐ検証済み ID を発行しましょう"></a>今すぐ検証済み ID を発行しましょう</h2><p>Verified ID の資格情報は、多くのシナリオで信頼性や信憑性、検証可能性を高め、コスト、時間および連携のストレスを削減することが可能です。すぐに Verified IDを使用して従業員 ID を発行可能です。わずか数分で完了します。始めるには、以下の <a href="https://learn.microsoft.com/en-us/azure/active-directory/verifiable-credentials/">チュートリアル</a> をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 張替 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 12 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>パブリック プレビュー Authenticator Lite (Outlook)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/public-preview-authenticator-lite/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/public-preview-authenticator-lite/</id>
    <published>2023-05-11T22:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.497Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 張替 です。</p><p>本記事は、2023 年 4 月 18 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/public-preview-authenticator-lite-in-outlook/ba-p/3773139">Public Preview: Authenticator Lite (in Outlook)</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>2 年前、私たちは <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">“認証に電話網を使うのはそろそろやめよう (It’s Time to Hang Up on Phone Transports for Authentication)”</a> と題した記事を公開しました。本日、テキスト メッセージ (SMS) や音声ベースの認証からの移行を支援するツールとして、<strong>Authenticator Lite</strong> のパブリック プレビューを開始します。弊社としては、パスワードレス、フィッシング対策、使いやすさ、進化する攻撃への適応性など、最新の強力な認証を使用してすべてのユーザーがサインインできるようにすることを重要視しています。</p><p>最新の強力な認証で弊社が最も推奨するのは、最も堅牢なセキュリティ機能を提供し、最も頻繁に更新され、加えて無料の <a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-authentication-authenticator-app">Authenticator</a> です。Microsoft Authenticator アプリは、安全で簡単な認証方法として世界中で 1 億人以上のユーザーに信頼されており、Azure にサインインする際の強力な認証方法として最も一般的なものとなっています。</p><p>先進的かつ強力な認証は非常に重要であるため、これをより利用しやすくするために、この度 Outlook クライアントに直接その機能を組み込みました！この Outlook に組み込まれたユーザー体験は <a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite">Authenticator Lite</a> と呼ばれ、このパブリック プレビューが開始されたことをここで発表いたします！まだ Authenticator をダウンロードしていないユーザーでも、iOS または Android デバイスの Outlook アプリを使用して、職場や学校のアカウントの MFA を無料で完了できるようになりました。ユーザーは認証要求を承認し、TOTP コードを取得できるようになります。これにより、電話網に依存する認証からユーザーをスムーズに移行させつつ、Authenticator の安全性を享受できるようになります。</p><p>パブリック プレビューでは、管理者はユーザーのグループに対してこの機能を有効または無効にするか、Microsoft managed (Microsoft に設定を任せる) の状態のままにするかを選択できます。Authenticator Lite を有効にするグループを設定するには、Entra ポータルの Authenticator 設定ページから行います。 また、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite">Microsoft Graph を使用して機能を有効にする</a> ことも可能です。</p><div class="alert is-info"><p class="alert-title">Note</p><p>サポート チームによる補足: 以下の画面にあるコンパニオン アプリケーションとは Outlook のこと、つまり Authenticator Lite が組み込まれたアプリのことを示しています。</p></div><p><img src="/blog/azure-active-directory/public-preview-authenticator-lite/1.png"></p><p>Authenticator Lite は、その名のとおり、Authenticator の機能の一部を Outlook に拡張するものです。認証時の通知では、番号一致のプロンプトに加え、デバイスで有効な場合は生体認証または PIN の確認が含まれます。Authenticator Lite の通知設定の詳細については、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite#enable-authenticator-lite">こちら</a> をご覧ください。</p><p>Authenticator Liteが有効になると、Authenticator アプリを搭載していない<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite#prerequisites">最新バージョンの Outlook</a> を使用しているユーザーは、デバイスでアプリを起動する際に、MFA の方法として Outlook を登録するよう促されます。</p><p><img src="/blog/azure-active-directory/public-preview-authenticator-lite/2.png"></p><p>ユーザーが登録されると、次回の認証時に、Outlook アプリでプッシュ通知を使って認証するよう促されます。</p><p><img src="/blog/azure-active-directory/public-preview-authenticator-lite/3.png"></p><p>登録済みのユーザーは、Outlook の設定の「Authenticator」から TOTP コードを取得することもできます。</p><p><img src="/blog/azure-active-directory/public-preview-authenticator-lite/4.png"></p><p>ユーザーに対してこの機能を有効にするための詳細については、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite#prerequisites">こちら</a> を参照ください。Outlook でこの機能を利用するための展開処理が現在進行中であり、お客様は順次本機能を利用可能となります。</p><p>本機能は、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-authentication-default-enablement">“Microsoft managed”</a> の状態でテナントに展開されます。パブリック プレビューの期間中は機能を “Microsoft managed” のままにしてもユーザーへの影響はなく、明示的に状態を有効に変更しない限り、この機能はオフのままです。2023 年 4 月下旬、プレビューの表示を削除し、一般提供 (GA) 開始となります。2023 年 5 月 26 日、この機能が “Microsoft managed” に設定されたままであれば、お客様のテナントでは Microsoft によって Authenticator Lite が有効になります。5 月 26 日にこの機能が有効になることを望まない場合は、5 月 26 日より前に状態を “無効” に設定するか、有効にしたいユーザーと無効にしたいユーザーをそれぞれグループに割り当てるよう対応ください。 </p><p>ご質問やご意見がございましたら、<a href="https://feedback.azure.com/d365community">aka.ms/AzureADFeedback</a> までご連絡くださいますようお願いいたします。</p><p>Alex Weinert<br>VP Director of Identity Security, Microsoft<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 張替 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 18 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>モバイル デバイスでの Azure AD 証明書ベースの認証が GA となりました！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/</id>
    <published>2023-05-06T22:00:00.000Z</published>
    <updated>2023-05-13T23:48:48.985Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 5 月 4 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-certificate-based-authentication-cba-on-mobile-now/ba-p/1144695">Azure AD Certificate-Based Authentication (CBA) on Mobile now Generally Available!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>Ignite 2022 では、<a href="https://jpazureid.github.io/blog/azure-active-directory/identity-innovation-for-a-more-secure-nation/">大統領令 14028</a>「国家のサイバーセキュリティの改善」に対するマイクロソフトのコミットメントの一環として、Azure Active Directory (Azure AD) の証明書ベース認証 (CBA) の GA を発表しました。このたび、<strong>モバイルでの Azure AD CBA サポート</strong> の <strong>GA</strong> を発表できることを嬉しく思います。</p><p>iOS および Android デバイスにおいて、デバイス上の証明書に加え、USB や NFC 経由で YubiKeys のような外部ハードウェア セキュリティ キーの両方をサポートします。BYOD (Bring Your Own Device) が増加する中、この機能により、ユーザーのモバイル デバイスに証明書をプロビジョニングしなくても、モバイルに対してフィッシング耐性のある多要素認証 (MFA) を要求できるようになります。</p><p>今回は、モバイルでの Azure AD CBA のサポートについて、Microsoft Entra のプロダクト マネージャーである Vimala Ranganathan を招き、モバイルでのフィッシング耐性ある MFA の詳細を解説してもらいます。</p><p>お客様のフィードバックや提案をお待ちしています！Twitter (@azuread) までご連絡ください。</p><p>Alex Simons (<a href="https://twitter.com/alex_a_simons">@Alex_A_Simons</a>)<br>Corporate Vice President<br>Microsoft Identity Division</p><hr><p>みなさん、こんにちは。  </p><p>USB と NFC を介したハードウェア セキュリティ キー上の証明書を使用して、iOS および Android デバイス上で <strong>Azure AD CBA</strong> の <strong>GA</strong> を開始したことについて、さらに詳しくお伝えしたいと思います。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic1.png"></p><p>米国のサイバーセキュリティに関する <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">大統領令 14028</a> は、すべてのデバイス プラットフォームでフィッシング耐性のある MFA の使用を要求しています。お客様は、ハードウェア セキュリティ キーに証明書をプロビジョニングし、それを iOS や Android デバイス上で Azure AD での認証に使用することができるようになりました。モバイル デバイスにおけるマイクロソフトの証明書ベースのソリューションは、ハードウェア セキュリティキーと相まって、シンプルかつ便利で、Federal Information Processing Standards (FIPS) 認定のフィッシング耐性ある MFA 方式です。  </p><p>iOS 16 と iPadOS 16.1 で、Apple は NFC または CCID クラスに準拠したリーダーを使用した物理的なスマートカード認証のネイティブ サポートを追加しました。これにより、Azure AD に対して CCID 互換のスマートカードを認証に使用できるようになりました。</p><p>最新の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-overview">Microsoft Authentication Library</a> (MSAL) を使用する Microsoft のファーストパーティ アプリを含むすべてのネイティブ アプリで、モバイル デバイス上での <a href="https://www.yubico.com/products/">YubiKey</a> を使用した Azure AD CBA がサポートされます。また、最新の MSAL を利用していないすべてのアプリでも、最新の Microsoft Authenticator (<a href="https://play.google.com/store/apps/details?id=com.azure.authenticator&gl=US">Android</a> または <a href="https://apps.apple.com/app/microsoft-authenticator/id983156458">iOS/iPadOS</a>) を使用したブローカー認証のフローで Yubikey を用いた Azure AD CBA がサポートされます。</p><h2 id="iOS-デバイス上での-YubiKey-を使用した-Azure-AD-CBA"><a href="#iOS-デバイス上での-YubiKey-を使用した-Azure-AD-CBA" class="headerlink" title="iOS デバイス上での YubiKey を使用した Azure AD CBA"></a>iOS デバイス上での YubiKey を使用した Azure AD CBA</h2><p>iOS が YubiKey を認識しない場合は、<a href="https://apps.apple.com/us/app/yubico-authenticator/id1476679808%22HYPERLINK%20%22https://apps.apple.com/us/app/yubico-authenticator/id1476679808">Yubico Authenticator App</a> を使用して YubiKey の公開証明書を iOS キーチェーンにコピーします (スマートカード証明書の秘密鍵が YubiKey からコピーされることはありません)。</p><p>サインインするには、ユーザーは証明書選択画面から YubiKey の証明書を選択し、YubiKey を挿入するか、NFC 対応の YubiKey をタップして、YubiKey Authenticator 経由で PIN を入力し、認証フローを完了します。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic2.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic3.png"></p><h2 id="Android-デバイス上での-YubiKey-を使用した-Azure-AD-CBA"><a href="#Android-デバイス上での-YubiKey-を使用した-Azure-AD-CBA" class="headerlink" title="Android デバイス上での YubiKey を使用した Azure AD CBA"></a>Android デバイス上での YubiKey を使用した Azure AD CBA</h2><p>Android モバイルでの YubiKey による Azure AD CBA は、最新の MSAL を使用することで利用可能であり、YubiKey Authenticator アプリは Android においては必要ありません。  </p><p>Azure AD CBA を行うには、物理的なスマートカード上の証明書使用するか、USB 経由で YubiKey を接続するか、もしくは NFC を使用して、YubiKey から証明書を選択し、PIN を入力します。これでアプリケーションへの認証が完了します。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic4.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic5.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic6.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic7.png"></p><p>また、Azure AD CBA と YubiKeys については、こちらで詳しく解説しています:</p><ul><li>Azure AD CBA: <a href="http://aka.ms/aadcba">http://aka.ms/aadcba</a></li><li>iOS 上での Azure AD CBA: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-certificate-based-authentication-mobile-ios">iOS デバイスにおける Azure Active Directory の証明書ベースの認証</a></li><li>Android 上での Azure AD CBA: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-certificate-based-authentication-mobile-android">Android デバイスにおける Azure Active Directory の証明書ベースの認証</a></li><li>YubiKey: <a href="https://www.yubico.com/why-yubico/">Meet the YubiKey - Strong Two-Factor Authentication Solution</a></li></ul><h2 id="今後について"><a href="#今後について" class="headerlink" title="今後について"></a>今後について</h2><p><a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure Active Directory Community</a> でフィードバックをお寄せください！弊社では今後、証明書の選択画面に表示される証明書をフィルタリングする機能を追加するとともに、モバイル上での Azure AD CBA にて他のスマートカード プロバイダーを利用できるようにする対応にも取り組んでいます。  </p><p>大統領令 14028 に対するマイクロソフトのコミットメントについては、<a href="https://www.microsoft.com/en-us/security/blog/2022/02/17/us-government-sets-forth-zero-trust-architecture-strategy-and-requirements/">こちら</a> をご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 4 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された &lt;a href=&quot;https://tech</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra (Azure AD) 向け Windows Local Administrator Password Solution のご紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/</id>
    <published>2023-05-04T22:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.353Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 4 月 21 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/introducing-windows-local-administrator-password-solution-with/ba-p/1942487">Introducing Windows Local Administrator Password Solution with Microsoft Entra (Azure AD)</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>本日、皆様に素晴らしいニュースをお伝えしたいと思います！包括的なセキュリティソリューションを提供するという私たちのビジョンの一環として、弊社では Windows および Microsoft Intune チームと協力して、<strong>Windows Local Administrator Password Solution (LAPS) for Azure AD</strong> (Microsoft Entra の一部）の <strong>パブリック プレビュー</strong> をリリースしました。</p><p>今回は、このリリースのプロダクト マネージャーの一人である Sandeep Deo に、これらのアップデートの概要と、Microsoft Entra (Azure AD) で Windows LAPS を使い始める方法について説明してもらいます。Sandeep のブログ記事は以下からご覧いただけます。</p><p>Alex Simons (@Alex_A_Simons)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p><hr><p>皆さん、こんにちは。</p><p>今回、LAPS のアップデートと、Microsoft Entra (Azure AD) および Microsoft Intune を使用して、Azure AD に参加する Windows デバイスのセキュリティを確保する方法をご紹介します。</p><p>すべての Windows デバイスにはローカル管理者アカウントが組み込まれており、PtH (Pass-the-Hash) 攻撃や横断的なトラバーサル攻撃を軽減するためにセキュリティを確保する必要があります。多くのお客様は、ドメイン参加した Windows マシンのローカル管理者のパスワード管理に、スタンドアロン型のオンプレミス製品である LAPS を使用されていると存じます。しかし、Azure AD に直接参加するよう Windows 環境を刷新するにあたり、同様に LAPS のサポートが必要だというフィードバックを多くいただいておりました。</p><p>本日、弊社では Azure AD 参加したデバイスとハイブリッド Azure AD 参加したデバイスの両方で、Windows LAPS を利用できるようにします。さらに、<a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-4-%E6%9C%88-11-%E6%97%A5-kb5025221-os-%E3%83%93%E3%83%AB%E3%83%89-19042-2846-19044-2846-19045-2846-b00c3356-baac-4a41-8342-7f97ec83445a">Windows 10 20H2 以降、Windows 11 21H2 以降</a>、および <a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-4-%E6%9C%88-11-%E6%97%A5-kb5025239-os-%E3%83%93%E3%83%AB%E3%83%89-22621-1555-5eaaaf42-bc4d-4881-8d38-97e0082a6982">Windows Server 2019 以降</a> で、<a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-4-%E6%9C%88-11-%E6%97%A5-kb5025230-os-%E3%83%93%E3%83%AB%E3%83%89-20348-1668-28a5446e-6389-4a5b-ae3f-e942a604f2d3">最新のセキュリティ更新プログラム (2023 年 4 月 11 日リリース) を使用する Windows</a> に Windows LAPS が既定で組み込まれるようになりました。</p><p>このプレビュー内で利用可能となった重要な機能は以下のとおりです:</p><ul><li>Windows LAPS を有効にするには、<strong>テナント全体のポリシーとクライアント側のポリシーを使用し、ローカル管理者パスワードは Azure AD にバックアップされる</strong>。</li><li><strong>Microsoft Intune ポータルでクライアントサイド ポリシー</strong> を設定し、<strong>ローカル管理者のパスワード管理のために、アカウント名、パスワードの有効期限、長さ、複雑さ、手動パスワード リセットなどを設定する</strong>。</li><li><strong>Microsoft Entra/Microsoft Intune ポータルまたは Microsoft Graph API/PowerShell を使用して保存されたパスワード</strong> を復元する。</li><li><strong>Microsoft Entra ポータルまたは Microsoft Graph API/PowerShell</strong> を使用して、すべての LAPS 対応デバイスを確認する。</li><li><strong>パスワードの回復を承認するには、カスタム ロールと管理単位で、Azure AD ロールベース アクセス コントロール (RBAC) ポリシー</strong> を作成する。</li><li><strong>Microsoft Entra ポータルまたは Microsoft Graph API/PowerShell を使用して監査ログ</strong> を表示し、<strong>パスワードの更新と回復のイベントを監視</strong> します。</li></ul><p><strong>パスワード回復の権限を持つディレクトリ ロールには条件付きアクセスポリシーを構成するすること</strong> がお勧めです。</p><p>これらのシナリオを実現するための簡単な手順を以下に説明していきます。</p><h2 id="LAPS-のセットアップ"><a href="#LAPS-のセットアップ" class="headerlink" title="LAPS のセットアップ"></a>LAPS のセットアップ</h2><p><strong>Azure AD のデバイス</strong> メニューで <strong>デバイスの設定を選択</strong> し、<strong>LAPS の設定で はい を選択して保存をクリック</strong> します。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic01.png"></p><p><strong>Microsoft Intune エンドポイント セキュリティ</strong> のメニューで、<strong>アカウント保護</strong> を選択し、<strong>ポリシーの作成</strong> を選択して、Windows 10 以降のWindows LAPS プロファイルを作成します。プロファイルの作成中、<strong>Azure AD をバックアップ先のディレクトリ</strong> として選択します。LAPS の他のクライアント ポリシーを構成することも可能です。<strong>割り当て</strong> に Azure AD のグループを指定して、最後に <strong>確認及び作成</strong> を選択します。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic02.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic03.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic04.png"></p><div class="alert is-info"><p class="alert-title">Note</p><p>本記事執筆時点では、上記スクリーンショットのとおり、(Windows Insider のみ) という文言が一部のポータル上に表示されております。しかし、本記事のとおり Windows LAPS はパブリック プレビュー状態となりますので、Windows Insider は必要ありません。最新の Windows Update を適用した通常バージョンの Windows にて Windows LAPS をご利用いただけます。</p></div><h2 id="ローカル管理者パスワードの復旧"><a href="#ローカル管理者パスワードの復旧" class="headerlink" title="ローカル管理者パスワードの復旧"></a>ローカル管理者パスワードの復旧</h2><p><strong>Azure AD のデバイスの概要</strong> ページで、<strong>ローカル管理者パスワードの回復</strong> を選択します。これにより、LAPS が有効なすべてのデバイスが列挙され、デバイス名の横にある <strong>ローカル管理者パスワードの表示</strong> をクリックすると、パスワードを確認できます。また、デバイス名を入力してフィルタリングし、列挙されたリストから <strong>ローカル管理者パスワードの表示</strong> を選択するという方法もあります。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic05.png"></p><p>また、ローカル管理者パスワードの回復を承認するにあたっては、Azure AD で <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/custom-create">カスタム ロール</a> または <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/administrative-units">管理単位</a> を作成することもできます。</p><h2 id="ローカル管理者パスワードを手動でリセットする"><a href="#ローカル管理者パスワードを手動でリセットする" class="headerlink" title="ローカル管理者パスワードを手動でリセットする"></a>ローカル管理者パスワードを手動でリセットする</h2><p><strong>Microsoft Intune エンドポイント セキュリティのすべてのデバイス</strong> ページで、<strong>検索</strong> フィールドにデバイス名を入力します。次に、特定のデバイスの概要ページで、デバイスへのアクションとして「ローカル管理者パスワードのローテーション」を選択します。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic06.png"></p><h2 id="ローカル管理者のパスワードの更新と回復を監査する"><a href="#ローカル管理者のパスワードの更新と回復を監査する" class="headerlink" title="ローカル管理者のパスワードの更新と回復を監査する"></a>ローカル管理者のパスワードの更新と回復を監査する</h2><p><strong>Azure AD デバイスの概要</strong> ページで、<strong>監査ログ</strong> を選び、<strong>アクティビティのフィルター</strong> を使用して <strong>Update device local administrator password</strong> または <strong>Recover device local administrator password</strong> を検索し、監査イベントを表示します。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic07.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic08.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic09.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic10.png"></p><p>個々の監査イベントをクリックすると、アクティビティ、ターゲット、変更されたプロパティなどの詳細を確認することができます。</p><p>この新しいセキュリティ機能を利用するために、Microsoft Entra (Azure AD) および Microsoft Intune で Windows LAPS を導入することを強くお勧めします。これにより、これらの機密性の高いパスワードの安全性が格段に向上します。Windows LAPS for Microsoft Entra (Azure AD) の利用を開始するには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/howto-manage-local-admin-passwords">ここにアクセス</a> ください。</p><p>いつものように皆様のフィードバックと提案お待ちしております。<a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Microsoft Entra (Azure AD) のフォーラム</a> でコメントを共有ください。皆様からのご連絡をお待ちしております。</p><p>Sandeep Deo (@MsftSandeep)<br>Principal Product Manager<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 21 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された &lt;a href=&quot;https://tec</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD のセキュリティを強化するために今すぐできること (Quick Win)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/quick-wins-to-strengthen-your-azure-ad-security/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/quick-wins-to-strengthen-your-azure-ad-security/</id>
    <published>2023-05-01T23:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.517Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 4 月 3 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/quick-wins-to-strengthen-your-azure-ad-security/ba-p/3767905">Quick Wins to Strengthen Your Azure AD Security</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>どの組織も、インフラの安全性と信頼性を高めるために、攻撃の対象範囲を縮小するべく取り組んでいらっしゃると存じます。</p><p><a href="https://www.microsoft.com/en-us/security/blog/2021/06/09/crsp-the-emergency-team-fighting-cyber-attacks-beside-customers/">Microsoft Global Compromise Recovery Security Practice (CRSP)</a> のチーム メンバーとして、セキュリティの態勢を改善し、侵入を平均よりも難しくすることで、低スキルの攻撃者がすぐに攻撃を諦めて次のターゲットに移る事例をこれまで数多く見てきました。</p><p>サイバー セキュリティの環境が変化する中、<a href="https://learn.microsoft.com/ja-jp/security/ciso-workshop/ciso-workshop-module-3?view=o365-worldwide#part-6-build-an-identity-perimeter-1357">ID は新しいセキュリティ境界</a> であり、侵害されたユーザーが壊滅的なサイバー攻撃のきっかけであったという話をよく聞きます。</p><p>ID について語るとき、Microsoft Entra 製品群の一部である Azure Active Directory (Azure AD) は、ほとんどの組織で利用されている重要な ID システムであり、アプリケーションやリソースなどに対するユーザーの認証と認可のための中心点として機能します。 これは、組織のゼロ トラスト戦略の中核をなすものです。</p><p>このブログでは、Azure AD の攻撃範囲を縮小するための <strong>Quick Win</strong> (すぐに実施できる対応) をいくつかご紹介します。技術的な観点からすると、これらの対応はすぐに実行できるもので、本番で展開するためのテストも最小限のものとなります。</p><h2 id="1-作業用とクラウド管理用のアカウントの分離"><a href="#1-作業用とクラウド管理用のアカウントの分離" class="headerlink" title="1. 作業用とクラウド管理用のアカウントの分離"></a>1. 作業用とクラウド管理用のアカウントの分離</h2><p>ID は、新しいセキュリティの境界線です。もし 1 つの鍵で組織に入れてしまうのであれば、攻撃者は簡単にその組織を制圧できてしまいます。普段の業務用と管理用に同じアカウントを使用すると、組織のセキュリティが危険にさらされます。このことを念頭に置いて、普段の業務用と管理用のアカウントを分離する必要があります。普段の業務に使用される ID から特権を剥奪し、クラウドの管理用アカウントは個別に作成したうえで、その ID にも極力特権を与えないようにしましょう。</p><h2 id="2-緊急アクセス用アカウントの安全な管理"><a href="#2-緊急アクセス用アカウントの安全な管理" class="headerlink" title="2. 緊急アクセス用アカウントの安全な管理"></a>2. 緊急アクセス用アカウントの安全な管理</h2><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access">緊急アクセス用アカウント</a> (<strong>Break-Glass アカウント</strong>) は高い権限を持ち、他の管理アカウントが使用できないときという緊急のシナリオの時だけ利用されます。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access#create-emergency-access-accounts">ベスト プラクティス</a> に従って少なくとも 2 つ緊急アクセス用アカウントを作成し、それらのアカウントはどのユーザーとも紐づかないようにしてください。</p><p>緊急アクセス用アカウントの認証情報は安全に保存され、有効期限がなく、通常の業務に使用されることはありません。少なくとも 1 つの緊急アクセス用アカウントは、電話ベースの多要素認証 (MFA) を使用しないようにし、条件付きアクセスにおいても管理者/ユーザーによるクラウド アプリへのアクセスを制限/許可するポリシーから除外するよう対応ください。Azure AD の監査ログを使用して、サインインとすべての監査アクティビティを <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access#monitor-sign-in-and-audit-logs">監視する</a> 必要もあります。</p><h2 id="3-特権アカウントの多要素認証"><a href="#3-特権アカウントの多要素認証" class="headerlink" title="3. 特権アカウントの多要素認証"></a>3. 特権アカウントの多要素認証</h2><p>マイクロソフトでは、すべてのユーザーに対して MFA を有効にすることを推奨しています。<a href="https://www.microsoft.com/en-us/security/blog/2019/08/20/one-simple-action-you-can-take-to-prevent-99-9-percent-of-account-attacks/">MFA はアカウント侵害攻撃の 99.9% 以上をブロックすることができます</a>。MFA をすべてのユーザーで有効にする際には、レガシー認証プロトコルに与える影響を徹底的にテストし、最終的にブロックする必要があります。したがって、こちらは中期から長期のセキュリティ強化目標と考えることができるでしょう。</p><p>中長期の取り組みが進む中で、クラウド上に管理アカウントを別途用意することになると思われます。当面のステップとして、まず、高い権限を持つすべてのユーザーに対して MFA を適用することから始めましょう。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/plan-conditional-access">条件付きアクセス ポリシー</a> を使用して、これらのユーザーに対して MFA を展開することが可能です。テナントに入れなくなってしまった場合の緊急事態に備えて、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access#exclude-at-least-one-account-from-phone-based-multi-factor-authentication">緊急アクセス用管理者アカウントがポリシーから除外されていること</a> を確認ください。MFA と条件付きアクセス ポリシーの使用は、攻撃者の時間とコストを増加させ、最終的に攻撃者の注目をそらせることにつながります。</p><h2 id="4-条件付きアクセスで-SaaS-Software-as-a-Service-アプリケーションを管理するためのゼロ-トラスト原則"><a href="#4-条件付きアクセスで-SaaS-Software-as-a-Service-アプリケーションを管理するためのゼロ-トラスト原則" class="headerlink" title="4. 条件付きアクセスで SaaS (Software-as-a-Service) アプリケーションを管理するためのゼロ トラスト原則"></a>4. 条件付きアクセスで SaaS (Software-as-a-Service) アプリケーションを管理するためのゼロ トラスト原則</h2><p><a href="https://www.microsoft.com/en-us/security/blog/2020/04/30/zero-trust-deployment-guide-azure-active-directory/">ゼロ トラストのコンセプト</a> は、全体的なセキュリティを強化するのに役立ちます。リソースを保護し、最新の認証の原則に従うことで、組織はリソースのセキュリティをより確実に確保できます。</p><p>常に検証を行い、最小限の権限でアクセスし、侵入を想定することが、<a href="https://www.microsoft.com/ja-jp/security/business/zero-trust">ゼロ トラスト</a> のすべてです。企業ネットワークとカフェの公衆インターネットという単純な例で考えてみましょう。 <a href="https://www.microsoft.com/en-us/security/blog/2019/10/23/perimeter-based-network-defense-transform-zero-trust-model/">従来のアプローチでは、企業ネットワークはネットワークの面で多くの投資がなされることで安全な状態にある</a> とされていました。しかし、新しいゼロ トラストのアプローチでは、ID、場所、デバイス準拠など、利用可能なすべてのデータポイントを明示的に検証することが必要です。</p><p>取り急ぎの対応として、すでに Azure AD と統合されているアプリで試験運用を開始することをお勧めします。条件付きアクセス ポリシーとゼロ トラスト原則に基づく強固なアクセス モデルの構築を開始するためには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/plan-conditional-access">展開ガイダンス</a> と <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/resilience-overview">ベスト プラクティス</a> を確認ください。</p><h2 id="5-アプリケーションへの-Azure-AD-SSO-を評価"><a href="#5-アプリケーションへの-Azure-AD-SSO-を評価" class="headerlink" title="5. アプリケーションへの Azure AD SSO を評価"></a>5. <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/five-steps-to-full-application-integration-with-azure-ad">アプリケーションへの Azure AD SSO</a> を評価</h2><p>SSO (<strong>シングル サインオン</strong>) は、ユーザーに利便性と安全性をもたらします。ユーザーが頻繁に認証情報を求められると、毎日何度も認証情報を入力することになり、ユーザーは詳細を確認せずに画面に認証情報を入力してしまうことになります。さらに、すべてのアプリケーションに認証情報の痕跡が残ることになります。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/active-directory-faq#azure-ad----------------------------------------------------">Azure AD は最新の認証プロトコルと強力な認証機構をサポートしています</a>。Cisco のようなデバイスを Azure AD と統合して認証することも可能です。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/saas-apps/tutorial-list">Azure AD ギャラリーには、何千ものビジネス生産性アプリケーションがあらかじめ統合されています</a>。まず最初のステップとして、組織で導入される新しいアプリケーションを <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/plan-an-application-integration">統合する</a> ことを検討ください。加えて、ID ライフサイクルの管理向上のために、アプリケーションへの Azure AD ユーザー プロビジョニングを利用しましょう。  </p><p>次に取り組む作業としては、クレームに基づいて動作しているアプリケーションを確認することです。さらに、複数の ID プロバイダーをサポートするアプリケーションがないかも確認できれば、それを SSO のテストと展開の最初の候補とすることもできます。</p><h2 id="6-Azure-AD-で-ID-ガバナンスを有効化"><a href="#6-Azure-AD-で-ID-ガバナンスを有効化" class="headerlink" title="6. Azure AD で ID ガバナンスを有効化"></a>6. Azure AD で ID ガバナンスを有効化</h2><p>ID ガバナンスは、組織のセキュリティのバランスをとる確立された方法であり、ID のライフサイクルを標準化された方法で管理することでそれを実現します。ID ガバナンスを活用すると、「誰が何にアクセスできるのか」を体系的に定義できます。このソリューションを活用しても、組織の生産性に悪影響を及ぼすことはありません。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-overview">エンタイトルメント管理</a> では、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-create">アクセス パッケージ</a> というものを作成でき、ユーザーが新しいプロジェクト/チームに参加する際に必要となるグループ、アプリ、チーム、SharePoint サイトへのアクセスを、手動で付与するのでなく、ユーザーが自らリクエストできるようになります。エンタイトルメント管理は社外とのコラボレーション シナリオもサポートしておりますので、詳細は <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-external-users">B2B シナリオのためのエンタイトルメント管理</a> を参照ください。</p><p>さらに、過剰な権限は、セキュリティを脆弱にします。組織のリソースへのアクセス権をレビューして維持や剥奪を判断したい場合は、Azure AD の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/access-reviews-overview">アクセス レビュー</a> をぜひ活用ください。</p><p>今後新たに付与するアクセス権に対してこの機能の評価を始め、徐々にすべてのビジネスにおいてアクセス パッケージを使用するように移行することがおすすめです。</p><h2 id="7-Azure-AD-Identity-Protection-によるユーザーとサインインのリスク検出"><a href="#7-Azure-AD-Identity-Protection-によるユーザーとサインインのリスク検出" class="headerlink" title="7. Azure AD Identity Protection によるユーザーとサインインのリスク検出"></a>7. Azure AD Identity Protection によるユーザーとサインインのリスク検出</h2><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/overview-identity-protection">Identity Protection</a> は、Azure AD、Microsoft アカウント、および XBOX から収集したインテリジェンスを活用する Azure AD の強力な機能です。Identity Protection がサインイン要求を処理すると、お客様ではその結果を使用してアクセスを許可するか拒否するかなどの決定を下すことができます。</p><p>Identity Protection はユーザーやサインインのリスクを判断し、組織が適切な対処を実施できるよう支援します。<br>例えば、ユーザーが匿名 IP アドレスから接続していることが判明したときは、サインイン リスクが中または高の場合に MFA を強制したり、ユーザーの資格情報がダーク ウェブに流出していると Identity Protection が判断したときは、ユーザーにパスワードを変更するよう強制したりすることができます。</p><p>お客様においては、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-simulate-risk">リスク検出をシミュレートする</a> ことで、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies#enable-policies">レポート専用モード</a> で Identity Protection の評価を開始できます。 Identity Protection により検出されたリスクを監視し、その詳細を理解するという意味では、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/howto-use-azure-monitor-workbooks#identity-protection-risk-analysis">Identity Protection Risk Analysis ワークブック</a> が最適な方法です。</p><h2 id="8-Azure-RBAC-による最小特権の適用"><a href="#8-Azure-RBAC-による最小特権の適用" class="headerlink" title="8. Azure RBAC による最小特権の適用"></a>8. Azure RBAC による最小特権の適用</h2><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-planning">ロールのセキュリティ</a> をどのように確保するかは、どの組織にとっても重要です。特権 ID が攻撃の手段として使われることは、セキュリティ侵害のシナリオでよく見られることです。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-configure">特権 ID 管理 (PIM)</a> を用いることで、時間制限のあるアクセスを実現でき、特権ロールを有効にするためにさらに承認手続きを追加することでさらにセキュリティを向上させることができます。例えば「ドメイン名の管理者」ロールは、Azure AD にドメインを登録する際に必要な特権ですが、使用頻度が非常にまれな特権です。ユーザーはこの特権を 24 時間 365 日保持する必要はありません。代わりに、必要なときに有効化することでその業務を行うことができますし、ポリシーに基づいて一定時間後にユーザーは特権を剥奪されます。</p><p>PIM は、ロールを有効化する際に、MFA やロールのアクティブ化の正当性の要求、ロールが有効になったときの管理者への通知、アクセス レビューの有効化、アクティビティの監査など、追加の制御や情報を要求できます。さらに、PIM は Microsoft 365 だけでなく、Azure リソースにも使用することができます。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-deployment-plan">PIM の導入</a> は、組織が有効な割り当てと資格ある割り当ての両方を評価する際の重要な最初のステップです。例えば、緊急管理者アカウントはグローバル管理者権限を恒久的に保持すべきですが、その他の役割は必要なときに得られるようにすべきです。</p><h2 id="9-パスワード保護の機能で弱いパスワードを撤廃"><a href="#9-パスワード保護の機能で弱いパスワードを撤廃" class="headerlink" title="9. パスワード保護の機能で弱いパスワードを撤廃"></a>9. パスワード保護の機能で弱いパスワードを撤廃</h2><p>“Summer2022!” は、大文字、数字、特殊文字からなるパスワードで、通常の最小文字数要件を満たしているように見えます。しかしながら、このようなパスワードは辞書ベースのパスワード攻撃に脆弱です。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-password-ban-bad-on-premises-deploy">Azure AD のパスワード保護</a> は、組織がこのようなパスワードの使用を阻止できる素晴らしい機能です。パスワード保護では、グローバルおよびカスタムの禁止パスワード リストがご利用いただけます。</p><p>この機能は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-password-ban-bad-on-premises-deploy#deployment-requirements">軽量エージェントを介してドメイン コントローラー上で</a> 使用することもできます。セットアップは簡単で、監査モードもサポートしているため、管理者は組織内の安全でないパスワードの使用状況を把握し、パスワード ポリシーやユーザーへのガイダンスへの改善を計画することができます。</p><h2 id="10-ユーザー同意の制限"><a href="#10-ユーザー同意の制限" class="headerlink" title="10. ユーザー同意の制限"></a>10. ユーザー同意の制限</h2><p>ユーザーは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/user-admin-consent-overview">同意</a> の機能を使用して、保護されたリソースにアクセスするためのアクセス許可をアプリケーションに付与することができます。例えば、サポート担当者が問題の説明を電子メールで受け取ると、それに基づいてインシデントを発行するチケット システムを例にとって説明しましょう。これがうまく動くためには、チケット システムはユーザーのメールボックスを読み取る権限が必要です。既定では、ユーザーがアプリケーションに同意しない限り、Azure AD は要求されたアクセス許可をアプリケーションに付与しません。</p><p>お客様は管理者として、ユーザーが同意できなくする (同意機能を無効化する)、確認済みの発行元のアプリケーションにのみ同意を許可する、または任意のアプリケーションにユーザーの同意を許可するのいずれかを選択できます。マイクロソフトは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/configure-user-consent?tabs=azure-portal&pivots=portal">ユーザーの同意を確認済みの発行元のアプリケーションのみに制限し</a>、同意できるアクセス許可を管理者が選択したものに制限することを推奨しています。</p><p>お客様におかれましては、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/application-consent-experience">同意のフレームワークとアプリケーションの同意エクスペリエンス</a> について把握するべく、まずは管理者の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/manage-consent-requests">同意の要求について評価</a> を開始することをお勧めします。管理者にて同意を安全に行う必要性が理解できたら、ユーザーの啓発に加えて、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/configure-admin-consent-workflow">管理者の同意</a> が必要なフローについても確認いただき、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/manage-consent-requests#evaluate-a-request-for-tenant-wide-admin-consent">テナント全体の管理者の同意要求を評価する</a> などの取り組みも実施いただければと思います。</p><h2 id="11-Azure-AD-と接続されたシステムの継続的なモニタリング"><a href="#11-Azure-AD-と接続されたシステムの継続的なモニタリング" class="headerlink" title="11. Azure AD と接続されたシステムの継続的なモニタリング"></a>11. Azure AD と接続されたシステムの継続的なモニタリング</h2><p>ID システムはインフラのバックボーンであるため、Azure AD とそれに付随する Azure AD Connect や AD Federation Services (AD FS) のようなシステムの監視業務はすべてのリソースにとって最も重要であり、継続的なプロセスです。</p><p>ユーザーのサインインを監視するための Identity Protection の使用については前述のとおりです。追加のステップとして、<a href="https://learn.microsoft.com/ja-jp/defender-cloud-apps/tutorial-ueba#enable-identity-protection">Identity Protection を Defender for Cloud Apps と統合する</a> ことも可能です。統合はすぐに行え、画面上のボタンを有効にするだけです。これにより、Azure AD Identity Protection は Defender for Cloud Apps にシグナルを送信し、Defender for Cloud Apps は情報を処理して <strong>セキュリティ運用チーム</strong> 向けにアラートを生成するようになります。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/whatis-azure-ad-connect#what-is-azure-ad-connect-health">Azure AD Connect Health</a> は、監視のためのもう一つの重要な機能です。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-health-alert-catalog#alerts-for-active-directory-federation-services">重大な AD FS システムの問題</a>、<a href="https://learn.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-health-adfs#performance-monitoring-for-ad-fs">パフォーマンスと接続性</a> など、重要な健全性のアラートを提供することで、ハイブリッド ID 環境におけるオンプレミス ID システムの信頼性を確保できるようにします。さらに、AD FS サーバーからのサインイン失敗やロックアウトの傾向も提示が可能です。 軽量なエージェントで動作するため、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/whatis-azure-ad-connect#why-use-azure-ad-connect-health">導入</a> は非常に簡単です。</p><p>加えて、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/identity-secure-score">ID セキュリティ スコア</a> の推奨事項についても対応ください。ID セキュリティ スコア は、Azure AD の全体的なセキュリティの状態を表示します。片手間で評価しすぐに改善できるような、影響度が低く実装コストが低い項目も中にはあります。定期的に ID セキュリティ スコアをレビューすることで、現在のセキュリティの状態についての見識を得るとともに、その内容を評価して修復するようご計画ください。</p><p>セキュリティは組織にとって最優先事項であり、<a href="https://www.microsoft.com/en-us/security/business/security-insider/reports/cyber-signals-issue-1-identity/?culture=en-in&country=IN">ID は新たな戦場となります</a>。まず、貴社にてセキュリティを担当するチームがございましたら、このブログに記載されているポイントに従って、Azure AD の構成と実際の状況を比較し、問題個所を特定いただければ幸いです。次のステップは、対応の優先順位を決めることです。項目によっては展開に多少の計画が必要かもしれませんが、「作業用とクラウド管理用のアカウントの分離」「緊急アクセス用アカウントの安全な管理」「Azure RBAC による最小特権の適用」は、セキュリティへの影響が大きく、すぐに実施できる項目であるため、重要度が最も高い項目となり得ます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 3 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD の Go Local データ保存機能が日本でパブリック プレビューを開始</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-go-local-data-residency-goes-public-preview-in-japan/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-go-local-data-residency-goes-public-preview-in-japan/</id>
    <published>2023-05-01T22:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.005Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 4 月 24 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-go-local-data-residency-goes-public-preview-in-japan/ba-p/3751028">Azure AD Go Local Data Residency Goes Public Preview in Japan</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p><a href="https://www.microsoft.com/ja-jp/security/business/microsoft-entra">Microsoft Entra</a> の一部である <a href="https://azure.microsoft.com/ja-jp/services/active-directory/external-identities/b2c/">Azure Active Directory (Azure AD) B2C</a> を用いることで、世界中の企業や個人は主なセキュリティおよびプライバシー要件に対応でき、これまで以上に多くのことを達成できるようになります。この要件には、データの保存場所についても言えるはずです。本日、Go Local のデータ保存機能 (データを特定の地域に保存する機能) が日本向けにパブリック プレビューとなりましたことをお知らせします。</p><p>Azure AD では、データの保存場所はテナント作成時に選択した国/地域によって決定されます。Go Local の追加機能は、Azure AD Premium P1 および P2 のお客様が、ディレクトリのデータを特定の地域に保存するよう指定できる機能です。</p><p>本日、特定地域へのデータ保持を利用可能な地域の一覧に日本が追加されました。この Go-Local の追加機能を有効にするだけで、Azure AD B2C のデータが日本に保存されるようになります。</p><p>このアップデートにより、日本のお客様のデジタル トランスフォーメーションをさらに加速できることとなります。弊社は、信頼できるクラウドの原則とコンプライアンスにおけるリーダーシップに引き続き注力しております。これにより、世界中のすべてのお客様に、ご自身のアプリケーションがコンプライアンスを達成できるよう必要なセキュリティ基盤を提供してまいります。 </p><p>どの地域においても Go Local は有料の追加機能であり、月間アクティブ ユーザーあたり 0.02 ドルの費用がかかります。</p><p>日本で Go Local の利用を開始するには、Azure REST API または Azure ポータルを使用して新しい Azure AD B2C テナントを作成する際に、GoLocal アドオンを有効に設定ください。</p><p>詳しくは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/data-residency#data-residency">利用可能なリージョンとデータの保存場所</a> をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 24 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された &lt;a href=&quot;https://tec</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Azure AD B2C" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2C/"/>
    
  </entry>
  
  <entry>
    <title>ハイブリッド Azure AD 参加を再構成する</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/haadj-re-registration/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/haadj-re-registration/</id>
    <published>2023-04-24T00:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.221Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの長谷川です。</p><p>この記事では、対象デバイスのハイブリッド Azure AD 参加 (略称 HAADJ) を再構成する手順を紹介します。</p><span id="more"></span><p>HAADJ を構成完了後、たとえばなんらか Azure AD 上から誤ってデバイス オブジェクトを削除してしまう場合があるかと思います。削除後、再度 Azure AD Connect (略称 AADC) でデバイス オブジェクトが同期されると [Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] で対象のデバイス オブジェクトが表示されるようになりますが、[登録済み] の項目が「保留中」のまま遷移しない状態になります。「保留中」から登録日に遷移させるためにはデバイスで HAADJ を再構成する必要があるものの、実際のデバイス側は既に HAADJ の構成が完了しているため、そのままでは HAADJ を再構成する動作が生じません。こういった場合に、本ブログを参考に HAADJ を再構成いただけると幸いです。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li><a href="#anchor1">注意事項</a></li><li><a href="#anchor2">事前準備: Windows Hello for Business のリセット</a></li><li><a href="#anchor3">事前準備: Intune の登録解除</a></li><li><a href="#anchor4">HAADJ 再構成: 既存情報のクリア</a></li><li><a href="#anchor5">HAADJ 再構成: 改めて構成</a></li><li><a href="#anchor6">事後確認: Intune の登録</a></li><li><a href="#anchor7">事後作業: WHfB の再プロビジョニング</a></li></ol><h2 id="anchor1">1. 注意事項</h2><p>本手順は Azure AD でデバイスを認証する「Sync Join」「マネージド」「クラウド認証」などと呼ばれる構成方法にのみ適用可能です。</p><p>この構成方法は、オンプレミスの Active Directory サーバーから AADC を介して Azure AD にデバイス オブジェクトを同期し、Azure AD でデバイスを認証して HAADJ としてデバイスを構成するものです。もしも AD FS でクレーム ルールを使用してデバイスを認証し、Azure AD にデバイスを登録して HAADJ を構成している場合はこの手順は利用できません。</p><p>なお、再度 HAADJ を構成するためにはそのデバイス上での管理者権限と、デバイスがオンプレミスの Active Directory にアクセスできる環境 (社外にデバイスがある場合は、オンプレミス AD 環境への VPN 接続) が必要です。</p><h2 id="anchor2">2. 事前準備: Windows Hello for Business のリセット</h2><p><strong>Windows Hello for Business (略称 WHfB) を利用していない場合はこの手順はスキップください。</strong></p><ol><li><p>端末にサインインします。</p></li><li><p><strong>ユーザー権限</strong> でコマンド プロンプトを起動します (管理者として実行から起動しないようご注意ください)。</p></li><li><p>以下のコマンドを実行して、WHfB の情報をリセットします。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">certutil -deletehellocontainer</span><br></pre></td></tr></table></figure></li><li><p>次のコマンドを実行し、<code>NgcSet : NO</code> となっていることを確認します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /status</span><br></pre></td></tr></table></figure></li></ol><h2 id="anchor3">3. 事前準備: Intune の登録解除</h2><p><strong>Intune 登録していなければスキップください。</strong></p><ol><li><p>[Microsoft Intune admin center (endpoint.microsoft.com)] &gt; [デバイス] &gt; [すべてのデバイス] から該当デバイスを検索し、存在する場合は対象デバイスを開いて [削除] ボタンをクリックして削除します (削除完了するまでに少し時間がかかります)。</p></li><li><p>対象のデバイス上で、[PowerShell] を <strong>管理者権限</strong> で実行します。</p></li><li><p>以下のコマンドを実行し、Enrollment ID (GUID の形式となる想定) が表示されるかを確認します。 <strong><span style="color: red; ">(表示されない場合は以下の 4. から 7. の手順は実施しないでください)</span></strong>****</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-ChildItem HKLM:\Software\Microsoft\Enrollments | ForEach-Object &#123;Get-ItemProperty $_.pspath&#125; | where-object &#123;$_.DiscoveryServiceFullURL&#125; | Foreach-Object &#123;$_.PSChildName&#125;</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し、Enrollment ID を変数に格納します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$EnrollmentGUID = Get-ChildItem HKLM:\Software\Microsoft\Enrollments | ForEach-Object &#123;Get-ItemProperty $_.pspath&#125; | where-object &#123;$_.DiscoveryServiceFullURL&#125; | Foreach-Object &#123;$_.PSChildName&#125;</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し削除対象のレジストリを変数に格納します。(長いですが 1 行のコマンドです)</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$RegistryKeys = &quot;HKLM:\SOFTWARE\Microsoft\Enrollments&quot;, &quot;HKLM:\SOFTWARE\Microsoft\Enrollments\Status&quot;,&quot;HKLM:\SOFTWARE\Microsoft\EnterpriseResourceManager\Tracked&quot;, &quot;HKLM:\SOFTWARE\Microsoft\PolicyManager\AdmxInstalled&quot;, &quot;HKLM:\SOFTWARE\Microsoft\PolicyManager\Providers&quot;,&quot;HKLM:\SOFTWARE\Microsoft\Provisioning\OMADM\Accounts&quot;, &quot;HKLM:\SOFTWARE\Microsoft\Provisioning\OMADM\Logger&quot;, &quot;HKLM:\SOFTWARE\Microsoft\Provisioning\OMADM\Sessions&quot;</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し、デバイス登録情報に関するレジストリを削除します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">foreach ($Key in $RegistryKeys) &#123;if (Test-Path -Path $Key) &#123;Get-ChildItem -Path $Key | Where-Object &#123;$_.Name -match $EnrollmentGUID&#125; | Remove-Item -Recurse -Force -Confirm:$false -ErrorAction SilentlyContinue&#125;&#125;</span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行し、デバイス登録のタスクを削除します。 <strong><span style="color: red; ">変数 $EnrollmentGUID がブランクの状態で以下のコマンドを実行すると必要なタスクも削除されるため注意してください。</span></strong></p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-ScheduledTask | Where-Object &#123;$_.Taskpath -match $EnrollmentGUID&#125; | Unregister-ScheduledTask -Confirm:$false</span><br></pre></td></tr></table></figure></li></ol><h2 id="anchor4">4. HAADJ 再構成: 既存情報のクリア</h2><p>実際に HAADJ の再登録を行うに際して既存の情報をクリアしておきます。</p><ol><li><p>対象のデバイスにて <strong>管理者権限</strong> でコマンド プロンプトを起動し、次のコマンドで HAADJ を解除します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /leave</span><br></pre></td></tr></table></figure></li><li><p>次のコマンドで <code>AzureAdJoined : NO</code> となっていることを確認します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /status</span><br></pre></td></tr></table></figure></li><li><p>オンプレミスの Active Directory にて、[Active Directory ユーザーとコンピューター] を開き、[表示(V)] &gt; [拡張機能(V)] を有効にします。(すでに有効であればスキップしてください)</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-3.png"></p></li><li><p>[Active Directory ユーザーとコンピューター] にて対象のコンピューター アカウントを探し、右クリックから [プロパティ] を開きます (誤ったオブジェクトを操作しないよう直接対象のコンピューター アカウントを探すことをお勧めします。)</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-4.png"></p></li><li><p>[属性エディター] から [userCertificate] を選択し、[編集(E)] を選択します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-5.png"></p></li><li><p>[削除(R)] してから [OK] を選択します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-6.png"></p></li><li><p>[userCertificate] が &lt;未設定&gt; となっていることを確認したら [OK] を選択して閉じます。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration4-7.png"></p></li><li><p>AADC の同期 (既定では 30 分間隔) を待ち、[Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] にて対象のデバイス オブジェクトが削除されていることを確認します。</p></li></ol><h2 id="anchor5">5. HAADJ 再構成: 改めて構成</h2><p>以下の手順で実際に再構成を行います。</p><ol><li><p>対象のデバイスを再起動したのち、対象のユーザーでサインインします。</p></li><li><p>対象のデバイスがオンプレミスの Active Directory にアクセスできるネットワーク環境に接続していることを確認します (社内ネットワーク環境に接続するなど)。</p></li><li><p><strong>管理者権限</strong> でタスク スケジューラを起動し [タスク スケジューラ ライブラリ] &gt; [Microsoft] &gt; [Windows] &gt; [Workplace Join] を開きます。</p></li><li><p>[Automatic-Device-Join] を 右クリックし [実行する(R)] を選択します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration5-4.png"></p></li><li><p>オンプレミスの Active Directory にて対象のコンピューター アカウントに userCertificate に値が書き込まれたことを確認します (上記「4. HAADJ 再構成: 既存情報のクリア」の 3 から 5 の手順を参考)。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration5-5.png"></p></li><li><p>AADC の同期 (既定では 30 分間隔) を経て [Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] に対象のデバイス オブジェクトが同期されたことを確認します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration5-6.png"></p></li><li><p>Azure AD への同期を確認後、再度 [Automatic-Device-Join] を実行します。(3 から 4 の手順を参考)</p></li><li><p>コマンド プロンプトを起動し次のコマンドを実行し <code>AzureAdJoined : YES</code> となっていることを確認します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /status</span><br></pre></td></tr></table></figure></li><li><p>[Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] で対象のデバイス オブジェクトの [登録済み] の項目が「保留中」から現在の日付に遷移したことを確認します。</p><p> <img src="/blog/azure-active-directory/haadj-re-registration/haadj-re-registration5-9.png"></p></li><li><p>対象デバイスにて 画面のロック &gt; アンロック をすることで プライマリ更新トークン (PRT) を取得します。(すぐにアンロックしていただいて問題ありません)</p></li><li><p>対象のデバイスにて対象の <strong>ユーザー権限</strong> でコマンド プロンプトを起動し、次のコマンドを実行して <code>AzureAdPrt : YES</code> となっていることを確認します (管理者として実行から起動しないようご注意ください)。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dsregcmd /status</span><br></pre></td></tr></table></figure></li></ol><h2 id="anchor6">6. 事後確認: Intune の登録</h2><p><strong>この手順は Intune 登録しなければ不要です。</strong> また、反映に時間がかかることがあります。</p><ol><li> [Azure Portal (portal.azure.com)] &gt; [Azure Active Directory] &gt; [デバイス] &gt; [すべてのデバイス] で対象のデバイス オブジェクトの [MDM] の項目に値が入り [準拠している] が「はい」となっていることを確認します。</li><li>[Microsoft Intune admin center (endpoint.microsoft.com)] &gt; [デバイス] &gt; [すべてのデバイス] から該当デバイスを検索し対象デバイスの [対応] の項目が「準拠している」となっていることを確認します。</li></ol><h2 id="anchor7">7. 事後作業: WHfB の再プロビジョニング</h2><p><strong>WHfB を利用していなければ不要です。</strong></p><ol><li>端末を再起動します。</li><li>対象のユーザーでサインインすると WHfB のプロビジョニングが自動的に始まりますのでウィザードに沿ってセットアップします (ウィザードの中で多要素認証が要求されます)。</li></ol><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>以上、HAADJ の再構成手順が運用の助けになると嬉しく思います。製品動作に関する正式な見解や回答については、お客様環境などを十分に把握したうえでサポート部門より提供しますので、ぜひ弊社サポート サービスをご利用ください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの長谷川です。&lt;/p&gt;
&lt;p&gt;この記事では、対象デバイスのハイブリッド Azure AD 参加 (略称 HAADJ) を再構成する手順を紹介します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Troubleshooting" scheme="https://jpazureid.github.io/blog/tags/Troubleshooting/"/>
    
    <category term="Hybrid Azure AD Join" scheme="https://jpazureid.github.io/blog/tags/Hybrid-Azure-AD-Join/"/>
    
  </entry>
  
  <entry>
    <title>「破壊的 PIN リセット」と「非破壊的 PIN リセット」の違い</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/non-destructive-pin-reset/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/non-destructive-pin-reset/</id>
    <published>2023-04-23T00:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.461Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの長谷川です。</p><p>この記事では、Windows Hello for Business における「破壊的 PIN リセット」と「非破壊的 PIN リセット」の違いについて、公開情報を補足する形で説明します。基本的には、次の公開情報に記載のある通りですが、本記事でもう少しわかりやすい説明を目指します。「破壊的 PIN リセット」と「非破壊的 PIN リセット」の意味についても下記資料に説明がございますのでご覧ください。</p><p><a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune">暗証番号 (PIN) のリセット</a></p><h2 id="PIN-をリセットした後のユーザー体験に違いはあるか？"><a href="#PIN-をリセットした後のユーザー体験に違いはあるか？" class="headerlink" title="PIN をリセットした後のユーザー体験に違いはあるか？"></a>PIN をリセットした後のユーザー体験に違いはあるか？</h2><p>「破壊的 PIN リセット」と「非破壊的 PIN リセット」の運用中の動作としては、ハイブリッド Azure AD 参加デバイスにおいて PIN をリセットした場合、その後に Azure AD Connect (略称 AADC) による同期が必要かどうかが大きな違いです。</p><p>キー信頼の環境で「破壊的 PIN リセット」を実行した場合、PIN がリセットされた後に AADC を介して Azure AD から オンプレミスの AD ユーザーに対して msDS-KeyCredentialLink 属性への書き戻しが行われます。これが完了するまで、新しい PIN で Windows にサインインすることはできません。つまり、キー信頼の環境で「破壊的 PIN リセット」を実行した場合、新しい PIN を利用するためには AADC の同期 (既定で 30 分間隔) を待つ必要があります。</p><p>一方、「非破壊的 PIN リセット」ではオンプレミス AD ユーザーの msDS-KeyCredentialLink 属性の値が変更されません。このため、AADC の同期を待つことなく新しい PIN ですぐにサインインすることができます。このように、「破壊的 PIN リセット」と「非破壊的 PIN リセット」では、PIN リセット後の待ち時間に違いがあります。</p><h2 id="PIN-のリセット手順に違いはあるか？"><a href="#PIN-のリセット手順に違いはあるか？" class="headerlink" title="PIN のリセット手順に違いはあるか？"></a>PIN のリセット手順に違いはあるか？</h2><p>いいえ、PIN のリセット手順に違いはありません。「破壊的 PIN リセット」と「非破壊的 PIN リセット」は、どちらも同じ手順になります。これは、<a href="https://learn.microsoft.com/en-us/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune#using-pin-reset">Using PIN reset</a> の公開情報にも記載があります。</p><blockquote><p>英語: Destructive and non-destructive PIN reset use the same steps for initiating a PIN reset.<br>日本語: 破壊的および非破壊的な PIN リセットでは、PIN リセットを開始するために同じ手順を使用します。</p></blockquote><p>よって、<a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune#reset-pin-from-settings">設定からの PIN のリセット</a> に従って次の手順で PIN をリセットした場合、「破壊的 PIN リセット」と「非破壊的 PIN リセット」のどちらになるかは構成 (後述) に依存します。</p><blockquote><ol><li>別の資格情報を使用してWindows 10にサインインします。  </li><li>[設定] を開き、[アカウントの&gt;サインイン オプション] を選択します。  </li><li>[PIN (Windows Hello)PIN を忘れた場合] &gt; を選択し、指示に従います。</li></ol></blockquote><h2 id="「破壊的-PIN-リセット」と「非破壊的-PIN-リセット」のどちらの動作になるか？"><a href="#「破壊的-PIN-リセット」と「非破壊的-PIN-リセット」のどちらの動作になるか？" class="headerlink" title="「破壊的 PIN リセット」と「非破壊的 PIN リセット」のどちらの動作になるか？"></a>「破壊的 PIN リセット」と「非破壊的 PIN リセット」のどちらの動作になるか？</h2><p>PIN 回復機能の有効/無効で、「破壊的 PIN リセット」と「非破壊的 PIN リセット」のどちらの動作になるかが変わります。</p><p>PIN 回復機能が有効/無効であるかの確認方法は、<a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune#confirm-that-pin-recovery-policy-is-enforced-on-the-devices">PIN 回復ポリシーがデバイスに適用されていることを確認する</a> の公開情報にまとめられています。</p><blockquote><p>PIN リセット構成は、コマンド ラインから dsregcmd /status を実行することで表示できます。この状態は、CanReset 行項目としてユーザー状態セクションの出力の下にあります。CanReset が DestructiveOnly と報告された場合、破壊的 PIN リセットのみが有効になります。CanReset で DestructiveAndNonDestructive が報告された場合、非破壊 PIN リセットが有効になります。</p></blockquote><h2 id="次のようなエラー画面が表示された場合どうしたらよいか？"><a href="#次のようなエラー画面が表示された場合どうしたらよいか？" class="headerlink" title="次のようなエラー画面が表示された場合どうしたらよいか？"></a>次のようなエラー画面が表示された場合どうしたらよいか？</h2><p>次の画像のような、エラーコード CAA20004 かつサーバー メッセージが AADSTS650052 で Microsoft Pin Reset Service Production のエラーが表示される場合があります。</p><p><img src="/blog/azure-active-directory/non-destructive-pin-reset/non-destructive-pin-reset-CAA20004.png"></p><p>この場合、<a href="https://learn.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-feature-pin-reset?tabs=intune#enable-the-microsoft-pin-reset-service-in-your-azure-ad-tenant">Azure AD テナントで Microsoft PIN リセット サービスを有効にする</a> の公開情報に沿って “PIN リセット サービス” と “PIN リセット クライアント” という 2 つのサービスの登録作業を行うことでエラーが解消されるかご確認ください。</p><blockquote><p>PIN をリモートでリセットするには、Azure Active Directory テナントに次の 2 つのアプリケーションを登録する必要があります。<br>・PIN リセット サービス<br>・PIN リセット クライアント</p></blockquote><p>上記の補足が PIN リセットの活用に役立つと嬉しく思います。上記以外で PIN のリセットに関して不明点がある場合は、是非弊社サポートまでお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの長谷川です。&lt;/p&gt;
&lt;p&gt;この記事では、Windows Hello for Business における「破壊的 PIN リセット」と「非破壊的 PIN リセット」の違いについて、公開情報を補足する形で</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Windows Hello for Business" scheme="https://jpazureid.github.io/blog/tags/Windows-Hello-for-Business/"/>
    
    <category term="PIN" scheme="https://jpazureid.github.io/blog/tags/PIN/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD B2C の認可コードと更新トークンのサイズが増加します</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-b2c-authorization-code-and-refresh-token-size-increase/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-b2c-authorization-code-and-refresh-token-size-increase/</id>
    <published>2023-04-20T20:00:00.000Z</published>
    <updated>2023-05-13T23:48:48.977Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 3 月 17 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad/azure-ad-b2c-authorization-code-and-refresh-token-size-increase/m-p/3770890">Azure AD B2C authorization code and refresh token size increase update</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p><a href="https://www.microsoft.com/ja-jp/security/business/identity-access/azure-active-directory-external-identities">Microsoft Entra (Azure Active Directory)</a> では、継続的なセキュリティ改善の取り組みの一環として、Azure AD B2C に対し、アプリケーションに返される OAuth 2.0 (および OpenID Connect) の応答フォーマットの変更を展開しました。この結果、Azure AD B2C が発行する認可コードと更新トークンのサイズが増加します。これにより、アプリケーションが OAuth 2.0 の認可コードをクエリ文字列パラメーターまたは URL フラグメントとして受け入れるように構成されている場合、ユーザーに影響が生じる可能性があります。具体的には以下のような場合が挙げられます。</p><ul><li>Internet Explorer などの古いウェブ ブラウザーを使用しているユーザーは、URL の長さの制限に抵触する可能性がある。</li><li>アプリケーションを Web サーバー上で実行している場合、特にアプリが長い URL 文字数を許容しないファイアウォールやリバース プロキシの背後にある場合、URL の長さの制限に抵触する可能性がある。</li></ul><p>OAuth 2.0 (および OpenID Connect) プロトコルでは、認可コードがアプリケーションに返される方法を、3 つの応答モード (response_mode) にて指定可能です。<strong>query</strong> および <strong>fragment</strong> モードでは、それぞれ認可コードがクエリ パラメーターおよび URL フラグメントとして返されます。<strong>form_post</strong> モードでは、応答のパラメータは HTML のフォームの値としてエンコードされ、HTML 本文にエンコードされて HTTP POST メソッドで送信されます。詳細については、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/authorization-code-flow">Azure Active Directory B2CのOAuth 2.0 認可コード フロー</a> の記事をご確認ください。</p><p>認可コードと更新トークンのサイズが増加した結果、URL が長くなることで問題が生じた場合、これを解消するためには以下を検討ください。</p><ul><li>Web アプリケーションの場合、アプリケーションに最も安全にトークンを渡せるよう、OAuth 2.0 の response_mode を form_post に設定する。</li><li>認可コード フローと PKCE を使用するシングル ページ アプリケーションでは、アプリケーションに渡されるクレームの数を減らす。Azure AD B2C の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/configure-user-input?pivots=b2c-user-flow#provide-optional-claims-to-your-app">ユーザー フロー</a> および <a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/configure-user-input?pivots=b2c-custom-policy#include-a-claim-in-the-token">カスタム ポリシー</a> で、アプリケーションにとって不要なクレームがあれば、それらを削除します。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/userinfo-endpoint?pivots=b2c-custom-policy">UserInfo エンドポイント</a> を使用して、認証されたユーザーに関するクレームを返すこともご検討ください。これにより、認可コードと更新トークンのサイズが最小化され、事象を回避できると想定されます。</li><li>この変更は、モバイル アプリやデスクトップ アプリなど、デバイスにインストールされたアプリには影響しないと想定されます。</li></ul><p>この変更は、上述のとおり更新トークンのサイズにも影響します。MSAL ライブラリは、トークンを取得した後に <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-acquire-cache-tokens">キャッシュ</a> します。インメモリ キャッシュや <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-net-token-cache-serialization?tabs=aspnet#distributed-token-caches">分散トークン キャッシュ</a> を使用している Web アプリケーションでは、キャッシュの仕組みがより大きい更新トークンのサイズを処理できることを確認するか、前節で説明したように更新トークンのサイズを極力小さくするようご対応ください。</p><p>Yoel</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 17 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された &lt;a href=&quot;https://tec</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Azure AD B2C" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2C/"/>
    
  </entry>
  
  <entry>
    <title>2023 State of Cloud Permissions Risks レポートを公開しました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/2023-state-of-cloud-permissions-risks-report-now-published/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/2023-state-of-cloud-permissions-risks-report-now-published/</id>
    <published>2023-04-18T00:00:00.000Z</published>
    <updated>2023-05-13T23:48:48.905Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 3 月 28 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/2023-state-of-cloud-permissions-risks-report-now-published/ba-p/1061397">2023 State of Cloud Permissions Risks report now published</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>組織がマルチクラウドのインフラを受け入れ、採用するようになったことで、3 つの主要なクラウド プラットフォーム: Microsoft Azure, アマゾン ウェブ サービス (AWS), Google Cloud Platform (GCP) において ID のアクセス許可の数が増加しています。この変化はイノベーションの新たな機会をもたらす一方で、組織がこれまで直面したことのない新たなアクセス許可に関する課題をもたらしています。</p><p>本日は、<a href="https://aka.ms/CloudPermissionsRisksReport">2023 State of Cloud Permissions Risks レポート</a> を発表できることを大変うれしく思います。本レポートでは、マルチクラウドのインフラにおける ID とアクセス許可にまつわる主要なリスク所見を取り上げています。</p><p><img src="/blog/azure-active-directory/2023-state-of-cloud-permissions-risks-report-now-published/2023-state-of-cloud-permissions-risks-report-now-published.png"></p><p>今年は、ワークロード ID とスーパー管理者について、驚くべき知見が見つかりました。これらのリスクを見て、改善策を探っていきましょう:</p><p><strong>ワークロード ID</strong></p><p>今日のマルチクラウドの世界では、マルチクラウドのインフラにアクセスするのはもはや人間の ID だけではありません。アプリ、VM、スクリプト、コンテナ、サービスなど、クラウド上で動作するワークロード ID の数は指数関数的に増加しており、今や人間の ID の数を 10 対 1 で上回っています。</p><p>さらに、非アクティブなワークロード ID の平均割合は 80% に上っており、これは 2021 年から倍増しており、付与されたアクセス許可のうちワークロード ID が使用しているのは 5% 未満です。このリスクを低減するために、最近 Microsoft Entra ワークロード ID 内で <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/recommendation-remove-unused-apps">アプリの正常性に関する推奨事項</a> のプレビューを開始し、非アクティブなアプリや期限切れの認証情報を簡単に特定できるようにしました。</p><p>クラウド インフラにアクセスするワークロード ID が増加する中、組織はそのアクセスを監視し、侵害のリスクを低減することが重要です。</p><p><strong>スーパー管理者</strong></p><p>スーパー管理者は、すべてのアクセス許可とすべてのリソースにアクセスできる人間またはワークロードの ID です。スーパー管理者はサービスに対する構成の作成と変更、ID の追加と削除、データへのアクセスと削除さえも行うことができます。これは非常に強すぎる権限ですが、私たちの調査では、このスーパー管理者に付与された権限のうち、実際に使用されているのは 2% 未満であり、スーパー管理者の 40% はワークロード ID であることが判明しました。</p><p>監視されないまま放置されたこれらの ID は、侵害された場合、アクセス許可が悪用される重大なリスクとなります。</p><h2 id="マルチクラウドにおける権限のリスクの管理と修復"><a href="#マルチクラウドにおける権限のリスクの管理と修復" class="headerlink" title="マルチクラウドにおける権限のリスクの管理と修復"></a>マルチクラウドにおける権限のリスクの管理と修復</h2><p>アクセス許可のギャップを解消し、権限の誤用のリスクを減らすには、組織が最小特権の原則を実施する必要があります。これは、マルチクラウド環境におけるすべての人間およびワークロードの ID に対して一貫して行われる必要があります。組織は、クラウド インフラストラクチャ エンタイトルメント管理 (CIEM) ソリューションを採用し、マルチクラウドにまたがるすべての一意なユーザーおよびワークロード ID の活動を継続的に発見、修復、監視することによって、クラウド規模でこれを実現することが必要です。</p><p>マイクロソフトの CIEM ソリューションである Microsoft Entra Permissions Management は以下の 3 つの方法でクラウド上のアクセス許可に起因したマルチクラウドの攻撃範囲の拡大を防ぎます:</p><ol><li>発見する: アクセス許可のリスクを評価し、どのような ID がいつ、どこで、何をしたかを特定します。</li><li>修復する: 最小特権の原則を実現するために、必要に応じた Just-In-Time の権限付与を行います。</li><li>監視する: セキュリティの脅威を防ぐために、クラウド上での権限の使用状況を継続的に監視します。</li></ol><p>Microsoft Entra Permission Management を通じ、弊社ではマルチクラウド環境全体で特に懸念されるアクセス許可のリスクを特定するためのマルチクラウドのリスク評価を無料で提供しています。マルチクラウドでのアクセス許可のリスクについての詳細は、<a href="https://aka.ms/CloudPermissionsRisksReport">2023 State of Cloud Permissions Risks レポート</a> をダウンロードしてご覧ください。また、今すぐ無料のリスク評価を開始することでインフラの安全確保への第一歩を踏み出してください。</p><ul><li>2023 State of Cloud Permissions Risks レポートは <a href="https://aka.ms/CloudPermissionsRisksReport">こちら</a></li><li>クラウド権限リスクが組織に与える影響について詳しくは <a href="https://aka.ms/PermissionRisksInfographic">こちら</a></li><li>Microsoft Entra Permission Management について詳しくは <a href="https://www.microsoft.com/ja-jp/security/business/identity-access/microsoft-entra-permissions-management">こちら</a> </li><li><a href="https://aka.ms/TryPermissionsManagement">マルチクラウドのリスク評価を無料で開始しましょう！</a> </li></ul><p>Alex Simons (@Alex_A_Simons)<br>Corporate Vice President of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 28 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD DS におけるカスタム属性がパブリック プレビューになりました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/custom-attribute-aadds-preview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/custom-attribute-aadds-preview/</id>
    <published>2023-04-17T00:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.165Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure ID チームの小出です。</p><p>本記事は、2023 年 3 月 30 日に公開されました <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/custom-attributes-for-azure-active-directory-domain-services-now/ba-p/3778049">Custom attributes for Azure Active Directory Domain Services now in Public Preview</a> の記事を日本語に意訳した内容になります。ご不明点などございましたらお気軽にサポートまでお問い合わせください。</p><hr><p>皆さん、こんにちは！</p><p>今日は、Azure Active Directory Domain Services (Azure AD DS) インスタンスの新しい機能拡張をご紹介します。 </p><p><img src="/blog/azure-active-directory/custom-attribute-aadds-preview/custom-attribute-aadds-preview1.png"></p><p>この新機能により、Azure AD DS マネージド ドメインで、カスタム属性を使用することができるようになります。 </p><h2 id="カスタム属性-パブリック-プレビュー"><a href="#カスタム属性-パブリック-プレビュー" class="headerlink" title="カスタム属性 (パブリック プレビュー)"></a>カスタム属性 (パブリック プレビュー)</h2><p>様々な理由から、企業はレガシー アプリのコードを修正しない、または修正できないことがよくあります。これらのレガシー アプリでは、ディレクトリのカスタム従業員 ID などのカスタム属性を利用し、アプリの LDAP 呼び出しでこれらの属性を活用している場合もあると思います。Azure Active Directory (Azure AD) は、これらの拡張ユーザー属性を onPremisesExtensionAttributes という属性セットに格納し (Azure AD Connect 経由で構成した場合)、拡張アプリ属性を Directory Extensions という機能に格納しています。しかしながら、これら 2 つの拡張セットはどちらも、以前は Azure AD Domain Services に同期されていませんでした。  </p><p>Azure AD DS で Azure AD からカスタム属性/拡張機能を同期できるようにすることで、これまで移行できなかったカスタム属性/拡張機能に依存するアプリをすべて移行できるようになり、より多くのお客様に Azure AD DS をご利用いただけるようになりました。</p><p><img src="/blog/azure-active-directory/custom-attribute-aadds-preview/custom-attribute-aadds-preview2.png"></p><p>カスタム属性の詳細については、こちらのドキュメントを参照ください: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory-domain-services/concepts-custom-attributes">Azure AD Domain Services のカスタム属性の作成と管理</a></p><p>Azure AD DS は、今後も多くの発表を控えています！Azure ADですべてのアプリをよりシンプルに管理できるようにするため、最新のアップデートにご注目ください。</p><p>いつもどおり、皆様からのフィードバックや提案をお待ちしております。ご意見がございましたら、Twitter (<a href="https://twitter.com/azuread">@AzureAD</a>) までお寄せください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 30 日に公開されました &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-bl</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD のメンバー ユーザーとゲスト ユーザー</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/member-and-guest-user/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/member-and-guest-user/</id>
    <published>2023-04-16T01:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.365Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/12/azuread-member-guest/">https://blogs.technet.microsoft.com/jpazureid/2017/12/12/azuread-member-guest/</a> の内容を移行したものです。</p><p>元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017/12/12: 本記事の初版を投稿</p><p>2018/02/26: Microsoft Connect のリタイアに伴い MSOnline モジュールのダウンロードができなくなったため記載を変更</p><p>2018/10/31: メンバーとゲストの既定のアクセス許可の比較情報のリンクを追加</p><p>2023/04/16: Msol コマンドのリタイアに伴い Microsoft Graph コマンドでの実施方法に更新  </p></div><p>こんにちは、Azure &amp; Identity サポート チームの三輪です。</p><p>Azure AD に所属しているユーザーの種類として、下記のように「メンバー」と「ゲスト」があります。今回は、こちらのユーザーの種類について説明します。</p><p><img src="/blog/azure-active-directory/member-and-guest-user/member-and-guest-new.png"></p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>下記のように、個人アカウントや別テナントの職場または学校アカウント (組織アカウント) を追加した (Azure AD B2B の機能を利用した) 場合に、ユーザーの種類が「ゲスト」として追加されます。</p><p><img src="/blog/azure-active-directory/member-and-guest-user/personal-work-account.png"></p><p>これ以外の Azure のサブスクリプションのサインアップで利用した個人アカウントや組織内のドメイン (上記の例の場合: contso.com) をユーザー名 (例: <a href="mailto:&#x74;&#101;&#x73;&#116;&#64;&#x63;&#111;&#x6e;&#x74;&#111;&#115;&#111;&#46;&#x63;&#111;&#109;">&#x74;&#101;&#x73;&#116;&#64;&#x63;&#111;&#x6e;&#x74;&#111;&#115;&#111;&#46;&#x63;&#111;&#109;</a>) に持つユーザーは「メンバー」として登録されます。また、現在は利用できないクラシック ポータル (旧ポータル) より追加した外部ユーザーについては「メンバー」として登録されております。</p><h2 id="詳細"><a href="#詳細" class="headerlink" title="詳細"></a>詳細</h2><p>既定ではゲスト ユーザーに対しては、 Azure AD のデータへのアクセスが制限されています。このため、ゲスト ユーザーで Azure AD テナントにサインインした場合、招待された Azure AD のユーザーの一覧を参照することはできませんし、各種設定の参照および変更も制限されています。もちろん、サブスクリプションに対する権限を付与していない場合は、サブスクリプションのリソースを操作することもできません。一般ユーザーとゲスト ユーザーがそれぞれできること (アクセス許可の比較) は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/users-default-permissions#compare-member-and-guest-default-permissions">こちら</a>をご参照ください。</p><p><img src="/blog/azure-active-directory/member-and-guest-user/access-denied-new.png"></p><p><img src="/blog/azure-active-directory/member-and-guest-user/no-access-permission-new.png"></p><p>ゲストに対するアクセス制限は、[すべてのユーザー] - [ユーザー設定] - [外部コラボレーションの設定を管理します] と辿り [ゲストのアクセス制限] で変更できます。この設定が “ゲスト ユーザーは、ディレクトリ オブジェクトのプロパティとメンバーシップへのアクセスが制限されます” (既定値) の場合には「ゲスト」の操作は上記のように制限されています。外部コラボレーションの設定については、<a href="https://jpazureid.github.io/blog/azure-active-directory/external-collaboration-setting-b2b-access/">こちら</a> をご参照ください。</p><p><img src="/blog/azure-active-directory/member-and-guest-user/guest-users-permissions-are-limited1-new.png"></p><p><img src="/blog/azure-active-directory/member-and-guest-user/guest-users-permissions-are-limited2-new.png"></p><p>ユーザーの属性については、Azure ポータル上での操作、または PowerShell の実行により、メンバーからゲスト、またその逆についても変更が可能です。ゲストからメンバーに変更する際は「ゲスト」に対して行っていた制御の対象外のユーザーとなるため、セキュリティ ポリシーに沿った対応や特定のユーザーに絞った設定変更をお勧め致します。</p><h2 id="ユーザー-タイプの変更手順"><a href="#ユーザー-タイプの変更手順" class="headerlink" title="ユーザー タイプの変更手順"></a>ユーザー タイプの変更手順</h2><h3 id="Azure-ポータル上の操作で該当ユーザーを-ゲストからメンバーに変更する手順"><a href="#Azure-ポータル上の操作で該当ユーザーを-ゲストからメンバーに変更する手順" class="headerlink" title="Azure ポータル上の操作で該当ユーザーを ゲストからメンバーに変更する手順"></a>Azure ポータル上の操作で該当ユーザーを ゲストからメンバーに変更する手順</h3><ol><li>管理者権限で Azure ポータルにサインインします。</li><li>Azure Active Directory を開き、[ユーザー] を開きます。</li><li>ユーザー タイプを変更したいユーザーを開きます。</li><li>[プロパティの編集] をクリックします。<br>ユーザーの種類のタブを [メンバー] に変更し、[保存] をクリックします。</li></ol><h3 id="PowerShell-を実行して該当ユーザーをゲストからメンバーに変更する手順"><a href="#PowerShell-を実行して該当ユーザーをゲストからメンバーに変更する手順" class="headerlink" title="PowerShell を実行して該当ユーザーをゲストからメンバーに変更する手順"></a>PowerShell を実行して該当ユーザーをゲストからメンバーに変更する手順</h3><p>この作業を実施するためには、Azure AD 用の PowerShell を利用する必要がありますが、 PowerShell を利用する際には Microsoft アカウントではなく、組織アカウントでのグローバル管理者が必要です (Azure AD の PowerShell については <a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">リンク</a> も参照ください)。そのために次の手順で実施する必要があります。</p><ol><li>Azure AD のグローバル管理者アカウントを作成する (※すでに組織アカウントのグローバル管理者が存在する場合はスキップ)</li><li>PowerShell を実行し、該当ユーザーを Guest から Member に変更する</li></ol><p>まず、1. の手順として、Azure AD のグローバル管理者アカウントを作成します。すでに組織アカウントのグローバル管理者が存在する場合はスキップください。</p><ol><li>[ユーザー] - [＋新しいユーザー] と辿り、 [ 新しいユーザーの作成]  をクリックします。</li><li>ユーザー名と名前欄に admin などの任意の値を入力します。</li><li>[役割]をクリックし、ディレクトリ ロール欄で “グローバル管理者” を選択し、 [選択] をクリックします。</li><li>“パスワードを表示” をクリックし、パスワードを控えて [作成] をクリックします。</li></ol><p>次に、2. の手順として、PowerShell を実行し、該当ユーザーを Guest から Member に変更します。以下の手順を順に実行ください。</p><ol><li><p>PowerShell を起動します。</p><p> ※ モジュールの入手方法については、弊社<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">ブログ</a> をご参照ください。Graph PowerShell SDK のモジュールの利用をお願いします。</p></li><li><p>以下のコマンドを実行します。</p><p> Connect-MgGraph -Scope “User.ReadWrite.All”</p></li><li><p>資格情報の入力を求められるため、1 で作成したアカウントの情報を入力します。パスワードの変更が求められるはずですので、パスワードを新しく設定します。</p></li><li><p>以下のコマンドを実行して、対象ユーザーの UserPrincipalName および UserType 属性値を確認します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgUser</span> <span class="literal">-All</span> <span class="literal">-Property</span> UserPrincipalName,UserType | <span class="built_in">Format-Table</span> UserPrincipalName,UserType</span><br></pre></td></tr></table></figure><p> 出力例:</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">UserPrincipalName                             UserType</span><br><span class="line">user_live.com<span class="comment">#EXT#@contoso.onmicrosoft.com    Guest  -&gt; 「Guest」 であることが確認できます。</span></span><br></pre></td></tr></table></figure></li><li><p>以下のコマンドを実行して、対象ユーザーの UserType を 「Member」 に変更します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> &lt;対象ユーザーの オブジェクトID または UserPrincipalName&gt; <span class="literal">-UserType</span> Member</span><br></pre></td></tr></table></figure><p> 実行例:</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> user_live.com<span class="comment">#EXT#@contoso.onmicrosoft.com -UserType Member</span></span><br></pre></td></tr></table></figure></li><li><p>再度以下のコマンドを実行して、対象ユーザーの UserType を確認します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgUser</span> <span class="literal">-All</span> <span class="literal">-Property</span> UserPrincipalName,UserType | <span class="built_in">Format-Table</span> UserPrincipalName,UserType</span><br></pre></td></tr></table></figure><p>出力例:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">UserPrincipalName                             UserType</span><br><span class="line">user_live.com<span class="comment">#EXT#@contoso.onmicrosoft.com    Member  -&gt; 変更されたことを確認します。</span></span><br></pre></td></tr></table></figure></li></ol><p>なお、「Member」から「Guest」に変更する場合は、UserType に「Guest」を指定します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> &lt;対象ユーザーの オブジェクトID または UserPrincipalName&gt; <span class="literal">-UserType</span> Guest</span><br></pre></td></tr></table></figure><p>上記内容が少しでも皆様の参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>Azure ポータルへのアクセス制限</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/access-restriction-azure-portal/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/access-restriction-azure-portal/</id>
    <published>2023-04-16T00:30:00.000Z</published>
    <updated>2023-05-13T23:48:48.949Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/29/azuread-portal/">https://blogs.technet.microsoft.com/jpazureid/2017/12/29/azuread-portal/</a> の内容を移行したものです。</p><p>元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017-12-29: 本記事の初版を投稿</p><p>2023-04-16: MSOL コマンドのリタイアに伴い内容を全体的に更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの三輪です。</p><p>今回は、一般ユーザーに対して Azure ポータルへのアクセスを制限する方法について紹介します。</p><p>Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) には、サブスクリプションの有無によらずログインすることが可能です。この動作変更により、ユーザーが簡単に Azure に対してアクセスできるようになっています。</p><p>Azure ポータルからは、そのログインしたユーザーが所属する Azure AD ディレクトリにアクセスすることができ、このとき Azure AD に対しての管理者権限を持たない一般ユーザーであっても、既定では Azure AD に登録されているユーザーの一覧を参照できるようになっています。これは <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/users-default-permissions">ドキュメント</a> にも記載されていることで、一般ユーザーは他のユーザーの基本情報を見ることが可能であり、この動作自体は Azure AD で想定されるものです。</p><p>Azure ポータルへ一般ユーザーがアクセスできたとしても、一般ユーザーの権限以上のことはできません。例えば、テナントやユーザーの構成を変更したり、詳細を確認することはできません。上述のとおり、他のユーザーの一覧 (基本情報) を確認することは既定で可能ですが、これは Office 365 を利用する中で他のユーザーを参照できるのと同等です。Azure AD は組織内のユーザーの認証とコラボレーションを促進するディレクトリ サービスであるため、他のユーザーが参照できることはその機能の一部であり問題ではありません。</p><p>Azure ポータルへのアクセスを制限しても、ユーザーは Office 365 のサービス (Exchange や Teams) を利用して他のユーザーの情報を確認可能であることにご注意ください。また、Azure AD 以外の項目、例えば仮想マシンなどのリソースに対しては、サブスクリプションの権限を明示的に付与しない限りは、各ユーザーは参照することもできませんのでご安心ください。</p><p>ただし、上記を踏まえてもお客様の運用形態によっては、Azure ポータル上やその他の方法で他のユーザーの一覧が見えてしまうことが運用上好ましくない場合もあると思います。今回は、このような一般ユーザーによる他のユーザーの参照や管理ツールへのアクセスをできる限り制限する方法についておまとめしました。</p><h2 id="Azure-ポータルを含めた-Azure-の管理ツール全般へのアクセスを制限する方法"><a href="#Azure-ポータルを含めた-Azure-の管理ツール全般へのアクセスを制限する方法" class="headerlink" title="Azure ポータルを含めた Azure の管理ツール全般へのアクセスを制限する方法"></a>Azure ポータルを含めた Azure の管理ツール全般へのアクセスを制限する方法</h2><p>Azure ポータルやその他 Azure CLI など管理ツールへのアクセスを限られたユーザーのみに制限する方法としては、条件付きアクセスの機能を利用することがおすすめです。条件付きアクセスの機能を利用するためには Azure AD Premium (P1 or P2) のライセンスが制御対象のユーザー分必要となります。</p><ol><li><p>Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) に管理者のアカウントでアクセスします。</p></li><li><p>[セキュリティ] から [条件付きアクセス] – [ポリシー] の順にクリックします。</p></li><li><p>上部 [+ 新しいポリシー] をクリックします。</p></li><li><p>[名前] にポリシーの名前を入力します。</p></li><li><p>ポリシーを割り当てるユーザーまたはグループを選択します。</p><p> この時、ポリシーを全ての管理者に割り当てないようご注意ください。全ての管理者がポリシーの制限を受け、Azure ポータルにアクセスすることができなくなります。結果として、設定解除もできなくなるというお問い合わせを過去に複数いただいております。</p></li><li><p>[クラウド アプリ] では 「アプリを選択」にチェックを入れます。</p></li><li><p>[選択] では、[Microsoft Azure Management] アプリケーションを検索し、選択します。</p><p>追加の条件を設定する場合は [条件] にてポリシーが適用される条件を選択します。条件を選択しない場合、すべてのアクセスが対象となります。</p></li><li><p>[アクセス制御] の [許可] で「アクセスのブロック」を選択して、[選択] をクリックします。</p></li><li><p>即時ポリシーを有効化する場合には、ポリシーの有効化で [オン] を選択し、[作成] をクリックします。</p></li></ol><p>該当ユーザーで Azure ポータルへアクセスすると下記の画面が表示され、アクセスがブロックされます。</p><p><img src="/blog/azure-active-directory/access-restriction-azure-portal/access-restricted.png"></p><div class="alert is-important"><p class="alert-title">重要</p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-conditional-access-cloud-apps#microsoft-azure-management">Microsoft Azure Management</a> は複数のサービスが対象となっており、これへのアクセスをブロックすると、Azure ポータル以外にも Azure CLI などを利用したサブスクリプションへのアクセスがブロックされる点にご留意ください。</p></div><h2 id="Azure-AD-管理ポータルへのアクセスを制限する方法"><a href="#Azure-AD-管理ポータルへのアクセスを制限する方法" class="headerlink" title="Azure AD 管理ポータルへのアクセスを制限する方法"></a>Azure AD 管理ポータルへのアクセスを制限する方法</h2><p>これは Azure AD の管理者 (グローバル管理者または制限付き管理者) を与えられていないユーザーによるポータル内 [Azure Active Directory] へのアクセスを制限する方法です。以下の手順で構成いただけます。本設定は、Azure ポータル上のアクセス制限になるため、設定完了後も PowerShell や Azure CLI を使用すれば、ユーザーの一覧は参照できます。</p><ol><li>グローバル管理者として Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) にサインインします。</li><li>[Azure Active Directory] を開きます。</li><li>表示されたメニューから [ユーザー設定] をクリックします。</li><li>右側にある [管理ポータル] - [Azure AD 管理ポータルへのアクセスを制限する] の項目で [はい] を選択します。</li><li>上にある [保存] をクリックします。</li></ol><p>※ 上記 4. で [はい] を選択することで管理者以外の一般ユーザーは、Azure ポータル内での [Azure Active Directory] にアクセスしようとすると、下記の画面が表示されアクセス権がなくなります。</p><p><img src="/blog/azure-active-directory/access-restriction-azure-portal/no-access.png"></p><h2 id="Microsoft-Graph-API-でユーザーの一覧を取得できなくする方法"><a href="#Microsoft-Graph-API-でユーザーの一覧を取得できなくする方法" class="headerlink" title="Microsoft Graph API でユーザーの一覧を取得できなくする方法"></a>Microsoft Graph API でユーザーの一覧を取得できなくする方法</h2><p>上述のとおり、Azure AD では他のユーザーの一覧 (基本情報) を確認することが既定で可能であり、これは想定される動作です。ただし、学校など運用形態によっては、コマンドなどでユーザーが他のユーザーを一覧で取得できることが好ましくない状況もあると存じます。この場合、以下の設定を使用することで、他のユーザーの読み取りをある程度制限可能です。本設定をご利用の際は検証用のテナントで動作を確認したうえで、運用テナントでの利用を検討ください。</p><p>この設定を有効にするためには、Azure AD 用の PowerShell を利用する必要があります。PowerShell を利用する際には組織アカウントのグローバル管理者が必要です (Azure AD の PowerShell については <a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">リンク</a> も参照ください)。</p><ol><li><p>PowerShell を開き、下記のコマンドでグローバル管理者で Azure AD に接続します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-Scopes</span> Policy.ReadWrite.Authorization</span><br></pre></td></tr></table></figure></li><li><p>下記コマンドで現在の設定を確認します。    </p>  <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">Get-MgPolicyAuthorizationPolicy</span>).DefaultUserRolePermissions | <span class="built_in">fl</span></span><br></pre></td></tr></table></figure><p> AllowedToReadOtherUsers が該当の設定になります。 True になっていることを確認します。</p><p> <img src="/blog/azure-active-directory/access-restriction-azure-portal/ps-1.png"></p></li><li><p>下記コマンドで他のユーザーの情報を取得させないように設定します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$params</span>=<span class="selector-tag">@</span>&#123;</span><br><span class="line">    defaultUserRolePermissions = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    allowedToReadOtherUsers = <span class="variable">$false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">Update-MgPolicyAuthorizationPolicy</span> <span class="literal">-BodyParameter</span> <span class="variable">$params</span></span><br></pre></td></tr></table></figure></li><li><p>再度、下記コマンドで他のユーザーの情報を取得させないように設定されたか確認します。</p> <figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">(<span class="built_in">Get-MgPolicyAuthorizationPolicy</span>).DefaultUserRolePermissions | <span class="built_in">fl</span></span><br></pre></td></tr></table></figure><p> AllowedToReadOtherUsers が False に変更されたことを確認します。</p><p> <img src="/blog/azure-active-directory/access-restriction-azure-portal/ps-2.png"></p></li></ol><h2 id="補足-ゲスト-ユーザーのアクセス権"><a href="#補足-ゲスト-ユーザーのアクセス権" class="headerlink" title="補足: ゲスト ユーザーのアクセス権"></a>補足: ゲスト ユーザーのアクセス権</h2><p>外部から追加したゲスト ユーザーについては既定で Azure AD へのアクセスが制限されています。ゲストとメンバー の違いについては、<a href="https://jpazureid.github.io/blog/azure-active-directory/member-and-guest-user/">こちら</a> を参照ください。</p><h2 id="補足-Azure-サブスクリプションの作成権限の制御"><a href="#補足-Azure-サブスクリプションの作成権限の制御" class="headerlink" title="補足: Azure サブスクリプションの作成権限の制御"></a>補足: Azure サブスクリプションの作成権限の制御</h2><p>既定では Azure ポータルにユーザーがサインインすることで、自由に新規サブスクリプションを作成することが可能です。ここで作成されるサブスクリプションはそのユーザーが新たに自身のクレジット カードを登録して利用するものです。つまり、会社のサブスクリプションのリソースや課金観点において影響はありません。</p><p>Azure AD のグローバル管理者においては下記の設定で、自身が管理する Azure AD に紐づく全サブスクリプションを確認可能です。</p><ol><li>グローバル管理者として Azure ポータル (<a href="https://portal.azure.com/">https://portal.azure.com</a>) にサインインします。</li><li>左側のメニューから [Azure Active Directory] をクリックします。</li><li>表示されたメニューから [プロパティ] をクリックします。</li><li>[Azure リソースのアクセス管理] より、[すべての Azure サブスクリプションおよび管理グループへのアクセスを管理できます] を [はい] に設定します。</li><li>上にある [保存] をクリックします。</li></ol><p>上記内容が少しでも皆様の参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 4_ユーザー管理</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/</id>
    <published>2023-04-14T00:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.045Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>この記事は、この記事は、MSOnline / AzureAD モジュール廃止について、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/">1. 概要編</a>、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/">2. 移行導入編</a>、<a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">3. インストール・接続編</a> の続きとして連載しています。</p><p>4 回目となる今回からは、具体的に、新しい Microsoft Graph PowerShell SDK を使用したユーザーの管理方法についてご案内します。以前、<a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">こちらの記事</a> にて、ライセンス管理についてご案内させていただきましたが、今回はユーザー管理に特化してご紹介します。まだモジュールをインストールしていない場合や、 Connect-MgGraph コマンドを使用した接続方法が分からない場合などは、本シリーズの 2 と 3 をご確認ください。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li><a href="#idx1">ユーザーの取得</a><ul><li><a href="#idx1-1">テナントの全ユーザーを取得したい</a></li><li><a href="#idx1-2">特定のユーザーを取得したい</a></li><li><a href="#idx1-3">ゲスト ユーザーのみを取得したい)</a></li><li><a href="#idx1-4">アカウントが有効なゲスト ユーザーのみを取得したい)</a></li><li><a href="#idx1-5">特定のユーザーの extensionAttribute の値を取得したい</a></li><li><a href="#idx1-6">削除済みユーザーを取得したい</a></li></ul></li><li><a href="#idx2">ユーザーの作成</a></li><li><a href="#idx3">ユーザーの削除</a></li><li><a href="#idx4">削除済みユーザーの完全削除と復元</a></li><li><a href="#idx5">ユーザーの属性を更新する</a></li><li><a href="#idx6">よくある質問</a></li></ol><hr><h2 id="idx1">1. ユーザーの取得</h2><p>これまでユーザー情報の取得にし使用していた Get-MsolUser や Get-AzureADUser コマンドは、 Get-MgUser コマンドに置き換えられます。ここでは様々なシナリオでユーザーを取得する方法についてご紹介します。</p><h3 id="idx1-1">テナントの全ユーザーを取得したい</h3><p>全てのユーザーを取得するには、-All オプションを使用します。Get-AzureADUser コマンドでは、-All $true とする必要がありましたが、新しいコマンドでは -All のみで動作します。-All を指定しない場合は、100 ユーザーなど一部の結果のみが返されます。 ユーザー数の非常に多い環境では -All オプションをつけると大量の結果が表示されますのでご注意ください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -All</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-1.png"></p><h3 id="idx1-2">特定のユーザーを取得したい</h3><p>これまでのコマンドと同様に、 ObjectID や UPN を指定することで取得が可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId admin@m365x219253.onmicrosoft.com</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-2.png"></p><p>上記で気になった方もいると思いますが、Usertype の中身が空になっていることにお気づきでしょうか。Get-MsolUser コマンドや Get-AzureADUser コマンドでは、何も指定しなくても、すべての属性の情報が一括で出力されていました。</p><p> Microsoft Graph Powershell SDK では、属性によって下記のような特徴がある点を理解しておくと、「入れたはずの値が表示されない」といった混乱を避けることができます。</p><ul><li>Microsoft Graph PowerShell SDK にはバージョンがあり、v1.0 で取得できる属性値 beta でしか取得できない属性値がある</li><li>Property オプションを使用して明示的に指定しないと、結果に表示されないものがある</li></ul><p>そのため、たとえば下記のように実行すると、Usertype 属性が取得できるようになります。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId admin@m365x219253.onmicrosoft.com -Property Id,Displayname,Mail,UserPrincipalName,Usertype</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-3.png"></p><p>これは、| format-list を利用したときも同様で、| format-list 自体は新しいモジュールでも機能しますが、下記のように、必要な情報が出てこないことがあります。</p><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-4.png"></p><p>AccountEnabled に値が入っていない！と疑問に思うかもしれませんが、Usertype と同様に下記のように実行すると、AccountEnabled の値も取得することが可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId 30a4a94b-9bca-4141-94d2-2dd0e2cc341b -Property Id,Displayname,Mail,UserPrincipalName,Usertype,AccountEnabled | fl</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-5.png"></p><p>もしくは、上記にて紹介した -Property オプションを使用したうえで、さらに Select を使用すると、表示される属性と値をカスタマイズできます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId 2e7c8a97-ab50-4e53-b193-be3ff9ddc6aa -Property Id,Displayname,Mail,UserPrincipalName,Usertype,AccountEnabled | select displayname,accountenabled</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-6.png"></p><p>次に、-Filter オプションをはじめとするオプションを活用できます。よくお問い合わせをいただく取得方法についてご案内します。</p><h3 id="idx1-3">ゲスト ユーザーのみを取得したい</h3><p>特定の条件を満たすユーザーのみを取得したい場合は -Filter オプションを使用します。usertype が Guest となっているユーザーをフィルターして表示しています。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -All  -Filter &quot;usertype eq &#x27;Guest&#x27;&quot; -Property Id,displayname,Mail,Userprincipalname,Usertype</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-7.png"></p><h3 id="idx1-4">アカウントが有効なゲスト ユーザーのみを取得したい</h3><p>-Filter の条件を 2 つ以上記載したいときは and でつなげると利用できます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Get-MgUser -Filter &quot;accountEnabled eq true and usertype eq &#x27;Guest&#x27;&quot;</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-8.png"></p><h3 id="idx1-5">特定のユーザーの extensionAttribute の値を取得したい</h3><p>ExtensionAttribute1 などの属性は、ユーザーの onpremisesExtensionAttributes の配下に用意されているので、下記のように実行して取得します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(get-mguser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3).onpremisesExtensionAttributes | fl</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-9.png"></p><p>こちらは beta のみ対応しておりますので、Connect-MgGraph での接続後、本コマンド実行前に Select-Mgprofile -name beta にてベータに切り替えを実施ください。</p><h3 id="idx1-6">削除済みユーザーを取得したい</h3><p>削除済みのオブジェクトを取得するコマンドは、Get-MgDirectoryDeletedItem です。-DirectoryObjectID オプションに microsoft.graph.user と記載すると、削除されたユーザー オブジェクトが返されます (これらは、いわゆるごみ箱にある状態のユーザーで、30 日後に完全に削除されると参照できなくなります)。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(Get-MgDirectoryDeletedItem -DirectoryObjectId microsoft.graph.user).AdditionalProperties.value</span><br></pre></td></tr></table></figure><p><img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-10.png"></p><p>利用可能なパラメーターは Filter 以外にもありますが、各属性によってサポートされるオプションが異なります。下記のような公開情報を確認いただき、使用したい属性とオプションがサポートされているか、あらかじめご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/graph/api/resources/user?view=graph-rest-1.0#properties">user リソースの種類 - プロパティ</a></li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/user-list?view=graph-rest-1.0&tabs=powershell#optional-query-parameters">ユーザーを一覧表示する - オプションのクエリ パラメーター</a></li></ul><h2 id="idx2">2. ユーザーの作成</h2><p>下記のように必要なパラメーターを記載して、 New-Mguser を使用すると新しいユーザーを作成できます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$params = @&#123;</span><br><span class="line">AccountEnabled = $true</span><br><span class="line">DisplayName = &quot;Adele Vance22&quot;</span><br><span class="line">MailNickname = &quot;AdeleV22&quot;</span><br><span class="line">UserPrincipalName = &quot;AdeleV22@m365x61971868.onmicrosoft.com&quot;</span><br><span class="line">PasswordProfile = @&#123;</span><br><span class="line">ForceChangePasswordNextSignIn = $true</span><br><span class="line">Password = &quot;xWwvJ]6NMw+bWH-d11&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">New-MgUser -BodyParameter $params</span><br></pre></td></tr></table></figure><p>もしくは、下記のように直接 New-Mguser コマンド内で必要な情報を記載することも可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$PasswordProfile = @&#123;</span><br><span class="line">  Password = &#x27;Passw0rd&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">New-MgUser -DisplayName &#x27;Rene Magi&#x27; -PasswordProfile $PasswordProfile -AccountEnabled -MailNickName &#x27;ReneMagi&#x27; -UserPrincipalName &#x27;ReneMagi@m365x61971868.onmicrosoft.com&#x27;</span><br></pre></td></tr></table></figure><p>以下の公開情報も併せてご確認ください。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/powershell/module/microsoft.graph.users/new-mguser?view=graph-powershell-1.0">New-MgUser</a></li><li><a href="https://learn.microsoft.com/ja-jp/graph/api/user-post-users?view=graph-rest-1.0&tabs=http">ユーザーを作成する</a></li></ul><h2 id="idx3">3. ユーザーの削除</h2><p>Remove-MgUser コマンドにて削除可能です。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Remove-MgUser -UserId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><h2 id="idx4">4. 削除済みユーザーの完全削除と復元</h2><p>削除されたユーザーは、30 日間の間、削除済みユーザーとして一時的に保存されます。30 日以内であれば、誤って削除してしまった場合でもこれらのユーザーを復元することが可能です。復元したい場合、 Restore-MgDirectoryDeletedItem コマンドを使用します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Restore-MgDirectoryDeletedItem -DirectoryObjectId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><p><a href="https://learn.microsoft.com/ja-jp/graph/api/directory-deleteditems-restore?view=graph-rest-1.0&tabs=http">削除済みアイテムを復元する</a> の公開情報も併せてご確認ください。</p><p>完全に削除したい場合、Remove-MgDirectoryDeletedItem コマンドを使用します。こちらのコマンドを実行すると、オブジェクトは完全に削除され復元できなくなるためご留意ください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Remove-MgDirectoryDeletedItem -DirectoryObjectId 282f0fb7-06a6-4a86-b3d5-01569d7393a1</span><br></pre></td></tr></table></figure><p><a href="https://learn.microsoft.com/ja-jp/graph/api/directory-deleteditems-delete?view=graph-rest-1.0&tabs=powershell">アイテムを完全に削除する</a> の公開情報も併せてご確認ください。</p><h2 id="idx5">5. ユーザーの属性を更新する</h2><p>Update-Mguser コマンドを利用して更新が可能です。たとえばユーザーの displayname とその他のメール (Othermails) を更新したい場合は下記のように実行します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Update-MgUser -UserId 2e7c8a97-ab50-4e53-b193-be3ff9ddc6aa -DisplayName test1228a -OtherMails @(&quot;bob@contoso.com&quot;, &quot;admin@m365x219253.onmicrosoft.com&quot;)</span><br></pre></td></tr></table></figure><p>一般的には上記のように、変更したい属性を指定して、新しい値を指定すれば更新できます。</p><p>時折ご質問をいただくものとして、extensionattribute 関連の属性を更新したいといったお問い合わせがよくあるため、以下に手順を例として案内します。 Extensionattribute の値を更新したい場合、事前に beta に切り替えてからコマンドを実行ください。</p><ol><li><p>Connect-MgGraph にて接続します。</p></li><li><p>beta バージョンへ切り替えます。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Select-MgProfile -Name &quot;beta&quot;</span><br></pre></td></tr></table></figure></li><li><p>Get-Mguser コマンドを実行して、ユーザーの情報を取得します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(Get-MgUser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3).onpremisesExtensionAttributes | fl</span><br></pre></td></tr></table></figure><p> 以下の画面では、ユーザーの ExtensionAttribute1 の値に test という文字列が入っていることが確認できます。</p><p> <img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-11.png"></p></li><li><p>以下のコマンドを実行して、たとえば ExtensionAttribute1 の値を test2 に更新します。</p> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Update-MgUser -UserId 4e6bc6e4-d6e7-4bd8-9079-3393e12dcec3 -OnPremisesExtensionAttributes @&#123;&quot;ExtensionAttribute1&quot;=&#x27;test2&#x27;&#125;</span><br></pre></td></tr></table></figure></li><li><p>値が test2 に更新されたことを確認します。</p><p> <img src="/blog/azure-active-directory/azuread-module-retirement4/azuread-module-retirement4-12.png"></p></li></ol><h2 id="idx6">6. よくある質問</h3><p>Q. Set-MsolUser コマンドで実施できた StrongAuthenticationRequirements の有効化や、StrongAuthenticationMethod を無効化する代替案はありますか？</p><p>A. いいえ、現状新しい Microsoft Graph PowerShell SDK では対応していません。<a href="https://learn.microsoft.com/ja-jp/graph/api/resources/authenticationmethods-overview?view=graph-rest-1.0">公開情報</a> にも記載があります。</p><blockquote><p>この機能は現在、StrongAuthenticationMethods プロパティを使用して、MSOL Set-MsolUser コマンドレットを使用してのみサポートされています。</p></blockquote><p>StrongAuthenticationMethod プロパティは、”ユーザーごとの MFA” の機能で利用される項目ですが、この機能はレガシーとなり、現在は条件付きアクセスでの管理を推奨しております。そのため、ユーザーごとの MFA を利用している場合、今後は条件付きアクセスで MFA を要求する形に移行することをお勧めいたします。条件付きアクセスにてユーザーに MFA を要求すると、そのユーザー次回サインイン時に自動的に MFA の登録を求められます。例えば、条件付きアクセスにてすべてのアプリに対して MFA を要求するように構成すると、これは “ユーザーごとの MFA” の機能において、ユーザーの MFA の状態を “有効” にするのと同じ意味になります。このため、現在 “ユーザーごとの MFA” の機能において、ユーザーの MFA の状態を “有効” にすることで MFA を構成している場合は、条件付きアクセスにてすべてのアプリに対して MFA を要求するように構成ください。</p><p>一方で、MFA の再登録を要求する場合は、<a href="https://learn.microsoft.com/en-us/graph/api/resources/authenticationmethods-overview?view=graph-rest-1.0">公開情報 (英語)</a> に記載があり、Microsoft Graph API (PowerShell SDK) を利用して、利用可能なすべての認証方法を個別に削除するというのが今後の正しい代替方法となります。</p><p>基本的なユーザー管理コマンドについて案内していますが、もし利用方法が不明なコマンドがございましたらお気軽にお問い合わせを起票ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;この記事は、この記事は、MSOnline / AzureAD モジュール廃止について、&lt;a href=&quot;https://jpazureid.github.io/blog/azure-ac</summary>
      
    
    
    
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
  </entry>
  
  <entry>
    <title>カスタム クレーム プロバイダーで認証フローをカスタマイズ！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/</id>
    <published>2023-04-13T03:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.173Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 3 月 20 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/customize-your-authentication-flows-with-custom-claims-providers/ba-p/2464388">Customize your authentication flows with custom claims providers!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>Microsoft Entra の一部である Azure Active Directory (Azure AD) においてカスタム クレーム プロバイダーのパブリック プレビューを発表できることを大変うれしく思います。</p><p>カスタム クレーム プロバイダーを使うと、認証フローの最中に API を呼び出してカスタム クレームをトークンにマッピングすることができます。API の呼び出しは、ユーザーがすべての認証要求を完了した後で、トークンがアプリへ発行される直前に実行されます。アプリが想定どおり機能するために、アプリに送信されるトークンに追加のクレームを返す必要があるというシナリオを多くのお客様から伺いました。これらのクレームを外部のシステムから取得するのは、以下のような理由が挙げられます:</p><ul><li>機密性の高い属性をオンプレミスで管理しており、Active Directory Federation Services やその他のフェデレーション サービスを使用して Azure AD にクレームを渡す必要がある。</li><li>規制上、これら機密性の高い属性を Azure AD に同期させることができない。</li><li>属性が外部データベースに格納されており、複雑な RBAC モデルを保有している。</li><li>アプリを所有していない、または認証後にこれらの属性を取得するようにアプリを変更することができない。</li></ul><p>カスタム クレーム プロバイダーを使用すると、外部システムからクレームを取得し、トークンに直接発行することができます。LDAP や SQL など、あらゆるデータ ストアと連携することもできます。カスタム クレーム プロバイダーは、OpenID および SAML アプリに設定でき、従業員や外部の ID を認証するシナリオで機能します。</p><p>Contoso 社の人事アプリを使って設定方法を紹介したいと思います。このシナリオでは、Contoso 社は人事アプリを Active Directory Federation Services から切り離し、Azure AD で直接認証することを検討しています。人事アプリは、オンプレミスの Active Directory に保存されているトークンに、ユーザーの社員番号が返されることを想定しています。 </p><p>Contoso 社はカスタム クレーム プロバイダーを構成し、このデータを取得して認証時にトークンに挿入することがで切るようになります。Contoso 社の Azure AD 側の設定を始めてみましょう。 </p><p>まず、[<strong>エンタープライズ アプリケーション</strong>] メニューで、Contoso の管理者は [<strong>カスタム認証拡張機能</strong>] を選択後、[<strong>カスタム拡張機能の作成</strong>] を選択します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers1.png"></p><p>そして [<strong>TokenIssuanceStart</strong>] を選択し、[<strong>次へ</strong>] を選択します。 </p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers2.png"></p><p>管理者は、Contoso 社の API の [<strong>名前</strong>] [<strong>対象 URL</strong>] [<strong>説明</strong>] を入力し、[<strong>次へ</strong>] を選択します。API エンドポイントは、LDAP 検索を使用して Active Directory と通信し、ユーザーの社員番号を取得することになります。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers3.png"></p><p>次に、Contoso 社の管理者は、カスタム拡張機能がどのようにして自社の API に認証するかを設定できます。[<strong>アプリの登録を新規作成する</strong>] を選択し、[<strong>名前</strong>] を入力し、[<strong>次へ</strong>] を選択します。Contoso 社の API を認証するために、クライアント資格情報を使用します。Contoso 社は Azure Functions アプリを使用して API をホストしているため、このアプリ登録が自動的に API を保護するために使用されます。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers4.png"></p><p>そして、API から返される属性名をカスタム拡張機能に設定します。Contoso 社の API は、<strong>employeeNumber</strong> という属性を返します。管理者は [<strong>要求名</strong>] に <strong>employeeNumber</strong> を入力し、[<strong>次へ</strong>] を選択します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers5.png"></p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers6.png"></p><p>次に、カスタム クレーム プロバイダーを使用して、人事アプリ登録のクレームをマッピングしてみましょう。Contoso 社の管理者は、[<strong>エンタープライズ アプリケーション</strong>] メニューに移動して 人事アプリを選択し、[<strong>シングル サインオン</strong>] &gt; [<strong>属性とクレーム</strong>] で [<strong>編集</strong>] を選択します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers7.png"></p><p>Contoso 社の管理者は、カスタム クレーム プロバイダーを構成して、カスタム拡張機能から社員番号を取得するためのクレーム マッピングを作成する必要があります。</p><p>[<strong>詳細設定</strong>] メニューを展開し、［<strong>設定</strong>］を選択します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers8.png"></p><p>管理者は、[<strong>カスタム クレーム プロバイダー</strong>] を選択し、先に作成したカスタム拡張機能を選択し、[<strong>保存</strong>] します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers9.png"></p><p>最後に、管理者は [<strong>新しいクレームの追加</strong>] を選択し、トークンに発行されるクレームの [<strong>名前</strong>] を入力します。次に [<strong>ソース</strong>] にて [<strong>属性</strong>] を選択し、[<strong>ソース属性</strong>] をプルダウンから選択します (<strong>customClaimsProvider.attributeName</strong> という形式)。そして [<strong>保存</strong>] します。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers10.png"></p><p>これですべての設定が完了しました。ユーザーが Contoso 人事アプリへのサインインを完了すると、カスタム拡張機能がトリガーされます。カスタム クレーム プロバイダーはカスタム拡張機能を使用して、トークンに社員番号を追加します。</p><p>以下はそのフローを示す図です。</p><p><img src="/blog/azure-active-directory/customize-your-authentication-flows-with-custom-claims-providers/customize-your-authentication-flows-with-custom-claims-providers11.png"></p><p>より詳細なビデオ チュートリアルは以下からご覧いただけます: <a href="https://youtu.be/BYOMshjlwbc">https://youtu.be/BYOMshjlwbc</a></p><p>カスタム クレーム プロバイダーは、カスタム拡張機能のまだ最初の利用シナリオの一つでしかありません。今後もカスタム拡張機能のイベントを追加でリリースしていきますので、認証フローをさらにカスタマイズすることができるようになります。</p><p>カスタム拡張機能については <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/custom-extension-overview">こちら</a>、カスタム クレーム プロバイダーについては <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/custom-claims-provider-overview">こちら</a> で詳しく説明しています。カスタム クレーム プロバイダーのセットアップを開始するには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/custom-extension-get-started?tabs=azure-portal">こちら</a> をご覧ください。</p><p>いつものとおり、皆様のご意見、ご感想、ご提案をお聞かせください。<a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure AD フォーラム</a> で共有するか、以下にコメントください。皆様からのご連絡をお待ちしております。</p><p>よろしくお願いします。</p><p>Alex Simons (@Alex_A_Simons)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 3 月 20 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 1_概要</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement1/</id>
    <published>2023-04-13T00:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.041Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>2022-10-03: 本記事の初版を投稿</p><p>2023-04-13: MSOL/AzureAD PowerShell の最新の廃止情報を反映</p></div><p>こんにちは、 Azure ID チームの小出です。</p><p>今回は、MSOnline (以降 MSOL) および Azure AD PowerShell の廃止スケジュールについてご案内します。</p><p>以前より、下記の弊社ブログにて、本内容については案内を行っていますが、情報のアップデートにより、複数の記事に分かれてしまうなどわかりにくくなっている状況でした。そこで今回は、現時点での最新情報と実施いただきたいこと、関連記事の URL などをまとめてご紹介します。</p><h2 id="最新情報-2023-4-13-最終更新-のまとめ"><a href="#最新情報-2023-4-13-最終更新-のまとめ" class="headerlink" title="最新情報 (2023/4/13 最終更新) のまとめ"></a>最新情報 (2023/4/13 最終更新) のまとめ</h2><h3 id="MSOL-Azure-AD-PowerShell-のライセンス割り当て関連のコマンド"><a href="#MSOL-Azure-AD-PowerShell-のライセンス割り当て関連のコマンド" class="headerlink" title="MSOL / Azure AD PowerShell のライセンス割り当て関連のコマンド"></a>MSOL / Azure AD PowerShell のライセンス割り当て関連のコマンド</h3><p>ライセンス割り当てに関する MSOL / Azure AD PowerShell コマンド（Set-MsolUserLicense や Set-AzureADUserLicense など）は、2023/3/31 にすでに廃止されました。まだこのコマンドを利用しているお客様は、早急に新しいコマンドに移行ください。これらのコマンドは今後予告なく動作しなくなります。</p><p>新しいコマンドでのライセンス割り当て方法は、<a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">本ブログ記事</a> にてサンプルを用意しておりますので、併せてご確認ください。</p><ul><li>廃止日を 2022/6/30 や 2022/8/26 などと記載している情報もありますが、ライセンス割り当てに関する MSOL / Azure AD PowerShell コマンドの廃止日は 2023/3/31 です。それ以降の延長はなく 2023/3/31 にすでに廃止されました。</li><li>2023/3/31 を過ぎると MSOL / Azure AD のライセンス割り当ての PowerShell コマンドは予告なく使用できなくなる見込みです。2023/4/1 以降も引き続きテナントによっては動作はする可能性はあり、2023/4/13 現在、弊社検証環境では引き続き Set-MsolUserLicense コマンドでのライセンス付与は実施できています。しかし、いつ利用できなくなってもおかしくない状況です。</li><li>2022/11/1 以降に新しく作成するテナントでは、MSOL / Azure AD PowerShell コマンドによるライセンス割り当て関連のコマンドが、テナント作成時点から正常に動作しません。</li></ul><p>対象となるコマンドの詳細は、<a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">こちらの記事</a>の下記該当箇所をご確認ください。</p><table>  <thead>    <tr>      <th>既存のコマンド (2023 年 3 月 31 日以降に利用できなくなる操作)</th>      <th>今後推奨される Microsoft Graph PowerShell および API</th>    </tr>  </thead>  <tbody>    <tr>      <td><a href ="https://docs.microsoft.com/ja-jp/powershell/module/msonline/?view=azureadps-1.0" target="_blank">MSOnline Powershell</a>      <br/>・Set-MsolUserLicense      <br/>・New-MsolUser (-LicenseAssignment か -LicenseOptions を指定)</td>      <td rowspan="2">Microsoft Graph PowerShell      <br/>・<a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.graph.users.actions/set-mguserlicense?view=graph-powershell-1.0" target="_blank">Set-MgUserLicense</a>      </td>    </tr>    <tr>      <td><a href="https://docs.microsoft.com/en-us/powershell/azure/active-directory/overview?view=azureadps-2.0">Azure AD Powershell</a>      <br/>・Set-AzureADUserLicense      </td>    </tr>    <tr>      <td>Azure AD Graph API (graph.windows.net)      <br/>・assignLicense</td>      <td>Microsoft Graph API      <br/>・<a href="https://docs.microsoft.com/ja-jp/graph/api/user-assignlicense?view=graph-rest-1.0&tabs=http">assignLicense</a></td>    </tr>      </tbody></table><h3 id="MSOL-Azure-AD-PowerShell-のライセンス割り当て関連「以外」のコマンドについて"><a href="#MSOL-Azure-AD-PowerShell-のライセンス割り当て関連「以外」のコマンドについて" class="headerlink" title="MSOL / Azure AD PowerShell のライセンス割り当て関連「以外」のコマンドについて"></a>MSOL / Azure AD PowerShell のライセンス割り当て関連「以外」のコマンドについて</h3><p>ライセンス割り当てに関するコマンド以外（例: Connect-MsolService や Get-AzureADUser など）は、2023 年 6 月 30 日 に廃止となる予定です。MSOnline モジュール、AzureAD モジュールだけでなく、 AzureADPreview モジュールのコマンドも廃止されます。</p><p>対象となるコマンドは、Connect-MsolService や Get-AzureADUser コマンドだけでなく、 MSOL や AzureAD がつくコマンドすべてです。各モジュールのコマンド一覧は、下記公開情報にて紹介しています。</p><p><a href="https://learn.microsoft.com/ja-jp/powershell/module/msonline/?view=azureadps-1.0#msonline">MSOnline モジュールのコマンド一覧</a><br><a href="https://learn.microsoft.com/en-us/powershell/module/azuread/?view=azureadps-2.0&preserve-view=true">Azure AD モジュールのコマンド一覧（一般提供版）</a><br><a href="https://learn.microsoft.com/en-us/powershell/module/azuread/?view=azureadps-2.0-preview&preserve-view=true">Azure AD モジュールのコマンド一覧（プレビュー版）</a></p><ul><li>廃止予定日までは、これまでと同様にコマンドを利用可能です。</li><li>廃止後は、動作の保証はされません。マイクロソフトは任意のタイミングで、MSOL / Azure AD (Preview) PowerShell の動作を停止する権利を有します。</li><li>ただし、マイクロソフトは使用状況を確認し、お客様が 3 つの PowerShell モジュールから移行するための猶予を提供した上で、これらモジュールの利用を停止させる予定です。</li><li>従来の MSOL / AzureAD モジュールのコマンドでは実施できた操作が、Microsoft Graph API では実施できないものがあります。こうした操作を行う MSOL / Azure AD モジュールのコマンドも最終的には廃止されますが、Microosft Graph API への移行先がないものについては 2023/6/30 を過ぎてすぐにコマンドが利用できなくなることはありません。Microsoft Graph でこれら API の代替の機能が提供されない限り、API およびコマンドレットを停止させることはありません。</li><li>新しいモジュールのコマンドや代替 API があるものについては、2023/6/30 を過ぎるとすぐに利用できなくなる可能性があるため、引き続き早めに移行ください。</li><li>2023/6/30 を過ぎても引き続き利用できるコマンド一覧の情報、実際に動作しなくなる具体的なコマンド一覧の情報などはありません。</li></ul><h2 id="いまできること・確認すること"><a href="#いまできること・確認すること" class="headerlink" title="いまできること・確認すること"></a>いまできること・確認すること</h2><ol><li>現在利用しているコマンド・スクリプトなどを確認する。<a href="https://jpazureid.github.io/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/">こちらの記事</a>をもとに、MSOL や Azure AD の PowerShell コマンドを利用していないか確認する</li><li>MSOL や Azure AD の PowerShell コマンドを利用している場合、<a href="https://docs.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">こちらの公開情報</a> にて対応するコマンドを探す</li><li>既存のスクリプトの書き換え、コマンドの置き換えを実施し、新しいモジュールで動作するよう修正する</li><li>利用中の MSOL や Azure AD コマンドの置き換えとなるものが見つからない、想定したように動作しない場合は、お問い合わせください</li></ol><h2 id="本廃止に関する弊社ブログ記事リンク"><a href="#本廃止に関する弊社ブログ記事リンク" class="headerlink" title="本廃止に関する弊社ブログ記事リンク"></a>本廃止に関する弊社ブログ記事リンク</h2><h3 id="アップデート情報-英語記事翻訳"><a href="#アップデート情報-英語記事翻訳" class="headerlink" title="アップデート情報 (英語記事翻訳)"></a>アップデート情報 (英語記事翻訳)</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">Azure AD Graph および MSOnline での従来のライセンスの割り当て方法が廃止され Microsoft Graph によるライセンス管理に変わります</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-change-management-simplified/">Azure AD の変更管理を簡素化します</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/Microsoft-Entra-change-announcements-September-2022-train/#Azure-AD%E3%80%81Azure-AD-Preview%E3%80%81MSOnline-PowerShell-%E3%81%AE%E5%BB%83%E6%AD%A2%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">Microsoft Entra の変更管理のアナウンス (2022 年 9 月の状況)</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-entra-change-announcements-march-2023-train/">Microsoft Entra の変更のアナウンス (2023 年 3 月の状況)</a></p><h3 id="既存モジュール使用状況について"><a href="#既存モジュール使用状況について" class="headerlink" title="既存モジュール使用状況について"></a>既存モジュール使用状況について</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/how-to-determine-depreacated-azuread-msol/">Azure AD Graph / MSOnline PowerShell モジュール利用状況の調べ方</a></p><h3 id="新しいモジュールへの移行導入"><a href="#新しいモジュールへの移行導入" class="headerlink" title="新しいモジュールへの移行導入"></a>新しいモジュールへの移行導入</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement2/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 2_移行導入編</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement3/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 3_インストール・接続編</a></p><h3 id="新しいモジュールの使用方法-ライセンスに関する操作について"><a href="#新しいモジュールの使用方法-ライセンスに関する操作について" class="headerlink" title="新しいモジュールの使用方法 (ライセンスに関する操作について)"></a>新しいモジュールの使用方法 (ライセンスに関する操作について)</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">Microsoft Graph PowerShell SDK を使用したライセンス管理操作の紹介</a></p><h3 id="新しいモジュールの使用方法-ライセンス以外の操作について"><a href="#新しいモジュールの使用方法-ライセンス以外の操作について" class="headerlink" title="新しいモジュールの使用方法 (ライセンス以外の操作について)"></a>新しいモジュールの使用方法 (ライセンス以外の操作について)</h3><p><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement4/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 4_ユーザー管理</a><br><a href="https://jpazureid.github.io/blog/azure-active-directory/azuread-module-retirement5/">MSOnline / AzureAD PowerShell から Graph PowerShell SDK への移行について 5_グループ管理</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;2022-10-03: 本記事の初版を投稿&lt;/p&gt;&lt;p&gt;2023-04-13: MSOL/AzureAD PowerShell の最新の廃止情報を反映&lt;/p&gt;</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="PowerShell" scheme="https://jpazureid.github.io/blog/tags/PowerShell/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD テナントの追加・変更・削除</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/add-modify-delete-directory/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/add-modify-delete-directory/</id>
    <published>2023-04-07T00:00:00.000Z</published>
    <updated>2023-05-13T23:48:48.953Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2018/01/16/azuread-operation/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2018-01-16: 本記事の初版を投稿</p><p>2023-04-07: “管理者以外のユーザーによるテナントの作成を制限する” 機能を追記して全体を更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの小出です。この記事はもともと 2018 年 1 月に公開されましたが、直近で新しいプレビューが開始されたことに伴い情報を追記して更新しております。</p><p>今回は下記の 3 つについて紹介します。</p><ul><li>Azure AD テナントの追加手順</li><li>Azure AD テナントの変更手順</li><li>Azure AD テナントの削除手順</li></ul><p>まずは、簡単に Azure AD テナントについて説明します。</p><p>Azure AD テナントは、Azure や Office 365 などの Microsoft クラウド サービスに組織がサインアップしたときに作成されます (もう少し平易な言い方をすると、Office 365 など Azure AD テナントが必須のサービスの新規利用を開始した時点で自動的に作成されます)。Azure AD テナントに存在しているユーザーは、その Azure AD テナントに紐づいているクラウド サービスにサインインして利用することが可能です。Azure AD テナントや Azure AD ディレクトリという言葉が出てきますが、どちらも同じ意味とお考えいただいて結構です。</p><p><img src="/blog/azure-active-directory/add-modify-delete-directory/user-access-o365-subscription.png"></p><h2 id="Azure-AD-テナントの追加手順"><a href="#Azure-AD-テナントの追加手順" class="headerlink" title="Azure AD テナントの追加手順"></a>Azure AD テナントの追加手順</h2><p>冒頭で、クラウド サービスにサインアップした際に Azure AD テナントが作成されると書きましたが、Azure AD テナントを個別に追加することも可能です。下記の手順で、Azure AD Free (無料) テナントを作成できます</p><ol><li><p><a href="https://portal.azure.com/">https://portal.azure.com</a> にアクセスし、任意の管理者アカウントでサインインします。</p></li><li><p>ポータル画面左上のナビゲーションの [Azure Active Directory] をクリックします。</p></li><li><p>表示された画面上で [テナントの管理] をクリックし、[+ 作成] を選択します。</p></li><li><p>[ディレクトリの作成] 画面の下記の項目に入力します。</p><ul><li>テナントの種類を選択する: Azure Active Directory</li><li>組織名: 任意の組織名を入力</li><li>初期ドメイン名: &lt;組織&gt; のドメイン名を入力</li><li>場所: 組織が存在する場所を選択</li></ul></li><li><p>[作成] をクリックします。</p></li><li><p>作成が完了すると、”新しいディレクトリを管理するにはここをクリックします” が表示するので、クリックします。</p></li><li><p>新しく作成したディレクトリの画面に切り替わります。</p></li></ol><p>作成操作を行ったユーザーが新しく作成した Azure AD テナントの管理者となります。</p><h3 id="一般ユーザーに対するテナント作成の制限機能"><a href="#一般ユーザーに対するテナント作成の制限機能" class="headerlink" title="一般ユーザーに対するテナント作成の制限機能"></a>一般ユーザーに対するテナント作成の制限機能</h3><p>上記記載の Azure AD テナント作成操作については、以前は管理者側で制限することができず、一般ユーザーであっても新しいテナントを自由に作成できていました。しかしながら、2023 年に一般ユーザーに対して「新しいテナントの作成を制限する」機能が用意されました。このため、下記を利用することで一般ユーザーによるテナントの作成を制限することが可能です。</p><p><img src="/blog/azure-active-directory/add-modify-delete-directory/tenantcreation.png"></p><p>[管理者以外のユーザーによるテナントの作成を制限する (プレビュー)] の設定を “はい” にした場合、グローバル管理者もしくはテナント作成者ロールをもつユーザーのみが、上記操作を行えるようになります。この設定はその他の機能には特に影響ないほか、操作を行ったテナントと新規テナントは全く別物となりますので、設定が同期されてしまうなど相互に影響しあうこともございません。</p><h2 id="Azure-AD-テナントの変更手順"><a href="#Azure-AD-テナントの変更手順" class="headerlink" title="Azure AD テナントの変更手順"></a>Azure AD テナントの変更手順</h2><p>Azure AD テナントは必ず xxxxx.onmicrosoft.com という名前を持ち、この初期ドメイン名を後から変更することはできません。そのため、Azure AD テナントの初期ドメイン名を例えば contoso.onmicrosoft.com にしたい場合は、上記の「Azure AD の追加手順」の手順に従い、Azure AD を一から新規に作成する必要があります。</p><p>なお、Azure AD の組織名 (よく “既定のディレクトリ” と表示されている名称) については下記の手順で変更可能です。</p><ol><li><p><a href="https://portal.azure.com/">https://portal.azure.com</a> にアクセスし、管理者アカウントでサインインします。</p></li><li><p>ポータル画面左上のナビゲーションの [Azure Active Directory] をクリックします。</p></li><li><p>[プロパティ] をクリックします。</p></li><li><p>[名前] の項目に新しい組織名を入力します。</p><p> 例: 既定のディレクトリ –&gt; コントソ株式会社</p></li><li><p>[保存] を押します。</p></li><li><p>少し時間を空けて再度サインインすると、名前が変更されます。</p></li></ol><p>また、ご利用の Azure サブスクリプションを新規で作成した Azure AD に紐づけたいというような要件がある場合には、<a href="https://learn.microsoft.com/ja-jp/azure/role-based-access-control/transfer-subscription">サブスクリプションの譲渡</a> の方法もご覧ください。</p><h2 id="Azure-AD-テナントの削除手順"><a href="#Azure-AD-テナントの削除手順" class="headerlink" title="Azure AD テナントの削除手順"></a>Azure AD テナントの削除手順</h2><p>手動で作成した Azure AD テナントについては削除が可能です。テナントを削除するためには、以下のような前提条件があります。</p><ul><li>Azure のご契約時に自動的に作成されたディレクトリ (既定のディレクトリ) ではない。</li><li>ディレクトリにユーザーが存在しない (最後の一名の管理者は除く)。</li><li>連携するアプリケーションが存在しない。</li><li>サブスクリプションが紐づいていない。</li><li>など</li></ul><p>テナントの削除手順は以下のとおりです。</p><ol><li><a href="https://portal.azure.com/">https://portal.azure.com</a> にアクセスし、管理者アカウントでサインインします。</li><li>ポータル画面左上のナビゲーションの [Azure Active Directory] をクリックします。</li><li>表示された画面上で [テナントの管理] をクリックし、[ディレクトリの削除] をクリックします。</li><li>前提条件のチェック完了後に [削除] をクリックします。</li></ol><p>削除時に前提条件のチェックが走るため、すべての条件をクリアすることでテナントの削除が可能となります。前提条件に抵触している場合は、下記のように ! の警告が表示され削除を進めることができません。</p><p><img src="/blog/azure-active-directory/add-modify-delete-directory/new6.png"></p><p><img src="/blog/azure-active-directory/add-modify-delete-directory/new7.png"></p><p>なお、Azure のサインアップ時に自動作成された Azure AD テナント (既定のディレクトリ) やセルフサインアップ テナントについては削除が想定されていません。そのディレクトリはもう利用することはないという場合には、そのディレクトリから一名の管理者を除く他のすべてのユーザーを削除する方法で対応ください。テナントは残りますが、実質的に利用できない (利用しても意味のない) テナントとなりますので、削除と同等の結果になります。</p><ol><li><p><a href="https://portal.azure.com/">https://portal.azure.com</a> にアクセスし、管理者アカウントでサインインします。</p></li><li><p>ポータル画面左上のナビゲーションの [Azure Active Directory] をクリックします。</p></li><li><p>[ユーザーとグループ] – [すべてのユーザー] をクリックします。</p></li><li><p>[＋新しいユーザー] をクリックします。</p></li><li><p>ユーザー名を入力し、ロールでは「グローバル管理者」を選択します (最後の一名のアカウントを作成します)。</p><p> 例) 削除対象のディレクトリ名が contoso.onmicrosoft.com の場合: <a href="mailto:&#x74;&#x65;&#109;&#112;&#x40;&#x63;&#x6f;&#110;&#x6f;&#116;&#x6f;&#x73;&#x6f;&#x2e;&#x6f;&#x6e;&#x6d;&#x69;&#x63;&#114;&#x6f;&#115;&#x6f;&#102;&#x74;&#46;&#x63;&#111;&#109;">&#x74;&#x65;&#109;&#112;&#x40;&#x63;&#x6f;&#110;&#x6f;&#116;&#x6f;&#x73;&#x6f;&#x2e;&#x6f;&#x6e;&#x6d;&#x69;&#x63;&#114;&#x6f;&#115;&#x6f;&#102;&#x74;&#46;&#x63;&#111;&#109;</a></p></li><li><p>手順 5. で作成したグローバル管理者のアカウントで <a href="https://portal.azure.com/">https://portal.azure.com</a> にサインインします。</p></li><li><p>[すべてのユーザー] まで移動して、その他のすべてのアカウントをこのテナントから削除します。</p></li></ol><p>削除されたユーザーで、対象のテナントにアクセスができないことを確認ください。</p><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>複数の Azure AD テナントは完全に独立したリソースとして管理されます。そのため、Azure AD テナント間の連携が必要なシナリオの場合は、Azure AD B2B の利用をします。B2B については下記の記事を合わせてご参照ください。</p><p><a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/12/about-azure-ad-b2b/">Azure AD B2B とは</a></p><p>上記内容が少しでも皆様の参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD における入れ子 (ネスト) グループへの権限付与について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/nesting-group/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/nesting-group/</id>
    <published>2023-04-06T23:00:00.000Z</published>
    <updated>2023-05-13T23:48:49.433Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2019/02/06/nesting-group/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2019-02-06: 本記事の初版を投稿</p><p>2023-04-07: 最新の公開情報リンクへの差し替えなど更新</p></div><p>こんにちは、 Azure Identity の平形です。</p><p>今回は Azure AD における入れ子 (ネスト) グループの対応状況についてお伝え致します。本記事は記事はは当初 2019 年 2 月に公開されましたが、その後 Azure ポータルのメニューなどが変更されたため、内容を最新版に更新いたしました。</p><h2 id="入れ子のグループとは"><a href="#入れ子のグループとは" class="headerlink" title="入れ子のグループとは"></a>入れ子のグループとは</h2><p>そもそも入れ子のグループとは、グループの中にグループを所属させているグループを指します。以下の図をご覧ください。</p><p><img src="/blog/azure-active-directory/nesting-group/333.jpg"></p><p>この場合はグループ A が入れ子のグループです。グループ A の中にはグループ B とユーザー B が含まれています。そしてユーザー A はグループ B に含まれている状態ですが、実際の挙動としてユーザー A はグループ A に含まれていると考えて良いかどうかが今回のテーマです。</p><p>例えば、アクセス権限をグループ A に割り当てた場合、ユーザー A に対してもアクセス権限が割り当てられることが期待されますが、 Azure AD の機能によっては必ずしもそうならず、いくつかの制限事項があります。ここではよくお問い合わせ頂く制限事項についてご紹介します。</p><h2 id="Azure-AD-における入れ子グループの制限"><a href="#Azure-AD-における入れ子グループの制限" class="headerlink" title="Azure AD における入れ子グループの制限"></a>Azure AD における入れ子グループの制限</h2><p>主にお問い合わせ頂く機能の中で、現時点では以下の機能については入れ子グループに対応していません。</p><ul><li>グループ ベースのライセンス付与</li><li>エンタープライズ アプリケーションのユーザーおよびグループの割り当て</li></ul><p>上記はグループに直接所属しているユーザーにのみ機能が割り当てられます。一方、条件付きアクセスの機能でグループを条件として設定した場合、入れ子のグループにも対応しており、上の例でいえばグループ A を対象とした条件付きアクセス ポリシーは、ユーザー A も対象になります。</p><p>実際のシナリオを考えてみましょう。グループ A に対して例えば Office 365 E3 のライセンスを割り当てた場合、先程の図のパターンに当てはめると以下のような結果になります。</p><p>例: グループ A に権限を割り当てた場合</p><p><img src="/blog/azure-active-directory/nesting-group/ssssss.jpg"></p><p>ユーザー A はグループ A の直属のメンバーでは無いため、グループ A にライセンスを割り当てても、配下のグループ B に所属しているユーザー A に対してはライセンスが付与されません。ユーザー B はグループ A の直接のメンバーであるため、問題なく権限が割り当てられます。このシナリオは Office 365 E3 のライセンスを割り当てた場合としましたが、エンタープライズ アプリケーションの割り当ての場合にも同様の動作となります。</p><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><p>Azure Active Directory のライセンス管理にグループを使用する際のシナリオ、制限、および既知の問題<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/licensing-group-advanced">https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/licensing-group-advanced</a></p><p>SaaS アプリケーションへのアクセスをグループで管理する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/groups-saasapps">https://docs.microsoft.com/ja-jp/azure/active-directory/users-groups-roles/groups-saasapps</a></p><p>Azure AD サービスの制限と制約 (表内グループの項目でも、本記事に記載の内容を確認できます。)<br><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/enterprise-users/directory-service-limits-restrictions">https://learn.microsoft.com/ja-jp/azure/active-directory/enterprise-users/directory-service-limits-restrictions</a></p><h2 id="備考"><a href="#備考" class="headerlink" title="備考"></a>備考</h2><p>グループの入れ子については多くのお客様よりフィードバックをいただいており、弊社開発部門も実装を検討しています。</p><p><a href="https://feedback.azure.com/d365community/idea/fa8991c1-b125-ec11-b6e6-000d3a4f0789">https://feedback.azure.com/d365community/idea/fa8991c1-b125-ec11-b6e6-000d3a4f0789</a></p><p>上記のフィードバックサイトは開発部門が閲覧しており、フィードバックが多い機能や要望は今後の Azure 機能拡張の参考にしています。</p><p>グループの入れ子については、階層が深い場合や、グループの入れ子構造がループしている場合の検出など技術的に考慮すべき部分もあり現状はサポートされていない機能が多い状況です。グループの入れ子に対応していないことで不便さを感じられている方は、是非上記のフィードバック サイトから投票ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
</feed>
