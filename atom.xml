<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2023-06-19T07:52:31.467Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>招待したユーザーが利用できない</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azuread-b2b-troubleshooting/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azuread-b2b-troubleshooting/</id>
    <published>2023-06-26T01:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.467Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/11/27/azuread-b2b-troubleshooting/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017-11-27: 本記事の初版を投稿</p><p>2023-03-26: Azure ポータル上のメニューの変更に伴い画面ショットや内容を更新</p><p>2023-06-26: Azure ポータル上のメニューの変更に伴い画面ショットや内容を更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの 三輪 です。</p><p>本記事では Azure AD に招待したはずのユーザーが利用できない際の確認ポイントについて説明します。この記事はもともと 2017 年 11 月に公開されましたが、その後 Azure ポータルのメニューなどが変更されたため、内容を最新版に更新いたしました。</p><p>Azure AD へのユーザー招待は、明示的に Azure Active Directory の管理画面からゲスト ユーザーを追加した場合だけでなく、その追加したユーザーが Azure AD にすでに追加済みでなければ、Azure のサブスクリプションに対して “所有者” や “仮想マシン共同作成者” の役割を追加したときにも行われます。</p><p>ユーザーを招待した後には、招待されたユーザー側でその招待の受諾処理を行う必要があり、それが完了していないと、役割を割り当てたもののサブスクリプションの利用ができないというような状況になります。そのような状況の場合は、まずはじめに Azure ポータルにて招待状況を確認しましょう。</p><h2 id="Azure-ポータルでの招待状況の確認方法"><a href="#Azure-ポータルでの招待状況の確認方法" class="headerlink" title="Azure ポータルでの招待状況の確認方法"></a>Azure ポータルでの招待状況の確認方法</h2><p>招待操作を行ったテナントの管理者権限を持つユーザーで Azure ポータルにサインインし、[Azure Active Directory] – [ユーザー] – [すべてのユーザー] から該当のゲスト ユーザーを選択します。</p><p>[プロパティ] のタブで「外部ユーザーの状態」(赤枠) の項目が「保留中の承諾」の場合は、招待メールは送信されているものの、該当のユーザーが招待を受け付け操作を完了していない状態を示します。招待を受けたユーザーは送信された E メールに含まれる [招待の承諾] のリンクをクリックしてウィザードを完了させる必要があります。</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new1.png"></p><p>なお、招待 E メールが届いていない場合、赤枠部分の「B2B コラボレーション」の [招待の再送信] - [再送信] から招待 E メールの再送も可能です。</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/renew2-blue.png"></p><p>招待 E メールは下記のようなメールです。</p><p>アドレス: <a href="mailto:&#105;&#x6e;&#118;&#105;&#116;&#101;&#x73;&#64;&#109;&#x69;&#99;&#x72;&#x6f;&#x73;&#111;&#x66;&#116;&#46;&#x63;&#x6f;&#109;">&#105;&#x6e;&#118;&#105;&#116;&#101;&#x73;&#64;&#109;&#x69;&#99;&#x72;&#x6f;&#x73;&#111;&#x66;&#116;&#46;&#x63;&#x6f;&#109;</a><br>件名: 組織内のアプリケーションにアクセスするための &lt;招待者&gt; さんからの招待</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new3.png"></p><div class="alert is-info"><p class="alert-title">Note</p><p>件名に招待者の名前がない場合、ProxyAddresses 属性に値が入っていないユーザーで招待操作を行ったことが考えられます。この場合、特定のユーザー名の代わりにテナント名が記載されます。</p></div><p>もし、招待されたユーザーが E メールを利用できない場合や、E メール ボックスの作成前の場合は、招待の再送信後に表示される下記、「招待 URL ※」をコピーして、何らかの手段でその URL を招待されたユーザーにお渡しください。招待されたユーザーは、その URL にブラウザーからアクセスすることで招待の完了作業を進めることができます。</p><p>※ URL にアクセスして招待の完了作業を進めても、招待 E メールの「招待の承諾」を押す場合と同等の操作になります。</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new4.png"></p><p>招待された外部ユーザーの状態が 「保留中の承諾」 ではなく、「承諾済み」となっている場合は、ユーザーの招待は完了しています。</p><p>「承諾済み」の状態で、期待したサブスクリプションの操作や Azure AD テナントの確認ができない場合は、適切なアカウントや Azure AD を選択できていない可能性がありますので、一度 <a href="https://jpazureid.github.io/blog/azure-active-directory/subscription-azuread/">サブスクリプションが見えない</a> の内容をご確認ください。</p><p>なお、招待 E メールに含まれるリンクをクリックし、ウィザードを進めた結果、次のような「表示するアプリはありません。 このコレクションを非表示にする」との画面が表示されることがありますが、こちらは問題なく招待が完了していますのでご安心ください。</p><p><img src="/blog/azure-active-directory/azuread-b2b-troubleshooting/new5.png"></p><p>これは、特に割り当てられたアプリケーションがないことを意味しており、招待自体は正常に完了したことを示します。</p><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>上記内容でもご要望の動作が完了しない場合は、ぜひ弊社サポート サービスをご利用ください。その際は下記の情報を事前にご提供いただけると幸いです。</p><ul><li>招待操作を行ったテナント名 (例: xxx.onmicrosoft.com)</li><li>招待操作を行ったユーザー名 (例: <a href="mailto:&#x78;&#x78;&#x78;&#64;&#x63;&#111;&#x6e;&#x74;&#x6f;&#x73;&#111;&#46;&#99;&#x6f;&#109;">&#x78;&#x78;&#x78;&#64;&#x63;&#111;&#x6e;&#x74;&#x6f;&#x73;&#111;&#46;&#99;&#x6f;&#109;</a>)</li><li>招待操作を行った時刻</li><li>招待されるユーザーの E メールアドレス (例: <a href="mailto:&#120;&#x78;&#120;&#64;&#x66;&#x61;&#98;&#114;&#105;&#107;&#x61;&#109;&#46;&#99;&#x6f;&#x6d;">&#120;&#x78;&#120;&#64;&#x66;&#x61;&#98;&#114;&#105;&#107;&#x61;&#109;&#46;&#99;&#x6f;&#x6d;</a>)</li><li>問題となっている状況の詳細と画面ショット</li></ul><p>例としては、「招待 E メールが届かない」、「招待 E メールは届くが招待の操作が完了しない」、「招待は完了したが、その後に目的のリソースにアクセスできない」などが挙げられます。それぞれ、上記の情報を添えてお問い合わせを発行いただけますと幸いです。</p><p>また、招待 E メールを使用しないユーザーの追加や CSV を使用した一括招待の方法については、<a href="https://jpazureid.github.io/blog/azure-active-directory/b2bfaq/">Azure における ゲスト ユーザー招待 (B2B) のよくある質問</a> を参照ください。招待 E メールを使用しないユーザーの追加方法についても同様にこの記事の「よくある質問」をご確認ください。</p><p>Azure AD B2B で活用いただける PowerShell サンプルは <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/external-identities/code-samples?tabs=http">Azure Active Directory B2B コラボレーション コードと PowerShell サンプル</a> にまとめられておりますので、併せてご参照ください。</p><p>上記内容が少しでも皆様の参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD におけるロール管理の新しい方法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/roles-and-administrators/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/roles-and-administrators/</id>
    <published>2023-06-25T15:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.947Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2018/08/23/roles-and-administrators/">https://blogs.technet.microsoft.com/jpazureid/2018/08/23/roles-and-administrators/</a> の内容を移行したものです。</p><p>元の記事の最新の更新情報については、本内容をご参照ください。</p><p>また、PIM の活用法については、<a href="https://jpazureid.github.io/blog/azure-active-directory/pim-overview/">こちら</a> でご紹介しています。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2018-08-23: 本記事の初版を投稿</p><p>2023-06-26: Azure ポータル上のメニューの変更に伴い画面ショットや内容を更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの栗井です。</p><p>本記事は、2018 年 7 月末に公開された A new way to manage roles and administrators in Azure AD を元にしています。<br>これまで、 Azure AD の全体管理者などのロールを割り当てられているユーザー一覧を取得することができなかったのですが、最近の更新により、簡単に確認できるようになりました。<br>元記事を参考に、ユーザーへのディレクトリロールの新しい割り当て・管理方法について、画面キャプチャを含めてご紹介します。</p><p>ユーザの役割の確認や管理者権限の割り当てを、これまでより簡単におこなうことができます。</p><p>以下が、新しい機能の特徴です。</p><ul><li>ビルトイン (既定) のディレクトリロールの一覧と、それぞれの詳細を確認可能</li><li>役割の管理や設定がより簡単に</li><li>関連ドキュメントへのリンク追加</li></ul><p>言い換えますと 「全体管理者は何人いるのか？」「このユーザーに割り当てられているのは何の役割か？」がすぐ分かるようになりました。</p><p><img src="/blog/azure-active-directory/roles-and-administrators/01.png"></p><p>概要画面から、新機能「ロールと管理者」がご利用できます。</p><h2 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h2><p>ビルトイン ディレクトリ ロールの一覧とそれぞれの簡単な説明は 「ロールと管理者」をクリックすることで確認できます。これも最近追加されました Azure AD と連携するアプリケーションの管理を目的とした新しいロールも含まれます。</p><p>現在サインインして操作を実施しているユーザー自身に何かしらのロールが割り当てられている場合、画面上部に表示されます。「ロール」をクリックすると、自身に割り当てられているロールと、それぞれの概要の一覧を確認できます。</p><p><img src="/blog/azure-active-directory/roles-and-administrators/02.png"><br>図: 「ロールと管理者」下の、各ロールと説明の一覧</p><p>また、ロールの行をクリックすると、そのロールに割り当てられているユーザーの一覧が確認できます。</p><p><img src="/blog/azure-active-directory/roles-and-administrators/03.png"><br>図: ロールに割り当てられているユーザー (メンバー) 一覧</p><p>各ロールによりどのようなことができるのかという質問をよく頂きますが、それぞれのロールに何の権限があるのか、その詳細を一覧でみられるようになりました。同じ画面で、関連記事のリンクも見ることができます。ロールを最大限有効に使うためにぜひご活用ください。<br>画像に示すように、ブレードの「説明」をクリックするとこの画面が見られます。もしくはロールの一覧画面から、各行の右側にある「・・・」をクリックをすることでも、同じ画面に辿り着くことができます。</p><p>あるロールに割り当てられているユーザの一覧に加えて、その逆引きである「あるユーザーに割り当てられているロールの一覧」を見ることができるようになりました。同じ画面から、ユーザーに新たなロールを追加することができます。<br>詳細は <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/manage-roles-portal">Azure AD ロールをユーザーに割り当てる</a> をご参照ください。</p><p><img src="/blog/azure-active-directory/roles-and-administrators/04.png"><br>図: ユーザーに割り当てられているロールの一覧と「割り当ての追加」ボタン</p><p>一人のユーザーに複数の特権ロール (privileged roles) を割り当てることも可能です。既に割り当てられているものは表示されません。</p><p><img src="/blog/azure-active-directory/roles-and-administrators/05.png"><br>図: 割り当て可能なロールの一覧</p><h2 id="PIM-での更新"><a href="#PIM-での更新" class="headerlink" title="PIM での更新"></a>PIM での更新</h2><p>Privileged Identity Management (PIM) を使用することで、より細やかな権限管理が可能です。<br>尚、PIM の使用には、Azure AD Premium P2 ライセンスが必要となります。<br>PIM の管理画面は、検索窓に「PIM」と入力し、検索することで開くことができます。</p><p><img src="/blog/azure-active-directory/roles-and-administrators/06.png"><br>図: Privileged Identity Management 画面の開き方</p><p>PIM 上で Azure AD ロールを管理する際には、左ブレードで「Azure AD ロール」をクリックします。</p><p><img src="/blog/azure-active-directory/roles-and-administrators/07.png"><br>図: PIM 上で Azure AD ロールを管理する</p><p>また、Azure AD Premium P2 ライセンスをお持ちのテナントで、PIM の画面を開くと、以降、Azure AD 上の 「ロールと管理」から Azure AD ロールの管理を行う際にも、各ロールの管理画面では PIM の画面が表示されるようになります。</p><p><img src="/blog/azure-active-directory/roles-and-administrators/08.png"><br>図: 各 Azure AD ロールの管理画面の例</p><p>上記内容が少しでも参考となりますと幸いです。製品動作に関する正式な見解や回答については、お客様環境などを十分に把握したうえでサポート部門より提供させていただきますので、ぜひ弊社サポート サービスをご利用ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD B2B とは</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/what-is-b2b/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/what-is-b2b/</id>
    <published>2023-06-25T15:00:00.000Z</published>
    <updated>2023-06-19T07:52:32.003Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>本記事は Technet Blog の更新停止に伴い <a href="https://blogs.technet.microsoft.com/jpazureid/2017/12/12/about-azure-ad-b2b/">TechNet Blog</a> の内容を移行したものです。元の記事の最新の更新情報については、本内容をご参照ください。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>2017-12-12: 本記事の初版を投稿</p><p>2023-04-01: Azure ポータル上のメニューの変更に伴い画面ショットや内容を更新</p><p>2023-06-26: Azure ポータル上のメニューの変更に伴い画面ショットや内容を更新</p></div><p>こんにちは、Azure &amp; Identity サポート チームの三輪です。</p><p>今回は Azure AD B2B (Business-To-Business) コラボレーション機能 (以下、Azure AD B2B) について紹介します。この記事はもともと 2017 年 12 月に公開されましたが、その後 Azure ポータルのメニューなどが変更されたため、内容を最新版に更新いたしました。</p><p>Azure AD B2B の概要については、公開ドキュメントである <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/active-directory-b2b-what-is-azure-ad-b2b">B2B コラボレーションの概要</a> をまずご覧ください。</p><p>Azure AD B2B と聞くと、もしかしたら小難しく聞こえるかもしれませんが、要は他の Azure AD テナント上のユーザーを自テナントに追加 (招待) する機能のことです。具体的には、Azure AD を利用する中で、次のような要望がでてくることがあります。</p><ul><li>会社間 (Azure AD テナント間) で自社が公開しているリソースを共有したい</li><li>別の Azure AD テナントに紐づいているリソースを使用したい</li><li>ひとりの管理者で、複数の Azure AD テナントを管理したい 等</li></ul><p>このような連携が必要な時に利用する機能が、今回紹介する Azure AD B2B になります。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>Azure サブスクリプションは必ず 1 つの Azure AD テナントに関連付けられています。通常、このサブスクリプションが紐づく Azure AD テナントに所属しているユーザーのみがそのサブスクリプション内のリソースを管理可能です。</p><p><img src="/blog/azure-active-directory/what-is-b2b/subscription-user.png"></p><p>では、複数の Azure AD テナントがある場合はどのようになるでしょうか。この場合、そのままでは別の Azure AD テナント B からテナント A へアクセスしたり、別の Azure AD テナント A に関連付けられているサブスクリプションに Azure AD テナント B のユーザーが管理操作をおこなったりすることはできません。</p><p><img src="/blog/azure-active-directory/what-is-b2b/subscription-user-inaccessible.png"></p><p>こんな時、Azure AD B2B を利用することで、自身の Azure AD テナントに他テナントのユーザーを招待することで、ユーザー本体は別の Azure AD テナントに所属しながら、招待した側のテナントのリソースを利用することが可能となります。</p><p><img src="/blog/azure-active-directory/what-is-b2b/invite-user-to-tenant.png"></p><h2 id="詳細"><a href="#詳細" class="headerlink" title="詳細"></a>詳細</h2><p>別の Azure AD テナントのユーザーを自テナントに招待する方法で多く利用されるものを 2 つ紹介します。</p><h3 id="1-ゲスト-ユーザーの直接的な招待"><a href="#1-ゲスト-ユーザーの直接的な招待" class="headerlink" title="1. ゲスト ユーザーの直接的な招待"></a>1. ゲスト ユーザーの直接的な招待</h3><p>明示的に別の Azure AD テナントのユーザー (または outlook.com や gmail.com など外部アカウント) を招待し追加する操作です。Azure ポータルのメニューより [Azure Active Directory] – [ユーザーとグループ] – [すべてのユーザー] – [新しいユーザー] の順に進みます。下記、[外部ユーザーの招待] からユーザーの E メール アドレス (もしくは Azure AD の UPN) を追加します。</p><p><img src="/blog/azure-active-directory/what-is-b2b/screenshot-new-guest-user-new.png"></p><p>[招待メッセージの送信] にチェックを入れると、指定されたユーザーに招待 E メールが送られますので、E メールを受け取ったユーザーは、その E メールのリンクからウィザードを完了することができます。</p><p><img src="/blog/azure-active-directory/what-is-b2b/screenshot-sendmail.png"></p><h3 id="2-RBAC-アクセス制御-IAM-によるユーザーの招待"><a href="#2-RBAC-アクセス制御-IAM-によるユーザーの招待" class="headerlink" title="2. RBAC (アクセス制御 IAM) によるユーザーの招待"></a>2. RBAC (アクセス制御 IAM) によるユーザーの招待</h3><p>RBAC を用いて、Azure サブスクリプションに紐づけられている Azure AD テナント上のユーザーに対してアクセス許可を割り当てることができます。では、RBAC でアクセス権を割り当てるときに別の Azure AD テナントのユーザーを指定したい時には、先に 1 の作業を実施しておく必要があるのでしょうか？</p><p>いいえ、もしアクセス許可を割り当てようとしているユーザーがそのテナントに存在していない場合には、RBAC の設定時に自動的に 1 のユーザー招待も併せて行われます。手順としては、Azure ポータルの [サブスクリプション] – [サブスクリプション名] – [アクセス制御 (IAM)] の順にお進みください。下記、[追加] から別の Azure AD テナントのユーザーを追加することができます。指定された E メール アドレスには、招待 E メールが送られ、その E メールよりウィザードを完了する流れは同様になりますが、同時にサブスクリプションに対するロールが割り当てられます。</p><p><img src="/blog/azure-active-directory/what-is-b2b/screenshot-iam-new.png"></p><h2 id="よくあるお問い合わせ"><a href="#よくあるお問い合わせ" class="headerlink" title="よくあるお問い合わせ"></a>よくあるお問い合わせ</h2><p><span style="color:blue">Q</span>. B2B の機能以外で Azure AD 間の連携を行うことは可能ですか？</p><p><span style="color:red">A</span>. いいえ、テナント間での連携を行いたい場合は、Azure AD B2B を利用することが基本です。Azure AD のテナント間同機の仕組みでも、Azure AD B2B の仕組みが利用されています。Azure AD B2B の機能は Azure AD のテナント同士を連携するものではなく、 Azure AD テナントと別の Azure AD テナントのユーザーを連携する機能とお考えください。</p><p><span style="color:blue">Q</span>. 別の Azure AD テナントに登録されたアプリケーションを利用するのに、Azure AD B2B の機能を利用できますか？</p><p><span style="color:red">A</span>. はい、B2B の機能で要件を満たせます。Azure AD B2B の機能で別の Azure AD テナントのユーザーを自テナントに招待することで、その招待されたユーザーが 自テナント (自社の Azure AD テナント) 上のアプリケーションを利用することが可能となります。</p><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>今回は、Azure AD B2B に関する概要について紹介しました。Azure AD B2B に関するトラブルや Azure AD B2B 完了後のトラブル、または招待 E メールを利用しない方法などの記事も必要に応じて参照ください。また、それでも問題が解決しない場合は、弊社サポートまで遠慮なくお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;本記事は Technet Blog の更新停止に伴い &lt;a href=&quot;https://blogs.technet.microsoft.com/jpazure</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="RBAC" scheme="https://jpazureid.github.io/blog/tags/RBAC/"/>
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>Staged Rollout について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/about-staged-rollout/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/about-staged-rollout/</id>
    <published>2023-06-18T15:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.379Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの田中です。</p><p>今回は、先日 Public Preview として利用可能になった、フェデレーション ドメインに属しているユーザーの一部のみをマネージド 認証に変更できる Staged Rollout 機能についてご紹介します。</p><blockquote><p>更新履歴</p><p>2023/6/19 プレビュー記載の削除。画面ショットの更新</p></blockquote><h1 id="Staged-Rollout-とは？"><a href="#Staged-Rollout-とは？" class="headerlink" title="Staged Rollout とは？"></a>Staged Rollout とは？</h1><p>フェデレーションによる認証からマネージド認証 (パスワードハッシュ同期 / パススルー認証) への認証方式の変更に伴うユーザー影響を軽減するための機能を指します。<br>これにより、少しずつユーザーの認証方式を変更できるというメリットがあります。</p><p>例えば、以下のようなシナリオが挙げられます。</p><ul><li>シナリオ<br>ユーザー A および ユーザー B は、共に同じ <code>contoso.com</code> というフェデレーション ドメインを持つユーザーである。</li></ul><p>ユーザー A の UPN : <code>test.user0001@contoso.com</code><br>ユーザー B の UPN : <code>adfstestuser01@contoso.com</code></p><p>Staged Rollout 機能が割り当てられているユーザー A : マネージド認証 (パスワード ハッシュ同期 / パススルー認証)<br>Staged Rollout 機能が割り当てられていないユーザー B : フェデレーションによる認証</p><p>詳細については、後述いたします。</p><h1 id="Staged-Rollout-の構成手順"><a href="#Staged-Rollout-の構成手順" class="headerlink" title="Staged Rollout の構成手順"></a>Staged Rollout の構成手順</h1><p>Staged Rollout の構成手順につきましては、以下の公開情報でもご紹介しております。<br>そのため、まずは以下の公開情報をご参照いただき、ご不明点などございましたら、弊社サポート チームにお問い合わせいただければ幸いです。</p><p>Title : 段階的なロールアウトを使用してクラウド認証に移行する</p><p>URL : <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-staged-rollout">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-staged-rollout</a></p><p>以下では、上述のシナリオに基づいて、実際の構成手順を一部抜粋して、ご案内します。</p><p>[ドメイン状態]</p><ul><li><code>contoso.com</code> : Federated</li></ul><p>[グループおよびグループに含まれるユーザーの構成情報]</p><table><thead><tr><th></th><th>グループ名<br>TEST0602</th></tr></thead><tbody><tr><td>ユーザー A <br><code>test.user0001@contoso.com</code></td><td><font color="Red">〇</font> (含まれる)</td></tr><tr><td>ユーザー B <br><code>adfstestuser01@contoso.com</code></td><td>x  (含まれていない)</td></tr></tbody></table><p>TEST0602 のグループに対して、以下のように、Staged Rollout 機能におけるパスワード ハッシュ同期を割り当てます。</p><p><img src="/blog/azure-active-directory/about-staged-rollout/apply-phs1.png"></p><p><img src="/blog/azure-active-directory/about-staged-rollout/apply-phs2.png"></p><p>[認証方式]</p><ul><li><code>test.user0001@contoso.com</code> のユーザーで認証を試みます。(グループに <strong>含まれる</strong> ユーザー)<br>⇒ フェデレーション認証の場合だとリダイレクトされますが、リダイレクトされておらず、パスワード ハッシュ同期による認証方式が適用されていることが、以下の画面キャプチャからもご確認いただけます。<br>※なお、[グループおよびグループに含まれるユーザーの構成情報] において、Staged Rollout 機能におけるパススルー認証を割り当てても、以下の画面キャプチャと同様のサインイン画面が表示されます。</li></ul><p><img src="/blog/azure-active-directory/about-staged-rollout/input-password.png"></p><ul><li><code>adfstestuser01@contoso.com</code> のユーザーで認証を試みます。 (グループに <strong>含まれていない</strong> ユーザー)<br>⇒ AD FS による認証方式が適用されていることが、以下の画面キャプチャからもご確認いただけます。</li></ul><p><img src="/blog/azure-active-directory/about-staged-rollout/adfs-signinpage.png"></p><p>このように、上記の 2 ユーザー共に、同じフェデレーション ドメイン (例 : <code>contoso.com</code>) を使用しているにも関わらず、Staged Rollout 機能を割り当てたグループに含まれるユーザーは、マネージド 認証が適用されます。</p><h1 id="Staged-Rollout-に関してよくある-Q-amp-A-集"><a href="#Staged-Rollout-に関してよくある-Q-amp-A-集" class="headerlink" title="Staged Rollout に関してよくある Q&amp;A 集"></a>Staged Rollout に関してよくある Q&amp;A 集</h1><p><strong>Q. 認証方式の切替を行う際、ユーザー単位での認証方式の変更は必要なく (全ユーザーに対する認証方式を行う想定)、認証方式の変更に要する時間として、ドメイン単位でフェデレーション解除するよりも Staged Rollout 機能を用いた方が、反映時間は短く済むのでしょうか？</strong></p><p>A. いいえ、ドメイン単位でフェデレーション解除をご実施いただいた方が反映時間が短く済みます。<br>なお、ドメイン単位でフェデレーション解除するコマンドとして、<code>Convert-MSOLDomainToStandard</code> または <code>Set-MsolDomainAuthentication</code> がありますが、ユーザーのパスワード リセットを行うような要件がない場合、<code>Set-MsolDomainAuthentication</code> をご利用ください。※</p><p>※<br><code>Convert-MSOLDomainToStandard</code> コマンドは、ユーザーのパスワード リセットを行う要件がある場合に利用します。このコマンドを実行すると、それぞれのユーザー単位での処理を試行するため、ユーザー数に比例して認証方式の切り替えに時間を要します。</p><p>一方、<code>Set-MsolDomainAuthentication</code> コマンドは、ドメイン単位で認証方式の切り替えのみを行うコマンドであるため、即時的に認証方式の切り替えを行うことができます。なお、過去の事例では、<code>Set-MsolDomainAuthentication</code> コマンドによる認証方式の切り替えに伴い一時的に問題が生じる可能性があります。切り替えに要する時間は、 下記の公開情報でご案内しておりますとおり、最大でも 4 時間ですが、この間に一時的にユーザー認証にも問題が発生する可能性がある点についてはご注意ください。</p><ul><li>参考情報<br>Title : メンテナンス期間の計画<br>URL : <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/plan-migrate-adfs-password-hash-sync#plan-deployment-and-support">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/plan-migrate-adfs-password-hash-sync#plan-deployment-and-support</a></li></ul><div class="alert is-warning"><p class="alert-title">警告</p><p>2023/6/30 以降、 上記にて案内しております Set-MsolDomainAuthentication や Convert-MSOLDomainToStandard コマンドは、 MSOL コマンドのため廃止される予定です。</p><p>代替として、現在は New-MgDomainFederationConfiguration と Remove-MgDomainFederationConfiguration コマンドを利用します。</p></div><blockquote><p>Remove コマンドでは、フェデレーションからマネージドへの切り替えを行います。実行例は下記の通りです。</p></blockquote><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgDomainFederationConfiguration</span> <span class="literal">-DomainId</span> &lt;カスタム ドメイン名&gt; | <span class="built_in">fl</span></span><br><span class="line"><span class="built_in">Remove-MgDomainFederationConfiguration</span> <span class="literal">-DomainId</span> &lt;カスタムドメイン名&gt; <span class="literal">-InternalDomainFederationId</span> &lt;<span class="built_in">Get-MgDomainFederationConfiguration</span> コマンドの Id を入力&gt;</span><br></pre></td></tr></table></figure><blockquote><p>New コマンドでは、各種パラメータを指定することでマネージド ドメインからフェデレーション ドメインへの切り替えが可能です。実行例は下記の通りです。</p></blockquote><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">New-MgDomainFederationConfiguration</span> <span class="literal">-DomainId</span> <span class="string">&quot;&lt;カスタム ドメイン名&gt;&quot;</span> <span class="literal">-PreferredAuthenticationProtocol</span> <span class="string">&quot;wsFed&quot;</span> <span class="literal">-ActiveSignInUri</span> <span class="variable">$Active</span> <span class="literal">-DisplayName</span> <span class="variable">$display</span> <span class="literal">-IssuerUri</span> <span class="variable">$issuer</span> <span class="literal">-MetadataExchangeUri</span> <span class="variable">$Meta</span> <span class="literal">-NextSigningCertificate</span> <span class="variable">$NextCert</span> <span class="literal">-PassiveSignInUri</span> <span class="variable">$Passive</span> <span class="literal">-SignOutUri</span> <span class="variable">$SignOUt</span> <span class="literal">-SigningCertificate</span> <span class="variable">$SignCert</span> <span class="literal">-FederatedIdpMfaBehavior</span> <span class="variable">$MFA</span> | <span class="built_in">Format-List</span>![<span class="type">image</span>](https://github.com/jpazureid/blog/assets/<span class="number">70502265</span>/<span class="number">04978</span>b92<span class="literal">-ccba</span><span class="literal">-4001</span><span class="literal">-9793</span><span class="literal">-4092bf9237b0</span>)</span><br></pre></td></tr></table></figure><p><strong>Q. Staged Rollout 機能を対象グループに割り当てたときの反映時間について、教えてください。</strong></p><p>A. ユーザーが段階的ロールアウトの対象になりますと Azure AD の監査イベントが記録され、実際のユーザーの認証方式変更は、その後にバックグラウンドで実施されます。<br>この認証方式の変更が有効になるまでに最大 24 時間かかることがあります。</p><p>そのため、すべてのユーザーに対する監査イベントが記録されたことを確認後、バックグラウンドの処理が完了するまで約 4 時間をお待ちいただく必要があります。</p><p>過去事例におきましては、17,000 ユーザーを Staged Rollout 対象グループに追加した後、最初のユーザーに対して監査イベントが記録されてから、最後のユーザーのイベントが記録されるまでに 1 時間 30 分ほどの時間を要したという情報がございます。</p><ul><li>参考情報<br>監査イベントの記録につきましては、下記の公開情報をご参照ください。<br>Title : 監査<br>URL : <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-staged-rollout#auditing">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-staged-rollout#auditing</a></li></ul><p><strong>Q. Staged Rollout 機能を割り当てている状態において、Hybrid Azure AD Join の構成を行おうとしていますが、このような構成は可能でしょうか。</strong></p><p>A. Windows 10 version 1903 以降であれば、Hybrid Azure AD Join 構成を有効にした状態で、Staged Rollout 機能をご利用いただくことができます。</p><p>理由といたしましては、Windows 10 version 1903 より前のバージョンでは、フェデレーション認証の場合、必ず AD FS との通信が発生するのに対し、Windows 10 version 1903 以降では、ユーザーごとにフェデレーション認証を行うかどうかを識別する機能が実装されているためです。</p><p><strong>Q. 検証用にステージロールアウトを有効化しますが、検証完了後は無効化する予定です。無効化した際に正常に戻っていることを確認したいですが、どのように確認すればよいでしょうか。</strong></p><p>A. ロールバックの手順で無効化した後は、同期ユーザーにて Microsoft 365 ポータルや Azure ポータル、マイ アプリ ポータル等にブラウザーでアクセスし、フェデレーション認証方式でサインインができれば正常に戻っているとご判断ください。​</p><p><strong>Q. Staged Rollout はいつ頃 GA されますか。</strong></p><p>A. 2020 年 4 月末時点ではパブリック プレビュー状態でしたが、2023 年 6 月現在、本機能はすでに一般提供が開始されております。<br>これまでプレビュー機能の利用が難しく利用できなかったお客様も、ぜひご利用ください。</p><p><strong>Q. Staged Rollout 機能を利用するとき、事前に Azure AD Connect のユーザーのサインイン方式として、何が選択されていればいいでしょうか。</strong></p><p>A. [構成しない] または [AD FS とのフェデレーション] のいずれかが選択されている必要があります。</p><p><strong>Q. 以前にシームレス SSO を構成していた、または PTA を構成していた場合は、コンピューターアカウントを削除し、PTA エージェントも削除しておく必要があるでしょうか。</strong></p><p>A. はい、コンピューター アカウントの削除および PTA エージェントの削除を事前に行う必要があります。</p><p><strong>Q. 最終的にマネージド認証に移行する場合の手順について教えてください。</strong></p><p>A. PowerShell コマンド <code>New-MgDomainFederationConfiguration</code> を用いて、該当ドメインをマネージド ドメインに変更、あるいは Azure AD Connect 構成ウィザードにてユーザーのサインイン方式を [パススルー認証] または [パスワード ハッシュの同期] に設定する (自動的にマネージド ドメインに変更される) 必要があります。</p><p><strong>Q. AD FS とのフェデレーション認証への切り戻し方法について教えてください。</strong></p><p>A. Azure AD Connect にて AD FS を管理する場合と、Azure AD Conneect にて AD FS 管理しない場合で、切り戻し方法が異なります。</p><ul><li><p>Azure AD Connect にて AD FS を管理する場合<br>  Azure AD Connect のユーザー のサインイン方式として、[AD FS とのフェデレーション] を選択します。</p></li><li><p>Azure AD Conneect にて AD FS を管理しない場合<br>  Azure AD Connect のユーザーのサインイン方式として、[構成しない] を選択します。<br>  その後、 <code>New-MgDomainFederationConfiguration</code>を PowerShell にて実行します。</p></li></ul><p>上記内容が少しでも参考となりますと幸いです。<br>なお、製品動作に関する正式な見解や回答については、お客様環境などを十分に把握したうえでサポート部門より提供させていただきますので、ぜひ弊社サポート サービスをご利用ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの田中です。&lt;/p&gt;
&lt;p&gt;今回は、先日 Public Preview として利用可能になった、フェデレーション ドメインに属しているユーザーの一部のみをマネージド 認証に変更できる Staged Rollout 機</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Staged Rollout" scheme="https://jpazureid.github.io/blog/tags/Staged-Rollout/"/>
    
    <category term="Federation" scheme="https://jpazureid.github.io/blog/tags/Federation/"/>
    
  </entry>
  
  <entry>
    <title>重要 - Azure AD Graph の廃止と PowerShell モジュールの非推奨</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/important-azure-ad-graph-retirement-and-powershell-module/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/important-azure-ad-graph-retirement-and-powershell-module/</id>
    <published>2023-06-18T00:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.743Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 6 月 15 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/important-azure-ad-graph-retirement-and-powershell-module/ba-p/3848270">Important: Azure AD Graph Retirement and Powershell Module Deprecation</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>2019 年に、弊社では Azure AD Graph サービスの <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">非推奨を発表</a> しました。さらに 1 年前、Azure AD Graph が 2023 年 6 月 30 日以降に廃止され機能しなくなることも <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">お伝え</a> しました。また、3 つのレガシーな PowerShell モジュール (Azure AD、Azure AD Preview、MS Online) が 2023 年 6 月 30 日に非推奨になることも以前にお伝えしました。</p><p>この度、これら変更のタイムラインに関して最新情報を提供するとともに、今後生じる対応についてさらに明確な情報を提供したいと思います。Azure AD Graph と 3 つの PowerShell モジュールに新たな投資は行われないため、<strong>すべてのお客様</strong> が Microsoft Graph API と Microsoft Graph PowerShell SDK への移行を優先し、サポートと機能の継続を確保することが非常に重要となっています。  </p><p>しかし、弊社としてまだ多くのお客様がこれらの移行を完了していないことを認識しております。この移行期間中にお客様と協力し、影響を最小限に抑えるために引き続きお客様と共に取り組むことを確認いたします。</p><h2 id="Azure-AD-Graph-に関する更新情報"><a href="#Azure-AD-Graph-に関する更新情報" class="headerlink" title="Azure AD Graph に関する更新情報"></a>Azure AD Graph に関する更新情報</h2><ul><li>2023 年 6 月 30 日に Azure AD Graph の利用に変更はなく、この日に Azure AD Graph を使用するアプリケーションに影響は生じません。</li><li>2023 年 6 月 30 日は、Azure AD Graph の非推奨が通知されてから 3 年間が経過したことを意味します。今後、Azure AD Graph API は廃止に向けたサイクルに入ります。</li><li>当社は Azure AD Graph にこれ以上投資することはなく、Azure AD Graph API にはセキュリティ関連の修正を除き、SLA やメンテナンスの保証は致しません。</li><li>Azure AD Graph は段階的に廃止されていき、アプリケーションが Microsoft Graph API に移行できるよう十分な時間を確保できるようにします。最初のステップでは、今後新規に作成されたアプリケーションで Azure AD Graph API を使用できないようにする予定です。この最初のステップの実施日程は今後発表する予定で、実施日の 3 ヶ月前にはお知らせいたします。</li><li>この廃止に向けたサイクルの各ステップについては、期待されることや必要なアクションの詳細を定期的に発表していきます。</li></ul><h2 id="PowerShell-モジュールに関する更新情報"><a href="#PowerShell-モジュールに関する更新情報" class="headerlink" title="PowerShell モジュールに関する更新情報"></a>PowerShell モジュールに関する更新情報</h2><ul><li>以前に <a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">お知らせ</a> したとおり、レガシーな <strong>ライセンス割り当て</strong> PowerShell コマンドレット (Set-AzureADUserLicense、Set-MsolUserLicense、-LicenseAssignment または New-MsolUser の -LicenseOptions パラメーター）および Azure AD Graph API (assignLicense) は廃止されました。これらのコマンドレットおよび API の利用延長を申請されていたお客様については、<strong>2023 年 9 月 30 日</strong> までに Microsoft Graph のライセンス割り当て API/PowerShell への移行を完了する必要があります。</li><li>当社では Microsoft Graph PowerShell SDK でまだ実現できないいくつかのシナリオにおいて、レガシーな PowerShell モジュールが必要であることを認識しています。そのため、MS Online、AzureAD、AzureAD Preview の PowerShell モジュールの非推奨の期限を <strong>2024 年 3 月 30 日</strong> に延期します。</li></ul><h2 id="2023-年-6-月-30-日に-Azure-AD-Graph-を使用しているアプリケーションはどうなりますか？"><a href="#2023-年-6-月-30-日に-Azure-AD-Graph-を使用しているアプリケーションはどうなりますか？" class="headerlink" title="2023 年 6 月 30 日に Azure AD Graph を使用しているアプリケーションはどうなりますか？"></a>2023 年 6 月 30 日に Azure AD Graph を使用しているアプリケーションはどうなりますか？</h2><p>2023 年 6 月 30 日のマイルストーンにおいて、Azure AD Graph を使用しているアプリケーションに影響はありません。アプリケーションは引き続き機能しますが、Azure AD Graph API には SLA やメンテナンスの提供がなくなります (セキュリティ関連の修正を除く)。当社は近い将来、廃止に向けた最初のステップ (新しく作成されたアプリケーションが Azure AD Graph を使用しないようにブロックする) のタイムラインと詳細を明確にするべく追加情報を提供する予定です。</p><h2 id="2023-年-6-月-30-日に-Azure-AD、Azure-AD-Preview、または-MS-Online-モジュールを使用する-PowerShell-スクリプトはどうなりますか？"><a href="#2023-年-6-月-30-日に-Azure-AD、Azure-AD-Preview、または-MS-Online-モジュールを使用する-PowerShell-スクリプトはどうなりますか？" class="headerlink" title="2023 年 6 月 30 日に Azure AD、Azure AD Preview、または MS Online モジュールを使用する PowerShell スクリプトはどうなりますか？"></a>2023 年 6 月 30 日に Azure AD、Azure AD Preview、または MS Online モジュールを使用する PowerShell スクリプトはどうなりますか？</h2><p>2023 年 6 月 30 日以降もこれらのレガシー モジュールを使用する PowerShell スクリプトには何の影響もありません。これらのモジュールは、非推奨のアナウンスがあるまで機能し続け、サポートされます。</p><h2 id="2024-年-3-月-30-日以降、Azure-AD、Azure-AD-Preview、または-MS-Online-モジュールを使用する-PowerShell-スクリプトはどうなりますか？"><a href="#2024-年-3-月-30-日以降、Azure-AD、Azure-AD-Preview、または-MS-Online-モジュールを使用する-PowerShell-スクリプトはどうなりますか？" class="headerlink" title="2024 年 3 月 30 日以降、Azure AD、Azure AD-Preview、または MS Online モジュールを使用する PowerShell スクリプトはどうなりますか？"></a>2024 年 3 月 30 日以降、Azure AD、Azure AD-Preview、または MS Online モジュールを使用する PowerShell スクリプトはどうなりますか？</h2><p>Azure AD、Azure AD Preview、MS Online の PowerShell モジュールは、2024 年 3 月 30 日に非推奨となる予定です。この日以降、これらの PowerShell モジュールに対して提供されるサポートは、Microsoft Graph PowerShell SDK への移行サポートのみとなります。非推奨の発表後、これらの PowerShell モジュールにはセキュリティ修正のみが提供されます。これらのモジュールが非推奨となった後も、最低 6 ヶ月間は動作し続け、その後に廃止される予定です。</p><p>当社は、Microsoft Graph プラットフォームへのスムーズな移行を可能にするため、お客様との協力に努めてまいります。弊社はこのプロセスを通じて、さらなるコミュニケーション、移行を支援するツールのアップデート、および明確な情報を定期的に提供する予定です。</p><h2 id="Azure-AD-Graph-とレガシー-PowerShell-モジュールの現在のサポート状況"><a href="#Azure-AD-Graph-とレガシー-PowerShell-モジュールの現在のサポート状況" class="headerlink" title="Azure AD Graph とレガシー PowerShell モジュールの現在のサポート状況"></a>Azure AD Graph とレガシー PowerShell モジュールの現在のサポート状況</h2><ul><li>Azure AD Graph は現在非推奨であり、セキュリティ関連の修正のみ提供される予定です。</li><li>Azure AD、Azure AD Preview、および MS Online PowerShell モジュールは、まだ非推奨ではありませんが今後非推奨となります。これらのモジュールはサポートされていますが、新しい機能は追加されません。</li></ul><h2 id="必要な対応"><a href="#必要な対応" class="headerlink" title="必要な対応"></a>必要な対応</h2><ol><li>Azure AD Graph を使用しているアプリケーションを特定し、同等の Microsoft Graph API を使用するように移行ください。Microsoft Graph は機能が豊富な API プラットフォームであり、Microsoft Entra、Exchange、Teams、SharePoint、および Microsoft 365 を含む多くの Microsoft サービスで統一された API を提供します。  参考情報: <a href="https://learn.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-overview">Azure AD Graph から Microsoft Graph にアプリを移行する</a></li><li>レガシー モジュールを使用する PowerShell スクリプトを特定し、Microsoft Graph PowerShell SDK を使用するように更新ください。  参考情報: <a href="https://learn.microsoft.com/ja-jp/powershell/microsoftgraph/migration-steps?view=graph-powershell-1.0">Azure AD PowerShell から Microsoft Graph PowerShell に移行する</a></li></ol><p>最後に、利用可能なツールとして以下をご参照ください。</p><ul><li>Microsoft Graph PowerShell SDK への PowerShell コマンドレットの <a href="https://learn.microsoft.com/ja-jp/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">マッピング</a></li><li><a href="https://www.powershellgallery.com/packages/Microsoft.Graph.Compatibility.AzureAD/0.3.0-preview">Microsoft Graph PowerShell 互換性アダプター</a></li><li><a href="https://learn.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-planning-checklist">Azure AD Graph アプリ移行計画のチェックリスト</a></li><li><a href="https://github.com/microsoft/AzureADGraphApps">Azure AD Graph を使用している可能性のあるアプリを特定するスクリプト</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 6 月 15 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>条件付きアクセスの認証強度 一般提供開始のお知らせ</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/ca-authentication-strength-ga/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/ca-authentication-strength-ga/</id>
    <published>2023-06-17T23:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.503Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 長谷川 です。</p><p>本記事は、2023 年 5 月 31 日に米国の Microsoft Entra (Azure AD) Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/conditional-access-authentication-strength-is-now-generally/ba-p/3773134">Conditional Access authentication strength is now Generally Available!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>こんにちは！ <strong>条件付きアクセスの認証強度</strong> の一般提供開始をお知らせできることを嬉しく思います。この強力な機能により、組織は特定のシナリオに適した認証方法の要件を選択できるようになり、より安全で先進的かつ強力な認証への移行がこれまで以上に容易になります。</p><p>条件付きアクセス認証強度を使用すると、管理者は、ユーザーのサインイン リスク レベルやアクセスするリソースの機密性などの要因に基づいて、アクセスに必要な認証強度の最低レベルを定義することができます。これは、規制の厳しい業界で活動する組織や、厳格なコンプライアンス要件を持つ組織にとって、特に有用です。例えば、 <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/standards/memo-22-09-multi-factor-authentication">アメリカ合衆国行政管理予算局 (OMB) の覚書 22-09</a> を遵守する必要がある米国政府機関などです。認証強度は、政府機関のお客様が従業員やベンダーに対してフィッシングに強い MFA を強制するのに役立ちます。</p><p><img src="/blog/azure-active-directory/ca-authentication-strength-ga/Figure1.png" alt="図1: 認証強度 - フィッシングに強い MFA"></p><p>組織は、自身のニーズとリスクに基づいて、あらかじめ定義された認証強度ポリシーから選択するか、独自のカスタム認証強度ポリシーを定義することができます。これらのポリシーは、テナント内のメンバーや、あらゆるマイクロソフト クラウドからの外部ユーザーに対して適用することができます。これにより、企業はベンダーやパートナーに対する認証要件の水準を引き上げることができます。</p><p>すでに多くの組織で、さまざまな方法で条件付きアクセス認証強度を使用しているのを目にします。例えば、以下のようなものです:</p><ul><li>ある政府機関では、認証強度を使用して、Azure Active Directory (Azure AD) によって保護されている任意のリソースに対する認証に証明書ベースの認証 (CBA) を強制する一方、従来のオンプレミス アプリケーションの利用に必要なパスワード リセットには他の認証方法を許可している。</li><li>とある専門的なサービスを提供する企業では、認証強度を利用して、特権ユーザーに FIDO2 の利用を強制し、幅広いユーザー層に対して電話回線ベースの方式から徐々に移行している。</li><li>別のソフトウェア会社では、認証強度を利用して、所有する複数のテナントで認証方法の標準化を徹底している。</li></ul><p>条件付きアクセスの認証強度の詳細はこちらをご確認ください: <a href="https://aka.ms/authstrengthdocs">https://aka.ms/authstrengthdocs</a></p><p>この強力な機能をぜひお試しいただき、ご意見をお聞かせください！</p><p>よろしくお願いします。</p><p>Alex Weinert (twitter: @Alex_t_weinert)<br>VP Director of Identity Security, Microsoft</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 長谷川 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 31 日に米国の Microsoft Entra (Azure AD) Blog で公開された &lt;a href=&quot;https://techcommun</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD Connect に関するよくある質問</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/azureadconnect_faq/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/azureadconnect_faq/</id>
    <published>2023-06-15T15:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.187Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！ Azure ID チームの小出です。</p><p>Azure AD Connect (AADC) のお問い合わせが多いご質問について、以前 2020 年に Q&amp;A 形式でおまとめいたしておりましたが、バージョンも v2 となり記事が古くなってまいりました。<br>今回改めて記事を更新し、最新のよくある質問としてカテゴリ別におまとめいたしました。<br>既存のドキュメントではカバーされていない動作や質問について、今後も適宜内容を拡充していきますので、ご参照いただければと思います。</p><h2 id="Azure-AD-Connect-の構成について"><a href="#Azure-AD-Connect-の構成について" class="headerlink" title="Azure AD Connect の構成について"></a>Azure AD Connect の構成について</h2><h3 id="Q-AADC-の-Active-Stand-By-アクティブ-スタンバイ-の構成が行えるか？"><a href="#Q-AADC-の-Active-Stand-By-アクティブ-スタンバイ-の構成が行えるか？" class="headerlink" title="Q. AADC の Active / Stand By (アクティブ / スタンバイ) の構成が行えるか？"></a><strong>Q. AADC の Active / Stand By (アクティブ / スタンバイ) の構成が行えるか？</strong></h3><p><strong>A.</strong> いいえ。AADC はクラスター構成を実装していません。<br>AADC を同一フォレスト内で 2 台以上構成した場合でも、各 AADC で死活監視を行う実装はなく、自動的にアクティブ サーバーを切り替える実装もありません。<br>冗長構成をご検討の場合は、アクティブ サーバーの 1 台以外はステージング モードを有効化し、必要に応じて手動でアクティブ サーバーを切り替えてご利用ください。</p><h3 id="Q-ステージング-サーバーについての詳細を教えてください"><a href="#Q-ステージング-サーバーについての詳細を教えてください" class="headerlink" title="Q. ステージング サーバーについての詳細を教えてください"></a><strong>Q. ステージング サーバーについての詳細を教えてください</strong></h3><p><strong>A.</strong> Azure AD Connect で冗長構成を行うために利用する「ステージング モード」を有効にしたサーバーです。<br>Azure AD Connect では同期に際し、Import、 Synchronization、 Export の 3 つの処理があり、 Export 処理が完了すると、Azure AD 側にユーザーが作成されたり、値が更新されたりします。<br>ステージング モードが有効な場合、Import、 Synchronization の処理は行われますが、 Export 処理は行われません。<br>アクティブなサーバーと同じ構成にして利用するサーバーとなるため、何かあった際にステージング モードをオフにすれば、アクティブなサーバーとして利用できます。<br>詳細は<a href="/blog/azure-active-directory-connect/introduction-staging-server/">こちら</a> をご参照ください。  </p><h3 id="Q-1-つのアカウントを複数の-Azure-AD-へ同期することはできますか？"><a href="#Q-1-つのアカウントを複数の-Azure-AD-へ同期することはできますか？" class="headerlink" title="Q. 1 つのアカウントを複数の Azure AD へ同期することはできますか？"></a><strong>Q. 1 つのアカウントを複数の Azure AD へ同期することはできますか？</strong></h3><p><strong>A.</strong> はい、できます。以前はこのシナリオはサポートされていませんでしたが、現在は利用可能です。<br>ただし注意点が複数ありますので、必ず<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/plan-connect-topologies#sync-ad-objects-to-multiple-azure-ad-tenants">こちら</a> にて最新の情報をご確認ください。</p><h3 id="Q-お勧めの-AADC-の構成を教えてください"><a href="#Q-お勧めの-AADC-の構成を教えてください" class="headerlink" title="Q. お勧めの AADC の構成を教えてください"></a><strong>Q. お勧めの AADC の構成を教えてください</strong></h3><p><strong>A.</strong> お客様の要望・要件によって異なりますが、一般的に単一の Azure AD Connect サーバーだけではなく、加えてステージング モードのサーバーを一台以上利用することをお勧めします。<br>何か問題が起きた際に同期ができなくなってしまうこと、またバージョン アップに際し、より慎重な「スウィング移行」の手順を利用できるためです。</p><p>また、パスワードをクラウド上に保管できる要件の場合は、パスワード ハッシュ同期を利用することをお勧めします。オンプレミス AD が利用できない状態のとき、パスワード ハッシュが同期されていないと、オンプレミス側にもクラウド側にもアクセスできなくなってしまうためです。<br>パスワード ハッシュが同期されていれば、オンプレミス側の環境にはアクセスできなくても、 Microsoft 365 や Azure の機能にはサインインでき、業務が完全に停止することを防げます。</p><p>その他、通信要件などが理由で Azure AD Connect Health を利用できていないお客様が多く見受けられますが、トラブル シューティングに際し弊社側からも情報を確認できるよう、正常に利用できる状態とすることをお勧めします。</p><h3 id="Q-Azure-AD-Connect-Cloud-Sync-というのがあるのを知りました。-Azure-AD-Connect-との違いを教えてください。"><a href="#Q-Azure-AD-Connect-Cloud-Sync-というのがあるのを知りました。-Azure-AD-Connect-との違いを教えてください。" class="headerlink" title="Q. Azure AD Connect Cloud Sync というのがあるのを知りました。 Azure AD Connect との違いを教えてください。"></a><strong>Q. Azure AD Connect Cloud Sync というのがあるのを知りました。 Azure AD Connect との違いを教えてください。</strong></h3><p><strong>A.</strong> Cloud Sync  (クラウド同期) は、 Azure AD Connect に代わる新しい同期機能です。<br>Azure AD Connect では、 Azure AD Connect 用のサーバーを一般的に構築し、 Azure AD Connect をインストールしていました。<br>同期処理の管理や同期ルールの編集などは、これまで Azure AD Connect サーバーで行っていたかと思いますが、クラウド同期を利用すると、任意のサーバーにエージェントを入れるだけで、様々な設定を Azure ポータル上で行うことができるようになります。 Box や Salesforce への Saas プロビジョニングや、テナント間同期の機能を利用されているお客様にとっては、なじみのある画面で設定を行うことができます。</p><p>ただし、現時点では Azure AD Connect で用意されている機能をすべて代替できるわけではありません。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/cloud-sync/what-is-cloud-sync#comparison-between-azure-ad-connect-and-cloud-sync">こちら</a>からサポートされている機能一覧を必ず確認してください。</p><h3 id="Q-現在オンプレミスと同期をしていますが、Azure-AD-Connect-を廃止して、クラウド専用のユーザーにしたいです。どうすればいいですか？"><a href="#Q-現在オンプレミスと同期をしていますが、Azure-AD-Connect-を廃止して、クラウド専用のユーザーにしたいです。どうすればいいですか？" class="headerlink" title="Q. 現在オンプレミスと同期をしていますが、Azure AD Connect を廃止して、クラウド専用のユーザーにしたいです。どうすればいいですか？"></a><strong>Q. 現在オンプレミスと同期をしていますが、Azure AD Connect を廃止して、クラウド専用のユーザーにしたいです。どうすればいいですか？</strong></h3><p><strong>A.</strong> 下記の手順をご利用ください。</p><p><strong>1. サインイン方式を無効化します</strong></p><pre><code>1-1. AADC サーバーにて、AADC の構成ウィザードを開きます。1-2. [構成] ボタンをクリックし、[ユーザー サインインの変更] を選択して、[次へ] をクリックします。1-3. テナントの全体管理者情報を入力して、[次へ] をクリックします。1-4. [パスワード ハッシュの同期] あるいは [構成しない] を選択します。1-5. [シングル サインオンを有効にする] からチェックを外し、[次へ] をクリックします。1-6. [構成の準備完了] 画面にて [構成が完了したら、同期プロセスを開始してください。] のチェックを外し、[構成] をクリックします。</code></pre><p><strong>2. ディレクトリ同期を無効化します</strong></p><pre><code>2-1. PowerShell を管理者として実行します。2-2. 起動した PowerShell にて、Connect-MsolService を実行します。サインイン画面が表示されたらユーザー名とパスワードを入力します。2-3. 以下のコマンドを実行し、DirectorySynchronizationEnabled の設定を確認します。     Get-MsolCompanyInformation2-4. True の場合は、以下のコマンドを実行し、&quot;Y&quot; を押してディレクトリ同期を無効にします。     Set-MsolDirSyncEnabled -EnableDirSync $false</code></pre><p><img src="/blog/azure-active-directory-connect/azureadconnect_faq/aadcfaq061.png"></p><pre><code>2-5. 再度 2-3 のコマンドを実行し、 DirectorySynchronizationEnabled が False であることを確認します。</code></pre><p><strong>3. Azure 管理ポータルの設定を確認します</strong></p><p>Azure の管理ポータルの [Azure AD Connect] の画面にて、[シームレスなシングル サインオン] 含め、すべてが無効となっていることを確認します。<br>上記手順 2 まで完了すると、オンプレミス AD から Azure AD へ同期したユーザー・グループを同期無効化し、クラウド ユーザー・クラウド グループとして継続して利用いただくことが可能です。</p><p>すべてのユーザー・グループが問題なくクラウド ユーザー・クラウド グループとなったことが確認できた後、これ以降の手順 3 に進むようにしてください。</p><p>ユーザーの場合、 Azure AD ポータルのユーザーの画面にて、 [オンプレミスの同期が有効] 列が全て “いいえ” になっていることで、クラウド ユーザーに変更されていることを確認できます。<br>グループの場合、 [ソース] 列が全て “クラウド” になっていることで、クラウド グループに変更されていることを確認可能です。</p><p>なお、同期の無効化を実施後、切り戻しを実施する必要がある可能性に備え、手順 2 完了後、Azure AD Connect をステージング モードとし、定期同期を停止する方法をとることも可能です。<br>この場合、手順 2 のディレクトリ同期の無効化を実施後、切り戻し (Set-MsolDirSyncEnabled -EnableDirsync $True を実施する) までには、少なくとも 72 時間必要な点に注意が必要です。<br>クリーンアップをしない場合は、手順 1, 2 まででディレクトリ同期の無効化自体は完了です。</p><p>無効化が完了したら、必要に応じて下記を実施ください。</p><p><strong>4. Active Directory に作成されたオブジェクトを削除します (シームレス SSO 有効化時のみ)</strong></p><pre><code>4-1. 同期していたオンプレミス AD の任意のドメイン コントローラーにログインし、[Active Directory ユーザーとコンピューター] を開きます。4-2. &quot;Computers&quot; コンテナ配下の &quot;AZUREADSSOACCT&quot; というコンピューター アカウントを削除します。</code></pre><p><strong>5. Azure AD Connect をアンインストールします</strong></p><p>コントロールパネルより、Azure AD Connect をアンインストールします。</p><p><strong>6. Azure AD Connect の同期用アカウント (AAD) を削除します。</strong></p><p>こちらのアカウント (※) は、Azure AD のみに存在するユーザーであり、Azure AD Connect をアンインストール後も残存します。<br>こちらのアカウントは、後述のコマンドで削除可能です。</p><p>※ Azure AD Connect の同期処理のみに利用されるアカウントです。Sync_&lt;サーバー名&gt;_&lt;乱数&gt;@xxxx.onmicrosoft.co の形式で作成され、同期処理に必要な最低限の権限のみを保有しております。</p><pre><code>6-1. PowerShell を管理者として実行します。6-2. 以下のコマンドを実行し、Azure AD のグローバル管理者のアカウントでサインインします。     Connect-MgGraph -Scopes &quot;Directory.AccessAsUser.All&quot;    ※ アクセス許可の同意が要求された場合は、[承諾] をクリックします。 6-3. 以下のコマンドを実行し、同期用アカウントを削除します。 </code></pre><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$RoleID</span> = (<span class="built_in">Get-MgDirectoryRole</span> <span class="literal">-Filter</span> <span class="string">&quot;DisplayName eq &#x27;Directory Synchronization Accounts&#x27;&quot;</span>).id</span><br><span class="line"><span class="variable">$userIDs</span> = (<span class="built_in">Get-MgDirectoryRoleMember</span> <span class="literal">-DirectoryRoleId</span> <span class="variable">$RoleID</span>).id</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$ID</span> <span class="keyword">in</span> <span class="variable">$userIDs</span>)&#123;</span><br><span class="line"><span class="built_in">Remove-MgUser</span> <span class="literal">-UserId</span> <span class="variable">$ID</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>7. Azure AD Connect Health を削除します。</strong></p><pre><code>7-1. [Azure Portal] - [Azure Active Directory] - [Azure AD Connect] – [Connect 同期] - [Azure AD Connect Health] を開きます。7-2. [同期サービス] でテナント名 (xxxx.onmicrosoft.com) を選択します。7-3. [Azure Active Directory Connect Servers] で撤去するサーバーを選択します。7-4. サーバー画面上段の ”削除” をクリックします。</code></pre><p><img src="/blog/azure-active-directory-connect/azureadconnect_faq/aadcfaq062.png"></p><pre><code>7-5. サーバー名を入力して ”削除” を選択します。</code></pre><h3 id="Q-AADC-や-AADCH-をインストールする際のネットワーク要件を教えてください。"><a href="#Q-AADC-や-AADCH-をインストールする際のネットワーク要件を教えてください。" class="headerlink" title="Q. AADC や AADCH をインストールする際のネットワーク要件を教えてください。"></a><strong>Q. AADC や AADCH をインストールする際のネットワーク要件を教えてください。</strong></h3><p><strong>A.</strong> <a href="/blog/azure-active-directory-connect/port-used-by-aadc/">Azure AD Connect サーバー - ウィルス対策ソフト除外項目 / 使用する通信ポート</a> をご参照ください。  </p><h3 id="Q-AADC-は-Azure-VM-にも構築できますか？"><a href="#Q-AADC-は-Azure-VM-にも構築できますか？" class="headerlink" title="Q. AADC は Azure VM にも構築できますか？"></a><strong>Q. AADC は Azure VM にも構築できますか？</strong></h3><p><strong>A.</strong> はい、可能です。Azure VM でも構築・利用できます。</p><h3 id="Q-AADC-のバックアップ-リストア方法はありますか？"><a href="#Q-AADC-のバックアップ-リストア方法はありますか？" class="headerlink" title="Q. AADC のバックアップ / リストア方法はありますか？"></a><strong>Q. AADC のバックアップ / リストア方法はありますか？</strong></h3><p><strong>A.</strong> いいえ、 Azure AD Connect を利用している状態でバックアップを取得したり、問題が発生した場合にバックアップやスナップショットからサーバーをリストアする方法は、方法にかかわらずサポートされていません。<br>Azure AD Connect (AADC) の復旧作業は、AADC の再インストールを基本作業として実施ください。 </p><p>以下いずれかの方法から対応をご検討ください。詳細は<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/how-to-connect-sync-staging-server#disaster-recovery">こちら</a> をご覧ください。</p><ul><li>Azure AD Connect を再インストールする。</li><li>予備のスタンバイ サーバーを用意する (“ ステージング モード” と呼ばれます)。</li><li>仮想マシンを使用する。<br>※ このうち、「仮想マシンを使用する」 については、Hyper-V ライブマイグレーションのような方式を指します。(仮想マシンのバックアップリストアによる復旧はサポートされておりません。)</li></ul><p>何か問題が発生した際には、ステージング サーバーとモードを切り替えて対応します。<br>この際、先に問題が起きているサーバーをステージングとし、もともとステージングだったサーバーは後からアクティブにしてください。<br>これは、短い時間ではありますが、2台のサーバーが同時にアクティブな状態となってしまうことを防ぐためです。<br>順番が反対だと、２つのサーバーがアクティブになる瞬間があり、さらに問題が発生したり、不整合を起こしたりする場合があります。</p><p>もし AADC が 1 台しかないなど、ステージング モードと入れ替えできない場合は、Azure AD Connect をアンインストールし、再度インストールしてください。</p><p>なお、再インストールするにあたり、 Azure AD Connect 内の情報については、現在サポートされているバージョンについては下記 Import / Export 機能を利用してバックアップすることは可能です。<br>Import / Export 機能については <a href="https://jpazureid.github.io/blog/azure-active-directory-connect/aadc-import-export-config/">こちら</a>をご覧ください。</p><h3 id="Q-AADC-でバックアップ-リストアができないのはなぜですか？"><a href="#Q-AADC-でバックアップ-リストアができないのはなぜですか？" class="headerlink" title="Q. AADC でバックアップ / リストアができないのはなぜですか？"></a><strong>Q. AADC でバックアップ / リストアができないのはなぜですか？</strong></h3><p><strong>A.</strong> バックアップ/リストアによって Azure AD と オンプレミスAD 間で情報の不整合が生じる可能性があるためです。</p><p>たとえば、5/1 に OS バックアップを取得し、5/5 にオンプレミス側からユーザーを 3 人同期したとします。<br>5/10 までこのユーザーは正常に Azure AD や Microsoft 365 を利用していましたが、 5/12 にリストアを行うことになりました。<br>5/1 のバックアップを利用してリストア作業を実施すると、 5/5 に作成・同期したユーザーはその時点でオンプレミス AD に登録されていません。</p><p>ユーザーがオンプレミスから削除、あるいは同期対象 OU から外れた場合、本来そのユーザーは Azure AD から削除される動作となります。<br>しかしながら、バックアップからリストアされたAzure AD Connect はその変更を検知できないため、5/5 に作成・同期された 3 名は、 Azure AD にユーザー アカウントが残留してしまいます。</p><p>不整合については、完全同期を手動で行うことで解消するシナリオもありますが、製品としては想定されないシナリオのため、意図しない動作が起こる可能性があります。<br>そのため、Azure AD Connect をバックアップ・リストアで復旧することはお控えください。<br>仮にバックアップ ファイルなどからサーバーを復旧させた場合、AADC を一度アンインストールした上で再度インストール作業を実施ください。</p><h2 id="アップグレード・バージョンについて"><a href="#アップグレード・バージョンについて" class="headerlink" title="アップグレード・バージョンについて"></a>アップグレード・バージョンについて</h2><h3 id="Q-AADC-のダウングレードはできますか？"><a href="#Q-AADC-のダウングレードはできますか？" class="headerlink" title="Q. AADC のダウングレードはできますか？"></a><strong>Q. AADC のダウングレードはできますか？</strong></h3><p><strong>A.</strong> いいえ。ダウングレードは出来ません。<br>アップグレード後に以前のバージョンに戻したいなどの場合には、一度 AADC をアンインストールし、お客様にて保持されているアップグレード前のインストール ファイルでインストール、構成し直す必要があります。  </p><h3 id="Q-Azure-AD-Connect-の旧バージョンのインストール-ファイルを提供してほしい。"><a href="#Q-Azure-AD-Connect-の旧バージョンのインストール-ファイルを提供してほしい。" class="headerlink" title="Q. Azure AD Connect の旧バージョンのインストール ファイルを提供してほしい。"></a><strong>Q. Azure AD Connect の旧バージョンのインストール ファイルを提供してほしい。</strong></h3><p><strong>A.</strong> テクニカル サポートでは提供していません。最新バージョンのインストール ファイルを利用するか、新しいバージョンが提供される前に事前にお客様側でファイルを保管してください。</p><h3 id="Q-AADC-のサポート対応中のバージョン、サポート有効期間は？"><a href="#Q-AADC-のサポート対応中のバージョン、サポート有効期間は？" class="headerlink" title="Q. AADC のサポート対応中のバージョン、サポート有効期間は？"></a><strong>Q. AADC のサポート対応中のバージョン、サポート有効期間は？</strong></h3><p><strong>A.</strong> バージョン v1.x は、すでに 2022 年 8 月 31 をもって廃止されております。<br>また、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/decommission-connect-sync-v1">こちら</a> に記載の通り、2023 年 10 月 1 日以降は AADC v1.x からの接続を停止します。<br>もし現在も Azure AD Connect v1.x を利用されている場合は、速やかにアップグレードを実施してください。</p><p>アップグレードの手順詳細は、下記をご覧ください。<br><a href="/blog/azure-active-directory-connect/how-to-upgrade/">Azure AD Connect アップグレード手順</a>  </p><p>Azure AD Connect v2.x につきましては、ご利用いただいているバージョンによってサポート期限が異なります。<br>下記公開情報に記載の次のバージョンにつきましては、すでに 2023 年 3 月 15 日をもって廃止され、弊社としての利用は非推奨とされております。</p><p>その他の v2.x につきましては、最新版がリリースされると、それ以前にリリースされたバージョンは 12 か月後に非推奨となります。<br>具体的には、2023 年 5 月 17 日現在、最新の Azure AD Connect のバージョンは、2022 年 11 月 9 日にリリースされたバージョン2.1.20.0 となっております。<br>そのため、バージョン 2.1.19.0 は、 12 か月後の 2023 年 11 月 9 日までサポートされます。</p><p>上記のようなライフサイクルとなりますので、半年から少なくとも 1 年に 1 度は最新版のリリース状況やアップグレードを実施ください。<br>バージョン履歴については <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/reference-connect-version-history#21160">こちら</a>をご覧ください。</p><blockquote><p>以前のバージョンの Azure AD Connect Sync 2.x の廃止は新しいバージョンに置き換えた日から 12 か月後に開始されます。 このポリシーは 2023 年 3 月 15 日に適用されます。このタイミングで 2022 年 3 月 15 日に新しいバージョンに置き換えるすべてのバージョンが廃止されます。<br>次のバージョンは、2023 年 3 月 15 日に廃止されます。<br>    · 2.0.89.0<br>    · 2.0.88.0<br>    · 2.0.28.0<br>    · 2.0.25.1<br>    · 2.0.10.0<br>   · 2.0.9.0<br>   · 2.0.8.0<br>   · 2.0.3.0<br>Azure AD Connect Sync の最新リリース バージョンをまだ使用していない場合は、その日付より前に Azure AD Connect Sync ソフトウェアをアップグレードする必要があります。  </p></blockquote><h3 id="Q-Azure-AD-Connect-の以前のバージョンを使っています。このまま最新バージョンにあげることはできますか。"><a href="#Q-Azure-AD-Connect-の以前のバージョンを使っています。このまま最新バージョンにあげることはできますか。" class="headerlink" title="Q. Azure AD Connect の以前のバージョンを使っています。このまま最新バージョンにあげることはできますか。"></a><strong>Q. Azure AD Connect の以前のバージョンを使っています。このまま最新バージョンにあげることはできますか。</strong></h3><p><strong>A.</strong> はい、Azure AD Connect は、任意のバージョンからのアップグレードに対応しています。<br>すでに v2.x を利用している場合は、最新バージョンにアップグレードすることは可能です。<br>V1.x を利用している場合も、AADC 観点では最新バージョンへアップグレードすることができますが、 v2.x を利用するにあたり OS などの前提条件を満たしているか確認ください。また、非常に古いバージョンを利用している場合は、より安全なスウィング移行をご利用ください。</p><h3 id="Q-サポートされない非推奨のバージョンを使っているとどうなりますか。"><a href="#Q-サポートされない非推奨のバージョンを使っているとどうなりますか。" class="headerlink" title="Q. サポートされない非推奨のバージョンを使っているとどうなりますか。"></a><strong>Q. サポートされない非推奨のバージョンを使っているとどうなりますか。</strong></h3><p><strong>A.</strong> 今問題なく同期ができているように見えても、意図しない動作や、突然同期できなくなったなどの問題が発生することがあります。<br>トラブル シューティングが必要となった場合には、お問い合わせをいただければ確認は可能ですが、バージョンが古いことが原因と判断された場合や、切り分けを実施するにあたりサポートされるバージョンへのアップグレードをお願いすることがあります。<br>なお、 Azure AD Connect v1.x は 2023 年 10 月 1 日より完全に同期を停止します。この日付以降は動作されない見込みとなりますので、可能な限り早めにアップグレードしてください。</p><h2 id="通知・アラートについて"><a href="#通知・アラートについて" class="headerlink" title="通知・アラートについて"></a>通知・アラートについて</h2><h3 id="Q-AADC-からの同期エラーに関するメールが届きます。通知の頻度を教えてください。"><a href="#Q-AADC-からの同期エラーに関するメールが届きます。通知の頻度を教えてください。" class="headerlink" title="Q. AADC からの同期エラーに関するメールが届きます。通知の頻度を教えてください。"></a><strong>Q. AADC からの同期エラーに関するメールが届きます。通知の頻度を教えてください。</strong></h3><p><strong>A.</strong> おおよそ 1 日に 1 回配信されます。詳細は <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/connect/how-to-connect-health-operations">こちら</a> をご覧ください。</p><blockquote><p>同期エラーが発生するたびに毎回メッセージを送信するのではなく、バックエンド サービスから返されたすべてのエラーのダイジェストを毎日送信することになります。</p></blockquote><h3 id="Q-AADC-からの同期エラーの通知メールを受信しました。受信者はどこで確認できますか？"><a href="#Q-AADC-からの同期エラーの通知メールを受信しました。受信者はどこで確認できますか？" class="headerlink" title="Q. AADC からの同期エラーの通知メールを受信しました。受信者はどこで確認できますか？"></a><strong>Q. AADC からの同期エラーの通知メールを受信しました。受信者はどこで確認できますか？</strong></h3><p><strong>A.</strong> 同期処理での問題について、以前通知は 2 種類ありましたが、現在は統一されています。下記手順にてご確認ください。</p><p>Azure AD Connect Health Agent : <a href="mailto:&#x61;&#x7a;&#117;&#114;&#101;&#x2d;&#110;&#111;&#114;&#101;&#112;&#108;&#121;&#64;&#109;&#105;&#x63;&#114;&#x6f;&#115;&#x6f;&#x66;&#116;&#x2e;&#99;&#x6f;&#109;">&#x61;&#x7a;&#117;&#114;&#101;&#x2d;&#110;&#111;&#114;&#101;&#112;&#108;&#121;&#64;&#109;&#105;&#x63;&#114;&#x6f;&#115;&#x6f;&#x66;&#116;&#x2e;&#99;&#x6f;&#109;</a></p><p>Azure AD Connect Health Agent 通知先設定手順</p><p>設定箇所 : [Azure ポータル] - [Azure AD Connect] - [Azure AD Connect Health] - [同期エラー] - [通知設定]</p><p>設定項目 : 追加の電子メール受信者</p><h2 id="日頃の運用について"><a href="#日頃の運用について" class="headerlink" title="日頃の運用について"></a>日頃の運用について</h2><h3 id="Q-AADC-の同期間隔を変更する方法は？"><a href="#Q-AADC-の同期間隔を変更する方法は？" class="headerlink" title="Q. AADC の同期間隔を変更する方法は？"></a><strong>Q. AADC の同期間隔を変更する方法は？</strong></h3><p><strong>A.</strong> 下記コマンドにて変更可能です。 </p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-ADSyncScheduler</span> <span class="literal">-CustomizedSyncCycleInterval</span> &lt;任意の時間&gt;  </span><br></pre></td></tr></table></figure><p>例 (60 分に設定する場合)</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-ADSyncScheduler</span> <span class="literal">-CustomizedSyncCycleInterval</span> <span class="number">00</span>:<span class="number">60</span>:<span class="number">00</span>  </span><br><span class="line"> ```  </span><br><span class="line"></span><br><span class="line">なお、問題の発生を防ぐため、同期サイクルを変更した場合も、少なくとも <span class="number">7</span> 日に <span class="number">1</span> 度は同期が行われるようスケジュールを構成ください。[こちらの公開情報](https://learn.microsoft.com/ja<span class="literal">-jp</span>/azure/active<span class="literal">-directory</span>/hybrid/connect/how<span class="literal">-to</span><span class="literal">-connect</span><span class="literal">-sync</span><span class="literal">-feature</span><span class="literal">-scheduler</span>)も併せて参照ください。</span><br><span class="line"></span><br><span class="line">&gt; 同期サイクルを変更した場合、少なくとも <span class="number">7</span> 日に <span class="number">1</span> 回は同期サイクルが実行されるようにする必要があります。</span><br><span class="line">&gt;- 差分同期は、最後の差分同期から <span class="number">7</span> 日以内に実行されることが必要です。</span><br><span class="line">&gt;- (完全同期に続く) 差分同期は、完全同期が最後に完了してから <span class="number">7</span> 日以内に実行されることが必要です。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment">### **Q. 定期的な同期を 30 分未満に変更できますか？**</span></span><br><span class="line">**A.**  いいえ、できません。</span><br><span class="line">最も高頻度に同期を行う間隔として <span class="number">30</span> 分間隔となります。</span><br><span class="line">CustomizedSyncCycleInterval での設定値が <span class="number">30</span> 分よりも低い数値 (<span class="number">10</span> 分間隔などに) 設定された場合では、その設定値は無視され、<span class="number">30</span> 分間隔で処理されます。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment">### **Q. AADC の定期同期を普段は停止しておき、運用の必要性が生じたタイミングだけ同期させても良いですか？**  </span></span><br><span class="line">**A.** いいえ、定期的な同期が維持されるようにしてください。</span><br><span class="line"> </span><br><span class="line">同期処理を長期間停止している前提で、改めて同期処理を開始しようとした際に、初回の Import 処理に時間がかかり且つ最終的に stopped<span class="literal">-server</span><span class="literal">-down</span> で Import 処理が失敗する場合があります。</span><br><span class="line">これは、数日間同期を行わない期間があった場合、処理されずに滞留していた情報があり、同期の再開時にまとめて処理されることに起因して AAD からの Delta Import 処理が AADC 内部で進まなくなる場合があるためです。</span><br><span class="line"> </span><br><span class="line">数日のような長期にわたって同期を行わないことは想定されていないため、定期的な同期を維持してください。</span><br><span class="line">どうしても長期的な同期停止後に同期を再開する必要がある場合は、下記コマンドにて完全同期を実施してください。</span><br><span class="line">  </span><br><span class="line">今すぐ完全同期を開始する場合  </span><br><span class="line">```PowerShell  </span><br><span class="line"><span class="built_in">Start-AdSyncSyncCycle</span> Initial  </span><br><span class="line">```  </span><br><span class="line">  </span><br><span class="line">次回のスケジュール同期を完全同期として実行する場合</span><br><span class="line">```PowerShell  </span><br><span class="line"><span class="built_in">Set-ADSyncScheduler</span> <span class="literal">-NextSyncCyclePolicyType</span> Initial</span><br><span class="line">```  </span><br><span class="line">  </span><br><span class="line"> </span><br><span class="line"><span class="comment">### **Q. 完全同期 (Start-ADSyncSyncCycle -PolicyType:Initial) の所要時間は？**  </span></span><br><span class="line">**A.** オブジェクト内容、同期ルール内容、サーバースペック、ネットワーク パフォーマンスに依存しているため、正確な値を算出することはできません。  </span><br><span class="line">参考値となりますが、オンプレミス Active Directory で <span class="number">2</span> 万ユーザーではドメイン コントローラー &lt;=&gt; Azure AD Connect では約 <span class="number">30</span> MB , Azure AD Connect &lt;=&gt; Azure AD では約 <span class="number">240</span> MB の通信が生じていることが確認出来、<span class="number">30</span> 分程度の時間を要しました。 (オブジェクト自体は必要最低限の情報となり、そのサイズ自体も所要時間に影響を及ぼすものとなります)  </span><br><span class="line">弊社過去事例からは、同期対象のオブジェクト数が <span class="number">2</span> 万程度の場合、完全同期が完了するまでに <span class="number">1</span> ~ <span class="number">3</span> 時間ほどを要し、<span class="number">10</span> 万オブジェクトほどの場合はおおよそ <span class="number">4</span> ~ <span class="number">9</span> 時間を要したことを確認しています。   </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">### **Q. メモリ使用量がいつも高騰しています。なぜですか。どうしたらいいですか。**</span></span><br><span class="line">**A.** どのサービスのメモリが高騰しているのかをまずはお知らせください。</span><br><span class="line">タスク マネージャーのプロセス タブを開くと、現在使用中のメモリについて確認可能ですので、[<span class="type">Memory</span>] カラムをクリックして、メモリ使用率でソートします。</span><br><span class="line">ソートを行うと、メモリを大量に使用しているサービス順に表示されますので、どのサービスがメモリを使用しているのかお知らせください。</span><br><span class="line"></span><br><span class="line">![](/blog/azure-active-directory-connect/azureadconnect_faq/aadcfaq063.png)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">「SQL Server Windows NT – <span class="number">64</span> Bit」と「AD<span class="literal">-IAM</span><span class="literal">-HybridSync</span> master (xxxx) Azure AD Connect synchronization service」の <span class="number">2</span> つのメモリ使用量が高い場合、Azure AD Connect とそれに付随する SQL サービスでメモリの使用量が高くなっている状態です。</span><br><span class="line"> </span><br><span class="line">SQL の既定の動作では、SQL Express サーバー含め、そのサーバーで使用可能なメモリはすべて SQLが利用できるように構成されております。</span><br><span class="line">そのため、使用されていない空き容量のメモリを SQL が確保していることで、メモリ使用量が高くなっていることが想定されます。</span><br><span class="line">これにより、 Azure AD Connect サーバーでは、使用率が <span class="number">80</span> % や <span class="number">90</span> % となることは想定されます。</span><br><span class="line"> </span><br><span class="line">対処策としては、下記公開情報に記載の手順を利用いただき、 max server memory を設定することで、 SQL が確保する最大メモリ数を指定することが可能です。</span><br><span class="line">SQL Server Management Studio から設定が可能ですので、[こちらの公開情報](https://learn.microsoft.com/ja<span class="literal">-jp</span>/sql/database<span class="literal">-engine</span>/configure<span class="literal">-windows</span>/server<span class="literal">-memory</span><span class="literal">-server</span><span class="literal">-configuration</span><span class="literal">-options</span>?view=sql<span class="literal">-server</span><span class="literal">-ver15</span><span class="comment">#use-)をご確認ください。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### **Q. 完全同期は定期的に行うべきですか？**</span></span><br><span class="line">**A.** 必須ではございませんが、環境によっては完全同期の定期的な実施もご検討ください。通常は AADC の同期ルールを変更するなど構成を変更しない限りは完全同期は不要ですが、オンプレミス側で多くのオブジェクトを変更するなど、大量の変更が発生した場合に、差分同期では正常に同期されないオブジェクトが発生した事例がございました。このシナリオでは、完全同期を行うことで整合性を取ることができ、事象が改善するため、定期的に完全同期を実施することをご案内差し上げる場合がございます。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 同期の動作について</span></span><br><span class="line"> <span class="comment">### **Q. AADC をインストール時に既定で生成されるグループを教えてください？**  </span></span><br><span class="line">**A.** 下記の <span class="number">4</span> グループが生成されます。  </span><br><span class="line"> <span class="number">1</span>. **ADSyncAdmins**  </span><br><span class="line"> 本グループのメンバーは、Azure AD Connect 同期サービスマネージャーにおけるすべてのアクセス権を持ちます。  </span><br><span class="line"> インストール ウィザードを実行したユーザーは、既定でこのグループに追加されます。  </span><br><span class="line">   </span><br><span class="line"> <span class="number">2</span>. **ADSyncBrowsers**  </span><br><span class="line"> このグループのメンバーは、WMI を使ったパスワードのリセット時にユーザーの情報を集める権限を持ちます。  </span><br><span class="line">  </span><br><span class="line"> <span class="number">3</span>. **ADSyncOperators**  </span><br><span class="line"> このグループのメンバーは、Azure AD Connect 同期サービス マネージャーを操作する権限を持ちます。  </span><br><span class="line"> この操作には例えば次のようなものが含まれます。  </span><br><span class="line">   - 管理エージェントを実行する  </span><br><span class="line">   - 実行した結果（同期状況）の確認する  </span><br><span class="line">- 実行履歴をファイルにエクスポートする  </span><br><span class="line"> なお、このグループのメンバーは ADSyncBrowsers グループに所属している必要があります。  </span><br><span class="line">  </span><br><span class="line"> <span class="number">4</span>. **ADSyncPasswordReset**  </span><br><span class="line"> このグループのメンバーは、WMI を通して行われるパスワード管理のすべての操作ができる権限を持ちます。 </span><br><span class="line"> なお、このグループのメンバーは ADSyncBrowsers グループに所属している必要があります。</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="comment">### **Q. Synchronization Service Manager で Operations タブのみ表示されており、Connectors などが表示されません。理由を教えてください。**  </span></span><br><span class="line">**A.** サインインしているユーザーが ADSyncBrowse / ADSyncOperator グループにのみ所属していることが原因となります 。  </span><br><span class="line">Synchronization Rules Editor でも操作は制限され、読み取り権限 (Add ボタンは表示されますが、保存不可) のみとなります。  </span><br><span class="line"></span><br><span class="line">![](/blog/azure-active-directory-connect/azureadconnect_faq/ssm_operations.jpg)</span><br><span class="line">  </span><br><span class="line"><span class="comment">### **Q. 同期対象 OU を個別に設定しています。新規で OU を作成した場合には、同期対象となりますか？**  </span></span><br><span class="line">**A.** 作成した OU の親 OU が同期対象か否かで変わります。  </span><br><span class="line">  追加した OU の親 OU が同期対象であれば、新規で追加された OU も同期対象となり、逆に親 OU が同期対象外であれば、子 OU も同期対象外となります。</span><br><span class="line">  ルート OU 直下の OU も同様となり、ルート OU が親 OU となります。  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">### **Q. 同期対象 OU を個別に設定しています。オンプレミス側で OU を移動した場合には、同期対象となりますか？**  </span></span><br><span class="line">**A.** 同期対象の状態は維持されます。  </span><br><span class="line">  例えば、親 OU / 子 OU 双方が同期対象状態となっている状態で、オンプレミス側で OU の配置を変更し、子 OU のみ非同期対象の OU 配下に移動した場合、子 OU の同期状態は維持されます。</span><br><span class="line">  解除する必要がある場合には、Azure AD Connect インストール ウィザードから個別に選択を解除する必要があります。</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">### **Q. Azure AD のみのクラウドユーザーをオンプレミス Active Directory に書き戻すことはできますか？**  </span></span><br><span class="line">**A.** クラウド ユーザーを書き戻す機能は実装していません。オンプレミス Active Directory 上で手動で作成し、ソフトマッチを行って同期ユーザーとしてご利用ください。  </span><br><span class="line"></span><br><span class="line"><span class="comment">### **Q. ソースアンカーを objectGUID から mS-DS-ConsistencyGUID に変更した場合の影響について教えてください。**</span></span><br><span class="line">**A.** 特に影響やリスクはありません。詳細は[こちらのブログ](https://jpazureid.github.io/blog/azure<span class="literal">-active</span><span class="literal">-directory</span><span class="literal">-connect</span>/aadc_hardmatch/)も併せてご確認ください。</span><br><span class="line"></span><br><span class="line">&gt; ・ソースアンカーを変更するリスクは？</span><br><span class="line">&gt; </span><br><span class="line">&gt; ソースアンカーを変更する場合のリスクを気にされる方も多いと思いますが、AADC は通常 objectGUID の値を Base64 でエンコードし、初回の同期処理で Azure AD の ImmutableID の値にセットします。  </span><br><span class="line">&gt; つまり、ソースアンカーを mS<span class="literal">-DS</span><span class="literal">-ConsistencyGuid</span> に変更しても、ImmutableID の値は元の objectGUID をエンコードした値のまま変わりません。  </span><br><span class="line">&gt; したがって、同じ ImmutableID の値が mS<span class="literal">-DS</span><span class="literal">-ConsistencyGuid</span> に書き戻されるため、既存の同期ユーザーが同期できなくなるといった影響は生じません。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### **Q. 同期元のユーザーを変更したいです。どうすればいいですか？**</span></span><br><span class="line">**A.** ハード マッチを利用して、同期元のユーザーを切り替えます。詳細は [本ブログ](https://jpazureid.github.io/blog/azure<span class="literal">-active</span><span class="literal">-directory</span><span class="literal">-connect</span>/aadc_hardmatch/) にて案内しておりますのでご確認ください。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## よくみかけるエラーについて</span></span><br><span class="line"><span class="comment">### **Q.  大量にオブジェクトを削除したらエラーが発生しました。どうしたらいいですか。**</span></span><br><span class="line">**A.**</span><br><span class="line">Azure AD Connect には、大量のオブジェクトがオンプレミス Active Directory で削除された場合に、閾値 (既定で <span class="number">500</span>) を超えた場合には削除処理が誤って行われた可能性を考慮し、同期を停止する機能が既定で有効に設定されています。動作の詳細は [こちら](https://learn.microsoft.com/ja<span class="literal">-jp</span>/azure/active<span class="literal">-directory</span>/hybrid/connect/how<span class="literal">-to</span><span class="literal">-connect</span><span class="literal">-sync</span><span class="literal">-feature</span><span class="literal">-prevent</span><span class="literal">-accidental</span><span class="literal">-deletes</span>) をご覧ください。</span><br><span class="line"></span><br><span class="line">削除処理が意図したものである場合には、一旦この保護機能を無効にして、同期を許可するという対応を実施します。</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. PowerShell を起動し、以下のコマンドを実行して、保護機能を一時的に無効にします。  </span><br><span class="line">  ```PowerShell  </span><br><span class="line">   <span class="built_in">Disable-ADSyncExportDeletionThreshold</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>手動で同期を実施し、正常に Export 処理が完了したことを確認します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Start-ADSyncSyncCycle</span> <span class="literal">-PolicyType</span> Delta</span><br></pre></td></tr></table></figure></li><li><p>再度保護機能を有効にします。コマンドを実行した後、”DeletionThreshold” にパラメーターを入力する必要がありますが、特に理由が無ければ既定値の 500 を指定します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Enable-ADSyncExportDeletionThreshold</span></span><br></pre></td></tr></table></figure></li></ol><p>なお、 Enable-ADSyncExportDeletionThreshold コマンドで -DeletionThreshold オプションを付与すると、閾値を変更することも可能です。このとき特に一旦無効にする必要はありません。例えば 2 を設定すると 2 オブジェクト以上の削除が検出されると同期が止まります。</p><p>また、現在の閾値は Get-ADSyncExportDeletionThreshold で確認できます。</p><h3 id="Q-インストール-ウィザードが完了できません。"><a href="#Q-インストール-ウィザードが完了できません。" class="headerlink" title="Q. インストール ウィザードが完了できません。"></a><strong>Q. インストール ウィザードが完了できません。</strong></h3><p><strong>A.</strong> <a href="https://github.com/jpazureid/aadconnect-diagnostic">こちら</a> のページを確認し、[シナリオトレース (構成ウィザード、またはその他のシナリオ)] を実施した際のログをお寄せください。</p><h3 id="Q-permission-issue-が発生しました。対処策を教えてください。"><a href="#Q-permission-issue-が発生しました。対処策を教えてください。" class="headerlink" title="Q. permission-issue が発生しました。対処策を教えてください。"></a><strong>Q. permission-issue が発生しました。対処策を教えてください。</strong></h3><p><strong>A.</strong> 同期元オブジェクトへの書き込みアクセス許可が不足している場合に発生します。<br><a href="https://jpazureid.github.io/blog/azure-active-directory-connect/error-code-8344/">こちら</a>のブログをご確認ください。エラーの詳細をおまとめしています。</p><h3 id="Q-AttributeMustbeUnique-と表示され、重複エラーが発生します。対処策を教えてください。"><a href="#Q-AttributeMustbeUnique-と表示され、重複エラーが発生します。対処策を教えてください。" class="headerlink" title="Q. AttributeMustbeUnique と表示され、重複エラーが発生します。対処策を教えてください。"></a><strong>Q. AttributeMustbeUnique と表示され、重複エラーが発生します。対処策を教えてください。</strong></h3><p><strong>A.</strong> すでに Azure AD に同期しているユーザーと、これから同期しようとしているユーザーの属性が重複しているためにエラーとなっています。<br>具体的には、 UPN やメール属性、プライマリ プロキシ アドレスなどの重複をよくお見かけします。<br>既存で同期されているユーザーの値を調整するか、これから同期しようとしているユーザーの属性を変更して同期すれば、重複せずにそれぞれ同期されるため、エラーの解消が見込まれます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは！ Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;Azure AD Connect (AADC) のお問い合わせが多いご質問について、以前 2020 年に Q&amp;amp;A 形式でおまとめいたしておりましたが、バージョンも v2 となり記事が古くなってまいりま</summary>
      
    
    
    
    
    <category term="Azure Ad Connect" scheme="https://jpazureid.github.io/blog/tags/Azure-Ad-Connect/"/>
    
  </entry>
  
  <entry>
    <title>AD FS のトークン署名証明書を手動でアップデートする方法</title>
    <link href="https://jpazureid.github.io/blog/active-directory-federation-service/migrate-msol-update-federation-domain/"/>
    <id>https://jpazureid.github.io/blog/active-directory-federation-service/migrate-msol-update-federation-domain/</id>
    <published>2023-06-15T12:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.143Z</updated>
    
    <content type="html"><![CDATA[<p>皆様、こんにちは。Azure &amp; Identity サポート担当の竹村です。</p><p>本ブログでは、AD FS のトークン署名証明書を Azure AD のフェデレーションドメインに手動でアップデートする方法をご案内します。</p><p>従来は、MSOnline モジュールの Update-MsolFederatedDomain というコマンドレットが用意されておりましたが、MSOnline モジュールの廃止に伴い、Microsoft Graph PowerShell への移行が進められております。</p><p>以下に、新しい Microsoft Graph PowerShell を利用したトークン署名証明書のアップデート方法をご案内します。</p><h2 id="手順の概要"><a href="#手順の概要" class="headerlink" title="手順の概要"></a>手順の概要</h2><ol><li>AD FS でセカンダリ証明書を作成する</li><li>AD FS で既存のプライマリ証明書と、セカンダリ証明書をエクスポートする</li><li>Azure AD のフェデレーションドメインに、新しいセカンダリ証明書をアップデートする</li><li>AD FS で新しいセカンダリ証明書をプライマリに変更する</li></ol><p>それぞれの詳細を紹介します。</p><h2 id="1-AD-FS-でセカンダリ証明書を作成する"><a href="#1-AD-FS-でセカンダリ証明書を作成する" class="headerlink" title="1. AD FS でセカンダリ証明書を作成する"></a>1. AD FS でセカンダリ証明書を作成する</h2><p>AD FS プライマリサーバーで、新しいトークン署名証明書とトークン暗号化解除証明書をセカンダリとして作成します。<br>PowerShell で以下のように実行します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-AdfsCertificate</span></span><br></pre></td></tr></table></figure><p>コマンドを実行すると、新しいトークン署名証明書と、トークン暗号化解除証明書がセカンダリとして作成されます。</p><div class="alert is-warning"><p class="alert-title">警告</p><p>Update-AdfsCertificate コマンド実行時に -urgent オプションを付与しないようにご注意ください。付与した場合には、新しい証明書がセカンダリとして作成されるのではなく、プライマリとして作成されて即時に上書きされ、Azure AD 側に新しい証明書がアップデートされるまでの間、認証が失敗するようになります。</p></div><div class="alert is-info"><p class="alert-title">Note</p><p>Update-AdfsCertificate を実行するためには、<a href="#%E8%A3%9C%E8%B6%B3-%E8%87%AA%E5%8B%95%E3%83%AD%E3%83%BC%E3%83%AB-%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%9C%89%E5%8A%B9%E5%8C%96%E6%89%8B%E9%A0%86">証明書の自動ロールオーバー</a> が有効である必要があります。</p></div><h3 id="補足-自動ロール-オーバーの有効化手順"><a href="#補足-自動ロール-オーバーの有効化手順" class="headerlink" title="補足: 自動ロール オーバーの有効化手順"></a>補足: 自動ロール オーバーの有効化手順</h3><p>証明書の自動ロールオーバーを有効にするには、以下を実行します。</p><blockquote><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-AdfsProperties</span> <span class="literal">-AutoCertificateRollover</span> <span class="variable">$true</span></span><br></pre></td></tr></table></figure><p>自動ロールオーバーを無効に戻したい場合には、以下を実行します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-AdfsProperties</span> <span class="literal">-AutoCertificateRollover</span> <span class="variable">$false</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="2-AD-FS-で既存のプライマリ証明書と、セカンダリ証明書をエクスポートする"><a href="#2-AD-FS-で既存のプライマリ証明書と、セカンダリ証明書をエクスポートする" class="headerlink" title="2. AD FS で既存のプライマリ証明書と、セカンダリ証明書をエクスポートする"></a>2. AD FS で既存のプライマリ証明書と、セカンダリ証明書をエクスポートする</h2><p>既存のプライマリのトークン署名証明書と、新しく作成されたセカンダリのトークン署名証明書を Base64 エンコードでエクスポートします。</p><p>AD FS の管理ツールを起動して、左ペインの [サービス] - [証明書] を選択すると、証明書の一覧が表示されますので、[トークン署名] の欄のプライマリ、セカンダリそれぞれについて、右クリックから [証明書の表示] を選択し、[詳細] タブから [ファイルにコピー]を行います。</p><p>ウィザードの中で、以下のように “Base 64 encoded X.509” を選択してファイルにエクスポートします。</p><p><img src="/blog/active-directory-federation-service/migrate-msol-update-federation-domain/migrate-msol-update-federation-domain-01.png"></p><p>エクスポートした証明書ファイル (.cer) をメモ帳などのテキスト エディターで開くと、”MIIC4j … FOO3A==” のような、Base64 エンコードされた文字列が得られます。<br>この証明書を示す文字列を次の手順 3 で利用します。</p><h2 id="3-Azure-AD-のフェデレーションドメインに、新しいセカンダリ証明書をアップデートする"><a href="#3-Azure-AD-のフェデレーションドメインに、新しいセカンダリ証明書をアップデートする" class="headerlink" title="3. Azure AD のフェデレーションドメインに、新しいセカンダリ証明書をアップデートする"></a>3. Azure AD のフェデレーションドメインに、新しいセカンダリ証明書をアップデートする</h2><p>以下の手順で Microsoft Graph PowerShell を利用して、Azure AD のフェデレーションドメインに新しいトークン署名証明書をアップデートします。</p><p>手順 2 でエクスポートした、プライマリとセカンダリの証明書ファイル (.cer) を、作業を行う端末の任意のディレクトリにコピーしておいてください。<br>(AD FS サーバー自身で実行する場合、エクスポートしたファイルをそのままご利用ください。)</p><h3 id="3-1-Windows-10-の-PC-など、任意のインターネットに接続できる端末に、Microsoft-Graph-PowerShell-の必要なモジュールをインストールします。"><a href="#3-1-Windows-10-の-PC-など、任意のインターネットに接続できる端末に、Microsoft-Graph-PowerShell-の必要なモジュールをインストールします。" class="headerlink" title="3-1. Windows 10 の PC など、任意のインターネットに接続できる端末に、Microsoft Graph PowerShell の必要なモジュールをインストールします。"></a>3-1. Windows 10 の PC など、任意のインターネットに接続できる端末に、Microsoft Graph PowerShell の必要なモジュールをインストールします。</h3><p><a href="https://learn.microsoft.com/ja-jp/powershell/microsoftgraph/installation?view=graph-powershell-1.0">Microsoft Graph PowerShell をインストールする</a> の手順にあるとおり、動作には以下のいずれかの環境が必要です。</p><ul><li>PowerShell 7 以降 (推奨)</li><li>PowerShell 5.1 以降、および .NET Framework 4.7.2 以降</li></ul><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> <span class="literal">-Name</span> <span class="string">&quot;Microsoft.Graph.Identity.DirectoryManagement&quot;</span> <span class="literal">-Force</span></span><br></pre></td></tr></table></figure><h3 id="3-2-対象のテナントに接続し、グローバル管理者アカウントでサインインします。"><a href="#3-2-対象のテナントに接続し、グローバル管理者アカウントでサインインします。" class="headerlink" title="3-2. 対象のテナントに接続し、グローバル管理者アカウントでサインインします。"></a>3-2. 対象のテナントに接続し、グローバル管理者アカウントでサインインします。</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-Scopes</span> <span class="string">&quot;Directory.AccessAsUser.All&quot;</span></span><br></pre></td></tr></table></figure><p>アクセス許可を要求する画面が表示された場合には、承諾します。</p><h3 id="3-3-接続したテナントに、対象のドメインがあることを確認します。"><a href="#3-3-接続したテナントに、対象のドメインがあることを確認します。" class="headerlink" title="3-3. 接続したテナントに、対象のドメインがあることを確認します。"></a>3-3. 接続したテナントに、対象のドメインがあることを確認します。</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgDomain</span></span><br></pre></td></tr></table></figure><h3 id="3-4-対象のドメインの現在の設定を確認します"><a href="#3-4-対象のドメインの現在の設定を確認します" class="headerlink" title="3-4. 対象のドメインの現在の設定を確認します"></a>3-4. 対象のドメインの現在の設定を確認します</h3><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgDomainFederationConfiguration</span> <span class="literal">-DomainId</span> &lt;対象のドメイン&gt; | <span class="built_in">FL</span></span><br><span class="line"></span><br><span class="line">(実行結果例)</span><br><span class="line">ActiveSignInUri                       : https://sts.test.com/adfs/services/trust/<span class="number">2005</span>/usernamemixed</span><br><span class="line">DisplayName                           : AD FS</span><br><span class="line">FederatedIdpMfaBehavior               :</span><br><span class="line">Id                                    : b393ece7<span class="literal">-895a</span><span class="literal">-436c</span><span class="literal">-9794</span><span class="literal">-787c6d1ae77f</span></span><br><span class="line">IsSignedAuthenticationRequestRequired :</span><br><span class="line">IssuerUri                             : http://sts.test.com/adfs/services/trust</span><br><span class="line">MetadataExchangeUri                   : https://sts.sts.test.com/adfs/services/trust/mex</span><br><span class="line">NextSigningCertificate                :</span><br><span class="line">PassiveSignInUri                      : https://sts.sts.test.com/adfs/<span class="built_in">ls</span>/</span><br><span class="line">PreferredAuthenticationProtocol       : wsFed</span><br><span class="line">PromptLoginBehavior                   : </span><br><span class="line">SignOutUri                            : https://sts.test.com/adfs/<span class="built_in">ls</span>/</span><br><span class="line">SigningCertificate                    : MIIGFT ... yEzQw==</span><br><span class="line">SigningCertificateUpdateStatus        : </span><br><span class="line">AdditionalProperties                  : &#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>SigningCertificate と NextSigningCertificate の値を確認して、「2. 既存のプライマリ証明書と、セカンダリ証明書をエクスポートする」の手順でエクスポートした既存のプライマリ証明書が、どちらに設定されているかを確認します。<br>証明書ファイル (.cer) をテキスト エディターで開くと、Base64 エンコードされた文字列を確認することができます。<br>上記の例は、SigningCertificate に既存のプライマリ証明書 ( “MIIGFT … yEzQw==” 途中省略しています) が設定されていて、NextSigningCertificate には何も設定されていない状態です。<br>この場合には、次の手順で NextSigningCertificate に新しいセカンダリ証明書を設定します。<br>ほとんどの環境では SigningCertificate に既存のプライマリ証明書が設定されているはずですが、もし NextSigningCertificate 側に設定されていた場合には、上書きしないように、次の手順で SigningCertificate 側に新しいセカンダリ証明書を設定します。</p><h3 id="3-5-対象のドメインに新しいセカンダリの証明書をアップデートします"><a href="#3-5-対象のドメインに新しいセカンダリの証明書をアップデートします" class="headerlink" title="3-5. 対象のドメインに新しいセカンダリの証明書をアップデートします"></a>3-5. 対象のドメインに新しいセカンダリの証明書をアップデートします</h3><p>上記の手順 3-4 の確認で、SigningCertificate 側に既存のプライマリ証明書が設定されていた場合には、以下のように NextSigningCertificate に新しいセカンダリの証明書を設定します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$domainId</span> = <span class="string">&quot;test.com&quot;</span> (対象のドメインを指定します。)</span><br><span class="line"></span><br><span class="line"><span class="variable">$federationId</span> = <span class="string">&quot;b393ece7-895a-436c-9794-787c6d1ae77f&quot;</span> (上の手順 <span class="number">4</span> で確認した Id の値を指定します。)</span><br><span class="line"></span><br><span class="line"><span class="variable">$certObj</span> = <span class="built_in">New-Object</span> System.Security.Cryptography.X509Certificates.X509Certificate2(<span class="string">&quot;C:\tepm\secondary.cer&quot;</span>) (作業端末にコピーしたセカンダリの新しい証明書のパスを指定します。)</span><br><span class="line"><span class="variable">$certData</span> = [<span class="type">system.convert</span>]::tobase64string(<span class="variable">$certObj</span>.rawdata)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Update-MgDomainFederationConfiguration</span> <span class="literal">-DomainId</span> <span class="variable">$domainId</span> <span class="literal">-InternalDomainFederationId</span> <span class="variable">$federationId</span> <span class="literal">-NextSigningCertificate</span> <span class="variable">$certData</span></span><br></pre></td></tr></table></figure><p>もし上記の手順 3-4 の確認で NextSigningCertificate に既存のプライマリ証明書が設定されていた場合には、以下のように SigningCertificate に新しいセカンダリ証明書を設定します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Update-MgDomainFederationConfiguration</span> <span class="literal">-DomainId</span> <span class="variable">$domainId</span> <span class="literal">-InternalDomainFederationId</span> <span class="variable">$federationId</span> <span class="literal">-SigningCertificate</span> <span class="variable">$certData</span></span><br></pre></td></tr></table></figure><p>念のため、設定後に正しく新しいセカンダリの証明書が追加されていること、および既存のプライマリ証明書が消えていないことをお確かめください。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgDomainFederationConfiguration</span> <span class="literal">-DomainId</span> &lt;対象のドメイン&gt; | <span class="built_in">FL</span></span><br><span class="line"></span><br><span class="line">(実行結果例)</span><br><span class="line">ActiveSignInUri                       : https://sts.test.com/adfs/services/trust/<span class="number">2005</span>/usernamemixed</span><br><span class="line">DisplayName                           : AD FS</span><br><span class="line">FederatedIdpMfaBehavior               :</span><br><span class="line">Id                                    : b393ece7<span class="literal">-895a</span><span class="literal">-436c</span><span class="literal">-9794</span><span class="literal">-787c6d1ae77f</span></span><br><span class="line">IsSignedAuthenticationRequestRequired :</span><br><span class="line">IssuerUri                             : http://sts.test.com/adfs/services/trust</span><br><span class="line">MetadataExchangeUri                   : https://sts.sts.test.com/adfs/services/trust/mex</span><br><span class="line">NextSigningCertificate                : MIIC4j ... FOO3A== ★&lt;-- 追加された新しいセカンダリの証明書</span><br><span class="line">PassiveSignInUri                      : https://sts.sts.test.com/adfs/<span class="built_in">ls</span>/</span><br><span class="line">PreferredAuthenticationProtocol       : wsFed</span><br><span class="line">PromptLoginBehavior                   : </span><br><span class="line">SignOutUri                            : https://sts.test.com/adfs/<span class="built_in">ls</span>/</span><br><span class="line">SigningCertificate                    : MIIGFT ... yEzQw== ★&lt;-- 既存のプライマリ証明書</span><br><span class="line">SigningCertificateUpdateStatus        : </span><br><span class="line">AdditionalProperties                  : &#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-AD-FS-で新しいセカンダリ証明書をプライマリに変更する"><a href="#4-AD-FS-で新しいセカンダリ証明書をプライマリに変更する" class="headerlink" title="4. AD FS で新しいセカンダリ証明書をプライマリに変更する"></a>4. AD FS で新しいセカンダリ証明書をプライマリに変更する</h2><p>AD FS 側にはプライマリとセカンダリの証明書があり、プライマリの証明書を使用してトークンに署名を付与します。<br>Azure AD 側では、その署名を検証するために SigningCertificate と NextSigningCertificate が使用されますが、プライマリ/セカンダリ という概念はなく、どちらか一方が AD FS のプライマリ証明書と合致していれば検証に成功します。<br>したがって、上記の手順「3. Azure AD のフェデレーションドメインに、新しいセカンダリ証明書をアップデートする」を実施した時点で、AD FS のプライマリ証明書とセカンダリ証明書の両方に対応できる状態になっています。</p><p>この状態で、AD FS 側でセカンダリの新しい証明書をプライマリに変更します。<br>AD FS 管理ツールで証明書の一覧を開き、セカンダリのトークン署名証明書を選択して右クリックし、「プライマリとして設定」を選択します。<br>警告ダイアログが表示されますので「はい」を選択し、プライマリに変更します。</p><p>併せてトークン暗号化解除証明書も同様の手順でセカンダリをプライマリに変更しておきます。<br>Azure AD (証明書利用者信頼) との認証連携には関係しませんが、トークン暗号化解除証明書の有効期限が切れることで、AD FS サービスが起動することができなくなります。<br>また、要求プロバイダー信頼として、ローカルの Active Directory 以外に他の IdP と連携している場合には、新しいトークン暗号化解除証明書をその IdP 側で更新を行う必要がございます。<br>通常はメタデータを介して更新を行いますが、詳細は IdP の開発元ベンダー様にお問合せください。</p><p>手順は以上の通りとなります。<br>参考となれば幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;皆様、こんにちは。Azure &amp;amp; Identity サポート担当の竹村です。&lt;/p&gt;
&lt;p&gt;本ブログでは、AD FS のトークン署名証明書を Azure AD のフェデレーションドメインに手動でアップデートする方法をご案内します。&lt;/p&gt;
&lt;p&gt;従来は、MSOnli</summary>
      
    
    
    
    
    <category term="AD FS" scheme="https://jpazureid.github.io/blog/tags/AD-FS/"/>
    
  </entry>
  
  <entry>
    <title>Apple デバイス向けの Microsoft Enterprise SSO 一般提供開始のお知らせ</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/enterprise-sso-ga/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/enterprise-sso-ga/</id>
    <published>2023-06-08T00:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.607Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 長谷川 です。</p><p>本記事は、2023 年 5 月 31 日に米国の Microsoft Entra (Azure AD) Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/microsoft-enterprise-sso-for-apple-devices-is-now-available-for/ba-p/3827395">Microsoft Enterprise SSO for Apple Devices Is Now Available for Everyone</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>本日は Apple デバイス用の <a href="https://learn.microsoft.com/ja-jp/mem/intune/configuration/use-enterprise-sso-plug-in-ios-ipados-macos?pivots=all">Microsoft Enterprise SSO プラグイン</a> の一般提供を発表できることを嬉しく思います。このプロダクトは、<a href="https://developer.apple.com/documentation/authenticationservices">Apple のエンタープライズ シングル サインオン</a> 機能をサポートするすべてのアプリケーションにおいて、macOS、iOS、iPadOS 上の Azure Active Directory (Azure AD) アカウントにシングルサインオン (SSO) を提供します (Azure AD は現在 Microsoft Entra ブランドに統合されています)。<br>これには最新のライブラリやプロトコルを使用しておらず最新の Microsoft Entra の機能を利用できない可能性のある組織が依存している古いアプリケーションも含まれます。</p><p>これにより、互換性のあるアプリケーションは、コードを 1 行も変更することなく、当社が提供する最新のセキュリティおよびアイデンティティ機能の恩恵を受けることができます。また、Microsoft Office、Edge for macOS、Safari など、あなたのお気に入りのアプリケーションもサポートされています。さらに、<a href="https://learn.microsoft.com/ja-jp/mem/intune/configuration/use-enterprise-sso-plug-in-macos-with-intune?tabs=prereq-intune,create-profile-intune#prerequisites">Microsoft Intune や JAMF</a> など、組織が利用しているほとんどのモバイルデバイス管理 (MDM) プロバイダーにも対応しています。  </p><p>本プロダクトは、Microsoft と Apple の緊密な連携に加え、金融、航空宇宙、小売の各分野で本製品を利用した数千人のお客様からの素晴らしいフィードバックから生まれました。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/apple-sso-plugin">こちら</a>でご確認いただけます。</p><h2 id="アプリケーションを変更することなく、従業員に優れたモバイルSSOを提供することができます！"><a href="#アプリケーションを変更することなく、従業員に優れたモバイルSSOを提供することができます！" class="headerlink" title="アプリケーションを変更することなく、従業員に優れたモバイルSSOを提供することができます！"></a>アプリケーションを変更することなく、従業員に優れたモバイルSSOを提供することができます！</h2><p>多くのお客様の組織では、iOS、iPadOS、macOS 上で動作するビジネスに欠かせない基幹業務アプリケーションを開発されていると思いますが、これらのアプリケーションを最新のセキュリティとアイデンティティ機能に対応させることは容易ではありません。場合によっては、これらのアプリケーションはすでに組織を離れたベンダー/従業員によって開発されたものであり改修が困難であることもあります。また、これらのアプリケーションを最新のセキュリティとアイデンティティのベストプラクティスに対応させるためにアップデートするリソースが組織にない場合もあります。</p><p>Apple デバイス向けの Microsoft Enterprise SSO の素晴らしいところは、最新機能やセキュリティアップデートのサポート作業を組織から取り除いて、お客様に代わって行うことです。私たちは最新のアップデートを Microsoft Enterprise SSO Plug-In として提供し、常に更新され、管理下にあるあなたの組織のすべてのデバイスに配信されます。このプラグインは、Microsoft Authenticator や Microsoft Company Portal アプリケーションなど、組織がすでに使用しているアプリケーションに提供されます。MDM プロバイダーを正しく設定すると、Microsoft Enterprise SSO Plug-In はネットワークレベルですべての認証要求をリスニングし、必要に応じてプラグインを実行するように動作します。私たちはデバイス上のユーザーを自動的に保持し、利用可能な最新の認証情報でサインインされるようにします。 これによりユーザーに優れた SSO ユーザーエクスペリエンスと優れたセキュリティを同時に提供します！</p><p><img src="/blog/azure-active-directory/enterprise-sso-ga/macos-sso-animated.gif"></p><h2 id="Office-をはじめ、ご愛用のアプリケーションのほとんどがすでにサポートされています！"><a href="#Office-をはじめ、ご愛用のアプリケーションのほとんどがすでにサポートされています！" class="headerlink" title="Office をはじめ、ご愛用のアプリケーションのほとんどがすでにサポートされています！"></a>Office をはじめ、ご愛用のアプリケーションのほとんどがすでにサポートされています！</h2><p>自社のアプリケーションだけにとどまらず、<a href="https://developer.apple.com/documentation/authenticationservices">Apple のエンタープライズ シングル サインオン</a>機能をサポートするあらゆるアプリケーションは、SSO を含む上記のすべてのメリットを得ることができます。これには、すべての macOS、iOS、iPad の Office アプリケーション、macOS の Microsoft Edge、Safari、その他多くのアプリケーションが含まれます。Apple のネットワークライブラリを使用していないアプリケーションは今のところこの機能を利用することはできませんが、将来的にはすべてのアプリケーションが Apple のエンタープライズ SSO 機能をサポートするようになると見込んでいます。</p><p>最新のアプリが従業員に最高の Entra エクスペリエンスを提供します。</p><h2 id="さあ、はじめよう"><a href="#さあ、はじめよう" class="headerlink" title="さあ、はじめよう"></a>さあ、はじめよう</h2><p>このプロダクトはマイクロソフトとアップルの間で 5 年以上かけて実現したものであり、お客様に導入していただけることを楽しみにしています。Microsoft Enterprise SSO Extension の詳細については<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/apple-sso-plugin">こちらをご覧ください</a> 。また、導入の準備が整った段階でご利用いただける MDM に特化した導入ガイダンスを<a href="https://learn.microsoft.com/ja-jp/mem/intune/configuration/use-enterprise-sso-plug-in-ios-ipados-macos?pivots=all">こちら</a>でご案内しています。</p><p>Microsoft Enterprise SSO Extension をより深く理解したい方は、<a href="https://www.youtube.com/watch?v=1k2EDEnRgz8">SSO for Azure AD on Apple Platforms</a> に関するビデオをご覧ください。また、<a href="https://www.youtube.com/watch?v=7_ec_qFbvGw&t=279s">Apple デバイスを条件付きアクセスと統合する</a>ことをお勧めします。最後に、Microsoft Enterprise SSO Extension のトラブルシューティングが必要な場合は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/troubleshoot-mac-sso-extension-plugin">トラブルシューティング ガイド</a>を参照してください。</p><p>よろしくお願いします。<br>Alex Simons (@alex_a_simons)<br>CVP of Product<br>Microsoft Identity and Network Access Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 長谷川 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 31 日に米国の Microsoft Entra (Azure AD) Blog で公開された &lt;a href=&quot;https://techcommun</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>プロビジョニングのよくあるお問い合わせ 2</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-provisioning2/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-provisioning2/</id>
    <published>2023-05-30T15:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.447Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure &amp; Identity サポート チームの星野です。<br>本記事では、以前公開された記事「<a href="/blog/azure-active-directory/azure-ad-provisioning/">Azure AD のプロビジョニング機能について</a>」で紹介されたお問い合わせに続いて、続編としてさらによくあるご質問に関しまとめています。</p><p>Azure AD  プロビジョニングの基本的な仕組みに関しては前述の記事にまとめられておりますので、本記事では機能概要の説明は控えます。<br>まずは基本的な動作を確認されたい、という方は前述の記事をご参照くださいますと幸いです。</p><h2 id="Azure-AD-プロビジョニングのよくあるお問い合わせ・ご質問"><a href="#Azure-AD-プロビジョニングのよくあるお問い合わせ・ご質問" class="headerlink" title="Azure AD プロビジョニングのよくあるお問い合わせ・ご質問"></a>Azure AD プロビジョニングのよくあるお問い合わせ・ご質問</h2><h3 id="プロビジョニング構成前"><a href="#プロビジョニング構成前" class="headerlink" title="プロビジョニング構成前"></a>プロビジョニング構成前</h3><h4 id="Q-SaaS側でユーザ情報を変更すると-Azure-AD-にも反映されますか。"><a href="#Q-SaaS側でユーザ情報を変更すると-Azure-AD-にも反映されますか。" class="headerlink" title="Q. SaaS側でユーザ情報を変更すると Azure AD  にも反映されますか。"></a><span style="color: #ff0000; ">Q.</span> SaaS側でユーザ情報を変更すると Azure AD  にも反映されますか。</h4><h4 id="A-SaaS-側の変更は-Azure-AD-に反映されません。"><a href="#A-SaaS-側の変更は-Azure-AD-に反映されません。" class="headerlink" title="A. SaaS 側の変更は Azure AD に反映されません。"></a><span style="color: #3366ff; ">A.</span> SaaS 側の変更は Azure AD に反映されません。</h4><p>SaaS 側でユーザーやグループといったオブジェクトを追加、更新、削除した場合であっても、Azure AD テナントにその情報が反映されることはありません。</p><p>Azure AD から同期を行っているユーザーは、SaaS アプリケーションの仕様によっては、SaaS 上で同期アカウントの管理ができず、同期元 ID プロバイダー (Azure AD) からの編集が必要です。</p><p>例えば Azure AD よりプロビジョニング同期を行っているアカウントを SaaS 側にて情報変更 (アカウント削除等) し同期に問題が出るお問い合わせが多く寄せられております。</p><p>SaaS の仕様で制限されていない場合であっても、同期をとっているアカウントは基本的に同期元で管理を行うという原則にご留意ください。</p><h4 id="Q-対象のSaaS-がAzure-AD-自動プロビジョニングをサポートしているかわかりません。"><a href="#Q-対象のSaaS-がAzure-AD-自動プロビジョニングをサポートしているかわかりません。" class="headerlink" title="Q. 対象のSaaS がAzure AD 自動プロビジョニングをサポートしているかわかりません。"></a><span style="color: #ff0000; ">Q.</span> 対象のSaaS がAzure AD 自動プロビジョニングをサポートしているかわかりません。</h4><h4 id="A-エンタープライズアプリケーションのギャラリーより自動プロビジョニングの対象アプリをご参照いただけます。"><a href="#A-エンタープライズアプリケーションのギャラリーより自動プロビジョニングの対象アプリをご参照いただけます。" class="headerlink" title="A. エンタープライズアプリケーションのギャラリーより自動プロビジョニングの対象アプリをご参照いただけます。"></a><span style="color: #3366ff; ">A.</span> エンタープライズアプリケーションのギャラリーより自動プロビジョニングの対象アプリをご参照いただけます。</h4><p>Azure AD にて用意されたエンタープライズアプリケーションでは基本的に自動プロビジョニングがサポートされていますが、アプリケーションによっては、自動プロビジョニングがサポートされておりません。</p><p>// 自動プロビジョニングがサポートされていない例<br><img src="/blog/azure-active-directory/azure-ad-provisioning2/azure-ad-provisioning2-01.png"></p><p>この場合はプロビジョニングを構成するために、カスタムアプリケーションを別途作成する必要があります。<br>※カスタムアプリケーションは Azure AD ポータルより [Azure Active Directory] -&gt; [エンタープライズアプリケーション] -&gt; [独自のアプリケーションの作成] で作成します。<br>以下のように [テナントの URL] には SaaS アプリケーション側の SCIM API エンドポイント URL を登録し、[シークレット トークン] には本 API にアクセスするための Bearer トークンを登録します。</p><p><img src="/blog/azure-active-directory/azure-ad-provisioning2/azure-ad-provisioning2-02.png"></p><h4 id="Q-同期したいオブジェクトの数が大規模-10-万程度-になる予定です。ベストプラクティスはありますか。"><a href="#Q-同期したいオブジェクトの数が大規模-10-万程度-になる予定です。ベストプラクティスはありますか。" class="headerlink" title="Q. 同期したいオブジェクトの数が大規模 (10 万程度) になる予定です。ベストプラクティスはありますか。"></a><span style="color: #ff0000; ">Q.</span> 同期したいオブジェクトの数が大規模 (10 万程度) になる予定です。ベストプラクティスはありますか。</h4><h4 id="A-グループ割り当てでの管理がおすすめです。"><a href="#A-グループ割り当てでの管理がおすすめです。" class="headerlink" title="A. グループ割り当てでの管理がおすすめです。"></a><span style="color: #3366ff; ">A.</span> グループ割り当てでの管理がおすすめです。</h4><p>プロビジョニングの対象範囲として「割り当てられたユーザーとグループのみ同期」に設定のうえ、ユーザーを直接割り当てるのではなく、ユーザーをまとめたグループをいくつか割り当てる方式がおすすめです。※ グループの割り当ては Azure AD Premium ライセンス プランが必要です。詳しくはこちらをご覧ください。</p><p>理由としては、グループを使用せずユーザ―を個別に割り当てることによって同期サイクル時、Azure AD の動作仕様上発生する読み込みの処理が速くなったり、プロビジョニング対象数の管理が容易となる点より、グループ割り当てでの管理を推奨しております。</p><p>ベストプラクティスは部署やロールといったユーザーの共通項ごとにいくつかのグループにまとめそれらを割り当てることとなりますが、1 つのグループに 10 万のユーザーをまとめそれを割り当てるだけでも同期処理の遅延防止に効果的です。</p><h3 id="プロビジョニング構成時"><a href="#プロビジョニング構成時" class="headerlink" title="プロビジョニング構成時"></a>プロビジョニング構成時</h3><h4 id="Q-プロビジョニングの開始、停止、再開の違いは何ですか。"><a href="#Q-プロビジョニングの開始、停止、再開の違いは何ですか。" class="headerlink" title="Q. プロビジョニングの開始、停止、再開の違いは何ですか。"></a><span style="color: #ff0000; ">Q.</span> プロビジョニングの開始、停止、再開の違いは何ですか。</h4><h4 id="A-プロビジョニングを構成し有効化すると初回の同期サイクルが開始します。"><a href="#A-プロビジョニングを構成し有効化すると初回の同期サイクルが開始します。" class="headerlink" title="A. プロビジョニングを構成し有効化すると初回の同期サイクルが開始します。"></a><span style="color: #3366ff; ">A.</span> プロビジョニングを構成し有効化すると初回の同期サイクルが開始します。</h4><p>これが完了するとその後、定期間隔にて後続の増分サイクルが行われます。このサイクルでは前回のサイクルから変更があったオブジェクトを評価します。<br>この稼働し続ける同期サイクルを途中で停止するのが [プロビジョニングの停止] です。<br>また、停止している同期サイクルを停止を行った時点から再開するのが [プロビジョニングの開始] です。</p><p>一方で [プロビジョニングの再開] を押下するとプロビジョニングの対象となっているオブジェクトすべてを改めて評価する初回サイクルが実施されます。<br>※ プロビジョニングの再開による初回サイクルを実施しても、ターゲットシステム 側の情報が初期化される等は発生いたしません。<br>※ 評価対象が増分サイクルよりも多い分、一度のサイクルに増分サイクルよりも長い時間を要します。</p><p>プロビジョニングを停止した状態でプロビジョニングの再開を行うと、停止された位置はクリアされ 1 から全ての対象オブジェクトの評価が行われる点が、 [プロビジョニングの開始] とは異なります。</p><p><img src="/blog/azure-active-directory/azure-ad-provisioning2/azure-ad-provisioning2-03.png"></p><h4 id="Q-同期したい-Azure-AD-属性がマッピングの候補にありません。候補がない属性についてはマッピングはできないのでしょうか？"><a href="#Q-同期したい-Azure-AD-属性がマッピングの候補にありません。候補がない属性についてはマッピングはできないのでしょうか？" class="headerlink" title="Q. 同期したい Azure AD 属性がマッピングの候補にありません。候補がない属性についてはマッピングはできないのでしょうか？"></a><span style="color: #ff0000; ">Q.</span> 同期したい Azure AD 属性がマッピングの候補にありません。候補がない属性についてはマッピングはできないのでしょうか？</h4><h4 id="A-下記手順でマッピング可能な属性が追加可能です。"><a href="#A-下記手順でマッピング可能な属性が追加可能です。" class="headerlink" title="A. 下記手順でマッピング可能な属性が追加可能です。"></a><span style="color: #3366ff; ">A.</span> 下記手順でマッピング可能な属性が追加可能です。</h4><p>プロビジョニングの属性マッピングにおける詳細オプションにつきましては、下記 Azure ポータルの URL に接続することで、編集可能となります。</p><h4 id="マッピング追加手順"><a href="#マッピング追加手順" class="headerlink" title="マッピング追加手順"></a>マッピング追加手順</h4><ol><li>以下のパラメーター付き URL を使用して Azure Active Directory ポータルにサインインします。</li></ol><p><a href="https://portal.azure.com/?Microsoft_AAD_Connect_Provisioning_forceSchemaEditorEnabled=true">https://portal.azure.com/?Microsoft_AAD_Connect_Provisioning_forceSchemaEditorEnabled=true</a></p><ol start="2"><li><p>[Azure AD] -[エンタープライズアプリケーション] - [任意のアプリケーション] - [プロビジョニング] - [プロビジョニングの編集] -[Provision Azure Active Directory Users] - [詳細オプションの表示] にチェックを選択します。</p></li><li><p>[Azure AD の属性リストを編集します] をクリックします。</p></li><li><p> 属性リストの下部にあるフィールドに、追加したい属性に関する情報を入力します。<br><img src="/blog/azure-active-directory/azure-ad-provisioning2/azure-ad-provisioning2-04.png"></p></li><li><p>［保存］を選択し変更を保存します。マッピング設定に戻り、4 で追加した属性を使用して SaaS 側の任意の属性とマッピングを設定します。その後問題なく追加した属性が SaaS 側の設定した属性にて問題なく同期されているかご確認ください。</p></li></ol><p>また、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/app-provisioning/user-provisioning-sync-attributes-for-mapping#create-an-extension-attribute-in-a-tenant-with-cloud-only-users">こちら</a> の公開情報に記載の通りテナント上のサービスプリンシパルの数が 1,000 を超える場合、プロビジョニング設定のソース属性の一覧にディレクトリ拡張属性 (AADC を使って拡張した拡張属性など) が含まれないことがございます。<br>この場合も上記の手順で手動で対象のディレクトリ拡張属性をソース属性としてご追加ください。</p><h3 id="プロビジョニング開始後"><a href="#プロビジョニング開始後" class="headerlink" title="プロビジョニング開始後"></a>プロビジョニング開始後</h3><h4 id="Q-ログを確認していると、エンタープライズアプリへ割り当てていないユーザーに対して処理が実行されていました（結果は-Skipと判定-。"><a href="#Q-ログを確認していると、エンタープライズアプリへ割り当てていないユーザーに対して処理が実行されていました（結果は-Skipと判定-。" class="headerlink" title="Q. ログを確認していると、エンタープライズアプリへ割り当てていないユーザーに対して処理が実行されていました（結果は Skipと判定)。"></a><span style="color: #ff0000; ">Q.</span> ログを確認していると、エンタープライズアプリへ割り当てていないユーザーに対して処理が実行されていました（結果は Skipと判定)。</h4><h4 id="A-想定された動作となります。"><a href="#A-想定された動作となります。" class="headerlink" title="A. 想定された動作となります。"></a><span style="color: #3366ff; ">A.</span> 想定された動作となります。</h4><p>Azure AD プロビジョニング機能では、テナント上で情報変更が発生した全てのユーザー（プロビジョニングの範囲外であっても）の情報をトレースする動作があります。その結果監査ログにはエンタープライズアプリへ割り当てていないユーザーに対して処理が実行されたようなログが記録されます。</p><p>トレースして検知したユーザー情報の変更について、もし該当のユーザーがプロビジョニングの対象であった場合は、実際の同期処理 (Export など) を進めます。一方で、スコープ外のユーザーは Skip されエクスポートはされませんため、実影響はありません。</p><p>本事象は後続の増分同期だけでなく初回同期でも同様に発生することが報告されており、よくあるお問い合わせとして「<a href="/blog/azure-active-directory/azure-ad-provisioning/">Azure AD のプロビジョニング機能について</a>」のブログ記事内にて解説されています。</p><h4 id="Q-ユーザーの変更を即時で反映したいです。"><a href="#Q-ユーザーの変更を即時で反映したいです。" class="headerlink" title="Q. ユーザーの変更を即時で反映したいです。"></a><span style="color: #ff0000; ">Q.</span> ユーザーの変更を即時で反映したいです。</h4><h4 id="A-「要求時にプロビジョニングする」をクリックし、オンデマンドで任意のユーザー-グループを同期できます。"><a href="#A-「要求時にプロビジョニングする」をクリックし、オンデマンドで任意のユーザー-グループを同期できます。" class="headerlink" title="A. 「要求時にプロビジョニングする」をクリックし、オンデマンドで任意のユーザー/ グループを同期できます。"></a><span style="color: #3366ff; ">A.</span> 「要求時にプロビジョニングする」をクリックし、オンデマンドで任意のユーザー/ グループを同期できます。</h4><p>自動プロビジョニングを設定しているエンタープライズ アプリケーションでは、画面キャプチャの赤枠に [要求時にプロビジョニングする] ボタンが表示されます。</p><p><img src="/blog/azure-active-directory/azure-ad-provisioning2/azure-ad-provisioning2-05.png"></p><p>こちらを実行することで、現在実行されているプロビジョニングサイクルの完了を待たずに適宜手動でプロビジョニングを実施可能です。<br>※ 一度に複数のユーザー/ グループは選択できません。</p><h4 id="Q-プロビジョニング対象外としたユーザーが-SaaS-からアカウントが削除されません。"><a href="#Q-プロビジョニング対象外としたユーザーが-SaaS-からアカウントが削除されません。" class="headerlink" title="Q. プロビジョニング対象外としたユーザーが SaaS からアカウントが削除されません。"></a><span style="color: #ff0000; ">Q.</span> プロビジョニング対象外としたユーザーが SaaS からアカウントが削除されません。</h4><h4 id="A-SaaS-側にてアカウントが非有効化されていないかご確認ください。"><a href="#A-SaaS-側にてアカウントが非有効化されていないかご確認ください。" class="headerlink" title="A. SaaS 側にてアカウントが非有効化されていないかご確認ください。"></a><span style="color: #3366ff; ">A.</span> SaaS 側にてアカウントが非有効化されていないかご確認ください。</h4><p>Azure AD にてアカウントが [削除済みユーザー一覧] に移ったり、プロビジョニングの割り当て対象から解除された場合、アカウントは論理的な削除状態として扱われます。</p><p>ユーザーが論理的な削除状態に移ると、Azure AD より SaaS へアカウントが非有効化された旨をアップデートするためのリクエストがへ送信されます。</p><p>ただし、Azure AD から該当ユーザーに対する変更リクエストを、ターゲットシステムがどのように受け取るかはターゲットシステム側の動作に依存します。</p><p>例えば、ある SaaS ではリクエストを受け取るとターゲットシステム側でアカウントを非有効化する、<br>また別の SaaS ではアカウントを非有効化しつつ、UPN を Azure AD より送信された最新の UPN に変更する等がございます。</p><p>そのため、Azure AD にてアプリから割り当てを解除したり、削除済みに移ったユーザーの SaaS 側での挙動に関しましては、実際にご検証をいただくもしくは、ご利用の SaaS へお問い合わせをしていただく等による確認が必要となります。</p><p>また [削除済みユーザー一覧] よりアカウントを完全に削除した場合、アカウントは完全な削除状態となります。<br>アカウントが完全に削除された際はその旨リクエストが送信され、SaaS 側でもアカウントが削除されることが想定されます。</p><h4 id="Q-エラーコード-‘Bad-credentials’-が表示されプロビジョニングが検疫になっています。"><a href="#Q-エラーコード-‘Bad-credentials’-が表示されプロビジョニングが検疫になっています。" class="headerlink" title="Q. エラーコード ‘Bad credentials’ が表示されプロビジョニングが検疫になっています。"></a><span style="color: #ff0000; ">Q.</span> エラーコード ‘Bad credentials’ が表示されプロビジョニングが検疫になっています。</h4><h4 id="A-Azure-AD-プロビジョニングではSaaS-側へ送信したリクエストが常に失敗する場合、プロビジョニング-ジョブが検疫状態となります。"><a href="#A-Azure-AD-プロビジョニングではSaaS-側へ送信したリクエストが常に失敗する場合、プロビジョニング-ジョブが検疫状態となります。" class="headerlink" title="A.  Azure AD  プロビジョニングではSaaS 側へ送信したリクエストが常に失敗する場合、プロビジョニング ジョブが検疫状態となります。"></a><span style="color: #3366ff; ">A.</span>  Azure AD  プロビジョニングではSaaS 側へ送信したリクエストが常に失敗する場合、プロビジョニング ジョブが検疫状態となります。</h4><p>検疫中は増分サイクルの頻度が徐々に減少し、最終的には 1 日 1 回になります。</p><p>エラーコード ‘Bad credentials’ が表示されている場合は、Azure AD から SaaS へプロビジョニングを行う際に必要となる Azure AD 側で保持しているトークンに問題がある状況が考えられます。</p><p>エラーメッセージ例:</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">&quot;Bad credentials&quot;</span><br><span class="line">While attempting to validate our authorization to access your application, we received this unexpected response.</span><br></pre></td></tr></table></figure><p>この場合の対処策は、上記のトークンを新しく取得するため Azure AD 側でユーザー プロビジョニングを構成する際に、Azure AD 側で入力する SaaS 側の管理者の資格情報の入力について改めて再構成することで、検疫状態が解消されプロビジョニングが動作できる可能性が考えられます。</p><p>プロビジョニングの検疫に関する詳細は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/app-provisioning/application-provisioning-quarantine-status">こちら</a>もご確認ください。</p><h4 id="Q-上記の-FAQ-で解決しない。"><a href="#Q-上記の-FAQ-で解決しない。" class="headerlink" title="Q. 上記の FAQ で解決しない。"></a><span style="color: #ff0000; ">Q.</span> 上記の FAQ で解決しない。</h4><h4 id="A-Azure-サポートの活用を検討ください。一般的に調査の際には次のような情報が必要です。"><a href="#A-Azure-サポートの活用を検討ください。一般的に調査の際には次のような情報が必要です。" class="headerlink" title="A.  Azure サポートの活用を検討ください。一般的に調査の際には次のような情報が必要です。"></a><span style="color: #3366ff; ">A.</span>  Azure サポートの活用を検討ください。一般的に調査の際には次のような情報が必要です。</h4><p>詳細はお問い合わせの後でご案内を差し上げておりますが、現象の発生タイミング、発生頻度に関する情報と併せまして事前に用意いただければと存じます。</p><pre><code>1. テナント ID ([Azure Active Directory] - [プロパティ] - [ディレクトリ ID] より確認可能です)2. プロビジョニングのジョブ ID もしくはアプリケーションの ID </code></pre><p>ご不明な点等がありましたら、ぜひ弊社サポート サービスをご利用ください。<br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure &amp;amp; Identity サポート チームの星野です。&lt;br&gt;本記事では、以前公開された記事「&lt;a href=&quot;/blog/azure-active-directory/azure-ad-provisioning/&quot;&gt;Azure AD のプロビ</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Provisioning" scheme="https://jpazureid.github.io/blog/tags/Provisioning/"/>
    
  </entry>
  
  <entry>
    <title>システムが優先する MFA 機能 一般提供の開始</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/ga-system-preferred-multifactor-authentication/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/ga-system-preferred-multifactor-authentication/</id>
    <published>2023-05-21T03:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.639Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 竜 です。</p><p>本記事は、2023 年 5 月 16 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/ga-system-preferred-multifactor-authentication/ba-p/3773138">GA: System-preferred multifactor authentication</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>これまでのブログにて、マイクロソフトでは <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">多要素認証 (MFA: Multifactor Authentication) の重要性</a> を繰り返し強調してきました。現在、組織やエンド ユーザーは、<a href="https://jpazureid.github.io/blog/azure-active-directory/authentication-strength-choose-the-right-auth-method-for-your/">さまざまな認証方法</a> を利用しており、そのセキュリティ レベルもさまざまです。ユーザーは、利便性、認識不足、技術的な制約などさまざまな要因から、より安全性が高い MFA の方法を利用できるのにも関わらず、安全性の低い方法を選択することがよくあります。</p><p>こうした中、ユーザーが「利用可能な最も安全な方法で認証すること」を奨励するため、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-system-preferred-multifactor-authentication">“システムが優先する MFA” の機能</a> を発表いたしました。この機能は、管理者が設定したポリシーで有効化されている方法ののうち、ユーザーが登録済みの MFA の方法の中から最も安全な方法を選んでサインインするよう促します。これにより、ユーザーは、最初に利用される既定の方法ではなく、利用可能な最も安全な方法を常に利用するように動作が変更されます。提示された最も安全な MFA の方法を利用できない場合は、別の方法を選択してサインインすることもできます。</p><p>管理者は、Azure ポータルの管理画面または <a href="https://developer.microsoft.com/en-us/graph/graph-explorer">Graph API</a> を使用してこの機能を展開することができます。たとえば、Jone Doe というユーザーが SMS と Microsoft Authenticator の両方を登録しており、SMS がサインインに利用する既定の方法だったとします。この場合、”システムが優先する MFA” 機能を有効にすることで、システムが推奨する方法である Microsoft Authenticator がユーザーに提示されます。</p><p>以下のように、管理者は認証方法の設定から、”システムが優先する MFA” の機能を有効化できます。</p><p><img src="/blog/azure-active-directory/ga-system-preferred-multifactor-authentication/1.png"></p><p>ユーザーが “システムが優先する MFA” の機能を有効にしている場合、「セキュリティ情報」ページは以下のように表示されます：</p><p><img src="/blog/azure-active-directory/ga-system-preferred-multifactor-authentication/2.png"></p><p>この例では、ユーザーにとって最も安全な方法は Microsoft Authenticator となります：</p><p><img src="/blog/azure-active-directory/ga-system-preferred-multifactor-authentication/3.png"></p><p><img src="/blog/azure-active-directory/ga-system-preferred-multifactor-authentication/4.png"></p><p>脅威の状況が刻々と変化する中、組織は、悪意のある攻撃者の先を行くことが今まで以上に重要となります。そのことを考慮した上で、以下のように “システムが優先する MFA” 機能の展開を予定しています。</p><ul><li>本機能は、2023 年 4 月に導入され、既定で Microsoft マネージド (無効) に設定されています。 </li><li>上記の初期段階の後、この機能はすべてのテナントで Microsoft マネージド (有効) として展開されます。この段階では、管理者が必要に応じてこの機能を無効化できるよう、無効化のオプションは保持されます。</li><li>最終的には、すべてのテナントで Microsoft マネージド (有効) に設定されます。この機能を無効化するオプションは削除されます。</li></ul><p>組織での展開に十分な準備期間を確保するため、6 月までにさらに詳細なスケジュールをお知らせする予定です。</p><p>組織とそのエンド ユーザーの安全を確保するため、本機能のロールアウト機能を使用し、速やかに本新機能を導入することを強く推奨しております。本機能がお客様のテナントで利用できるようになることで、ユーザーが常に最も安全な認証方法を初めに利用するよう、促すことが可能になりました。</p><p>いつものように皆様からのご意見をお待ちしております。<a href="aka.ms/AzureADFeedback">aka.ms/AzureADFeedback</a> までお気軽にご連絡ください。</p><p>Best regards,<br>Alex Weinert (<a href="https://twitter.com/Alex_T_Weinert">@Alex_T_Weinert</a>)<br>VP Director of Identity Security, Microsoft</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 竜 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 16 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>パブリック プレビュー: サインイン セッションのトークン保護</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/public-preview-token-protection-for-sign-in-sessions/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/public-preview-token-protection-for-sign-in-sessions/</id>
    <published>2023-05-18T00:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.915Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 5 月 10 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/public-preview-token-protection-for-sign-in-sessions/ba-p/3815756">Public Preview: Token Protection for Sign-In Sessions</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>先日の <a href="https://secure.microsoft.com/en-US/sessions/6ab7d30b-6322-483e-a3f3-34856e51bb15?source=sessions">Microsoft Secure のイベント</a> で、サインイン セッションのためのトークン保護という新機能を発表しました。本機能は、トークンの盗難やリプレイ攻撃の対策として開発された Microsoft Entra の一連の機能の第一弾となります。</p><p>ご存知のように、トークンの盗難を伴う攻撃はますます頻発しています。この問題に対処するため、私たちマイクロソフトは、Azure AD の条件付きアクセスを使用して重要なリソースをよりよく保護できるようにするための包括的な投資を行っています。</p><p>弊社のソリューションは、トークンの盗難に対抗する従来のアプローチよりも優れたセキュリティ特性を提供することを目的としています。これには、ユーザー デバイス上でトークンを盗むマルウェアによる攻撃や悪意のある内部攻撃者からの防御が含まれます。さらに、当社のソリューションでは、条件付きアクセスを使用してポリシーの適用をきめ細かく制御することも可能です。</p><p>トークンの保護は、トークンが意図したデバイス上でのみ使用できることを保証します。条件付きアクセス ポリシーを適用する場合、リソースへのアクセスを許可するトークンが、ユーザーが最初にサインインしたデバイスから提示されることを保証する必要があります。これにより、重要なユーザーやデータをトークンの盗難を伴う侵害から最大限保護することができます。</p><p>この機能の最初のプレビューでは、Windows ネイティブ クライアントから盗まれたリフレッシュ トークンが使用された場合でも、Exchange メールボックスや SharePoint サイトなどの Office 365 リソースを不正アクセスから保護することが可能となります。リフレッシュ トークンは、他の種類のトークンよりも有効期間が長く、スコープが広い傾向があるため、攻撃者としても窃取する価値が高いものとなります。このため、まずリフレッシュ トークンを保護の対象としています。今後のリリースでは、この保護をより多くのアプリケーションやデータ、他のクライアント プラットフォーム、他の種類のトークンに拡大する予定です。</p><p>これを有効にする方法について、簡単に説明します。</p><h2 id="サインイン-セッションに対するトークン保護の条件付きアクセスの実施-プレビュー"><a href="#サインイン-セッションに対するトークン保護の条件付きアクセスの実施-プレビュー" class="headerlink" title="サインイン セッションに対するトークン保護の条件付きアクセスの実施 (プレビュー)"></a>サインイン セッションに対するトークン保護の条件付きアクセスの実施 (プレビュー)</h2><p><img src="/blog/azure-active-directory/public-preview-token-protection-for-sign-in-sessions/public-preview-token-protection-for-sign-in-sessions1.png"></p><p>条件付きアクセスのセッション制御で “サインイン セッションにトークン保護を必要にする” を選択すると、ポリシーの範囲内で定義されたリソースにアクセスするためのセッションが、所有権の証明 (proof-of-possession) を使用することで、ユーザーがサインインしたデバイスに紐づけられます。所有権の証明では、クライアントがデバイス上の秘密鍵にアクセスできることを証明する必要があります。リフレッシュ トークンがユーザーのデバイスから盗まれ、攻撃者が管理するデバイスにコピーされた状況で、攻撃者がそのリフレッシュ トークンを使用してアクセスを試みた場合、所有権の証明は達成できず、ポリシーによってアクセスがブロックされます。</p><p>以下が今回の初回プレビューに特化した設定上の注意点です: まず、サポートされるリソースは、Exchange と SharePoint です。Teams のサポートは近日中に、その他のサービスも近日中に追加される予定です。</p><p>Azure AD に登録された Windows 10 または 11 のデバイスで、現在はネイティブのデスクトップ アプリケーションのみがサポートされています。Web アプリや他のクライアント プラットフォームからの正当なアクセスをブロックしないようにするには、[条件] &gt; [デバイス プラットフォーム] タブで “Windows” だけを選択し、[条件] &gt; [クライアント アプリ] タブで “ブラウザー” を選択せずに “モバイル アプリとデスクトップ クライアント” のみを選択する必要があります。</p><p><img src="/blog/azure-active-directory/public-preview-token-protection-for-sign-in-sessions/public-preview-token-protection-for-sign-in-sessions2.png"></p><p><img src="/blog/azure-active-directory/public-preview-token-protection-for-sign-in-sessions/public-preview-token-protection-for-sign-in-sessions3.png"></p><p>他のポリシーと同様に、特定のユーザーまたはグループにスコープを設定し、管理者がテナントにアクセスできなくならないように特定のアカウントを除外することも忘れないようにしてください。ポリシーの導入を計画する前に、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-token-protection">ドキュメント</a> をよく読むこともお勧めします。アクセスが正当なものであることを確認するため、ポリシーはユーザーが所有権の証明のステップを実行できるよう準拠した OS とアプリのバージョンを使用していることを確認します。ポリシーをオンにする前に、ポリシーの影響を評価するため、条件付きアクセスのレポート専用モードを使用することを強くお勧めします。また、所有権の証明によるトークンの保護はゼロ トラストの多層防御の戦略の一部でしかないため、加えてデバイス管理と準拠、クラウドベースのフィッシング耐性のある認証の使用などを併せて使用することも忘れないようご注意ください。</p><p>トークン保護のロードマップにある今後のリリースは以下のとおりです: </p><ul><li>リソースとアクセス シナリオの追加</li><li>Web アプリケーションの追加 (MSAL.js を使用する Web アプリケーションの多層防御機能の向上)</li><li>サインイン セッションのトークンの保護 (Mac、iOS、Android、Linux クライアントにおけるリフレッシュ トークンの盗難シナリオに対応)</li><li>アプリのセッション トークンの保護 (アクセス トークンの盗難とリプレイ攻撃を制限)</li></ul><p>今後これらについてさらに詳しくお伝えすることを楽しみにしています。詳しくは、今後のブログ記事をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 10 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Verified ID と Identity Governance の統合 - より正確なアクセス権の付与と迅速なオンボーディング</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/identity-governance-with-verified-id/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/identity-governance-with-verified-id/</id>
    <published>2023-05-14T00:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.735Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure ID チームの小出です。</p><p>本記事は、2023 年 4 月 7 日に公開されました  <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/entra-identity-governance-with-entra-verified-id-higher-fidelity/ba-p/2466934">Entra Identity Governance with Entra Verified ID – Higher Fidelity Access Rights + Faster Onboarding</a> の記事を日本語に意訳した内容になります。ご不明点などございましたらお気軽にサポートまでお問い合わせください。</p><hr><p>この度、Entra Identity Governance エンタイトルメント管理と、先日ご紹介した Microsoft Entra Verified ID の統合を発表できることを嬉しく思います！</p><p>従業員、請負業者、パートナー、その他のビジネス ゲストを含む新しいユーザーをオンボードするために何が必要かを考えてみると、多くの場合、ID 情報や資格情報の確認が必要となります。このプロセスは面倒で時間がかかり、ユーザーは冗長なオンライン フォームに記入したり事務作業をしたりする必要があるため、最終的に採用スケジュールや立ち上げ期間に遅れが生じることになります。</p><p>この負担を緩和するために、弊社では以前、<a href="https://jpazureid.github.io/blog/azure-active-directory/onboard-partners-more-easily-with-new-azure-ad-entitlement/">新しい Azure AD エンタイトルメント管理機能でパートナー (外部ユーザー) との連携をより簡単に</a> の記事で案内したようにカスタム質問と属性収集の機能を導入しました。エンタイトルメント管理における Microsoft Entra Verified ID のチェック機能の統合により、このオンボーディング処理がさらに簡単になりました。</p><p>この新機能の詳細を以下にご紹介しますので、アクセス要求の管理の流れにおいてどのように本機能が作用するかをご覧いただければ幸いです。 </p><h2 id="シナリオ-独自に検証された資格情報を要求して機密リソースへのアクセスを承認する"><a href="#シナリオ-独自に検証された資格情報を要求して機密リソースへのアクセスを承認する" class="headerlink" title="シナリオ: 独自に検証された資格情報を要求して機密リソースへのアクセスを承認する"></a>シナリオ: 独自に検証された資格情報を要求して機密リソースへのアクセスを承認する</h2><p>新規顧客のプロジェクトで、外部のマーケティング会社と協力しているとします。あなたの組織は、コンサルタントが新しいプロジェクトに参加する前に、ベンダーとしての認定を取得する必要があります。このため、コンサルタントは、オンボーディングの手続きを開始する前に、証明書のコピーを電子メールで送信する必要があります。これでは大変不便ですし、時間もかかってしまいます。</p><p>この必要な認定ベンダーの証明書を発行する機関が、Verified ID の発行を開始したことを最近知りました。現在、あなたはプロジェクトに必要なリソースを含む <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-overview#what-are-access-packages-and-what-resources-can-i-manage-with-them">アクセス パッケージ</a>）を利用しています。このため、コンサルタントがアクセス パッケージへのアクセスを要求する際に、すでにあるオンボーディング プロセスに Verified ID のチェックを組み込むことにしました。</p><p>その方法は次のとおりです。</p><h2 id="わずか-3-ステップで-Verified-ID-を使用したアクセス-パッケージへの自動アクセスを設定する！"><a href="#わずか-3-ステップで-Verified-ID-を使用したアクセス-パッケージへの自動アクセスを設定する！" class="headerlink" title="わずか 3 ステップで Verified ID を使用したアクセス パッケージへの自動アクセスを設定する！"></a>わずか 3 ステップで Verified ID を使用したアクセス パッケージへの自動アクセスを設定する！</h2><ol><li><strong>検証済み ID をアクセス パッケージの要件として追加します</strong>: [Entra Identity Governance アクセス パッケージ]<a href="https://entra.microsoft.com/#view/Microsoft_AAD_ERM/DashboardBlade/~/elmEntitlement">https://entra.microsoft.com/#view/Microsoft_AAD_ERM/DashboardBlade/~/elmEntitlement</a> にアクセスして、保護したいアクセス パッケージを選択します。<strong>ポリシー</strong> セクションに行き、**+ ポリシーの追加** をクリックして新しいポリシーを追加する流れです。<strong>要求</strong> タブで、<strong>必須の確認済み ID</strong> セクションを確認します。</li></ol><p><img src="/blog/azure-active-directory/identity-governance-with-verified-id/identity-governance-with-verified-id1.png"></p><p><strong>+ 発行者の追加</strong> をクリックします。ドロップダウンを使用して Entra Verified ID ネットワークで Contoso Supplier Agency を検索し、Verified Vendor の資格情報の種類を選択します。</p><p><img src="/blog/azure-active-directory/identity-governance-with-verified-id/identity-governance-with-verified-id2.png"></p><ol start="2"><li><strong>手動での承認を削除する</strong>: Verified Vendor の資格情報は、信頼された発行元によるユーザー認定の証明として検証されたものであるため、承認者が手動で承認する必要はありません。これにより、オンボーディングが一層スムーズになります。</li></ol><p><img src="/blog/azure-active-directory/identity-governance-with-verified-id/identity-governance-with-verified-id3.png"></p><p>プロジェクトに参加するコンサルタントが <a href="https://myaccess.microsoft.com/">My Access ポータル</a> からアクセス パッケージへのアクセスを要求する際、Microsoft Authenticator から Verified Vendor の資格情報の提示が求められます。</p><p><img src="/blog/azure-active-directory/identity-governance-with-verified-id/identity-governance-with-verified-id4.png"></p><p><img src="/blog/azure-active-directory/identity-governance-with-verified-id/identity-governance-with-verified-id5.png"></p><p>必要なのは、画面に表示された QR コードをスキャンすることだけです。これにより、資格証明書を提示することができ、アクセス パッケージ ポリシーでは承認者による手動レビューが必要ないため、発行機関により資格情報が確認されたら、コンサルタントは自動的にアクセスを得ることができます。例えば、このような感じです：</p><p><img src="/blog/azure-active-directory/identity-governance-with-verified-id/identity-governance-with-verified-id6.png"></p><ol start="3"><li><strong>要求アクティビティについて監査ログを確認する</strong>: <a href="https://entra.microsoft.com/#view/Microsoft_AAD_ERM/DashboardBlade/~/Audit%20logs">Entra Identity Governance 監査ログ</a> に移動し、Verified ID が提示された際に、アクセス パッケージへのアクセスが許可されていることを確認できます。</li></ol><p><img src="/blog/azure-active-directory/identity-governance-with-verified-id/identity-governance-with-verified-id7.png"></p><h2 id="お客様の声"><a href="#お客様の声" class="headerlink" title="お客様の声"></a>お客様の声</h2><p>Swiss IT はマイクロソフトのパートナーであり、ユーザーが機密データにアクセスする必要がある場合に、対面での作業により ID の証明を行っている顧客を支援する業務を行っています。Swiss IT は、必要なデジタル証明書を含む Verified ID を発行しています。この統合により、Swiss IT は、ユーザーがアクセス要求を提出する際に、そのユーザーの市民権の有無を自動的に検証することができるようになります。</p><blockquote><p>“Entra Verified ID を Entra Identity Governance に統合することで、エンタイトルメント管理のフローにおいて ID の検証や承認を自動化することができるようになります。これにより、企業の規制や契約上の義務を遵守しながら、医薬品開発のような機密性の高いデータのコラボレーション環境を安全に保つことができるようになりました。” - Jens Lorenz (Swiss IT 社 戦略コンサルタント、CISSP、CCSP、CIPT)</p></blockquote><p>同様に、一部のお客様は、強い権限を持たない生産性アプリケーションであっても、外部ユーザーのアクセスについて手動でレビュー プロセスを実施している場合も多く見られます。このようなお客様は、必要な Verified ID を提供すればゲストに自動的に権限が割り当てられるようなスコープ付きのアクセス パッケージを設定することで、組織外の人々とコラボレーションを行うことも可能となります。 </p><blockquote><p>“多くの大企業では、複数のサービス プロバイダーと連携しており、個人としてどのような人が作業に来るのかは必ずしも把握しておらず、むしろその人がどの企業に所属しているかという雇用主の方を信頼しているはずです。そのような場合、長時間の事前オンボーディングは困難です。Verified ID とエンタイトルメント管理を組み合わせることで、アクセス要求プロセスの中で本人確認を行い、すぐその場でアクセス要求を行うことができるようになりました。” - Erik Siebler（IAM リード、DXC）  </p></blockquote><h2 id="Entra-Identity-Governance-のエンタイトルメント管理でリソースへのアクセスを保護してアクセス要求のフローに-Entra-Verified-ID-を組み込みましょう！"><a href="#Entra-Identity-Governance-のエンタイトルメント管理でリソースへのアクセスを保護してアクセス要求のフローに-Entra-Verified-ID-を組み込みましょう！" class="headerlink" title="Entra Identity Governance のエンタイトルメント管理でリソースへのアクセスを保護してアクセス要求のフローに Entra Verified ID を組み込みましょう！"></a>Entra Identity Governance のエンタイトルメント管理でリソースへのアクセスを保護してアクセス要求のフローに Entra Verified ID を組み込みましょう！</h2><p>Entra Identity Governanceのエンタイトルメント管理を始めるには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-first">アクセス パッケージをセットアップする方法についてステップバイステップのガイド</a> をご覧ください。アクセス パッケージを設定したら、Verified ID を要件にしてアクセス パッケージを設定する方法について、<a href="https://learn.microsoft.com/en-us/azure/active-directory/governance/entitlement-management-verified-id-settings">このガイド</a> も参照ください。</p><p>エンタイトルメント管理の要求の流れで Verified ID を利用するには、テナントを Verified ID サービスにオンボードする必要があります。Microsoft Entra Verified ID を使用するためにテナントを設定する方法については、<a href="https://learn.microsoft.com/en-us/azure/active-directory/verifiable-credentials/verifiable-credentials-configure-tenant">このチュートリアル</a> を参照ください。</p><p>この機能を試すために、ぜひ今日からユーザーに Verified ID を発行し、Verified ID を要件とするアクセス パッケージを構成ください！</p><p>お客様のご意見をお聞かせいただき、ユーザー ID を一緒に進化させていきたいと思います！</p><p>Joseph Dadzie, Partner Director of Product Management<br>LinkedIn: <a href="https://www.linkedin.com/in/joedadzie/">@joedadzie</a><br>Twitter: <a href="https://twitter.com/joe_dadzie">@joe_dadzie</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 7 日に公開されました  &lt;a href=&quot;https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-bl</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Identity Governance" scheme="https://jpazureid.github.io/blog/tags/Identity-Governance/"/>
    
    <category term="Verified ID" scheme="https://jpazureid.github.io/blog/tags/Verified-ID/"/>
    
  </entry>
  
  <entry>
    <title>認証方法の管理画面を刷新</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/modernizing-authentication-management/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/modernizing-authentication-management/</id>
    <published>2023-05-12T22:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.835Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 長谷川 です。</p><p>本記事は、2023 年 5 月 9 日に米国の Microsoft Entra (Azure AD) Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/modernizing-authentication-management/ba-p/2365669">Modernizing Authentication Management</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>この度、お客様の認証体験の管理方法について 2 つの重要なアップデートを発表できることを嬉しく思います。一つ目が統合された認証方法の一般提供 (GA) 開始と、もう一つが刷新された多要素認証 (MFA) の疑わしいアクティビティのレポートのパブリック プレビューです。</p><p>統合された認証方法の一般提供 (GA) により、認証やパスワード リセットに使用されるすべての方法を一元管理できるとともに、対象ユーザーやグループを絞った細かい制御が可能となりました。</p><p>MFA における最新の “疑わしいアクティビティ” のレポート機能のパブリック プレビューでは、設定箇所が認証方法ポリシーに組み込まれ、このユーザーから報告された疑わしい MFA 要求の情報を Identity Protection に統合しました。</p><h2 id="統合された認証方法"><a href="#統合された認証方法" class="headerlink" title="統合された認証方法"></a>統合された認証方法</h2><p>従来は、MFA 用とセルフサービス パスワード リセット用の認証方法を別々に管理する必要がありました。現在では、FIDO2 セキュリティ キーや証明書ベースの認証のようなパスワードレス認証の方法と併せ、1 つの画面で両方を管理することができるようになりました。新たに追加された認証方法には、SMS、音声通話、サードパーティ製 OATH ソフトウェア トークン、電子メール ワンタイム パスコード認証があります。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management1.png"></p><p>認証方法をよりきめ細かく管理できるようになり、すべてのユーザーではなく特定のユーザーやグループに対して認証方法を有効にしたり、ユーザーのグループを対象から除外したりする機能が追加されました。つまり、試験的に一部のグループで認証方法を試したり、SMS や音声通話などのセキュリティ レベルの低い認証方法の利用については、少数のユーザー グループに限定したりすることもできます。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management2.png"></p><p>また、従来の MFA および セルフサービス パスワード リセット ポリシーから統合された認証方法に管理を移行する際に利用できる移行の制御機能も追加されました。この機能を使用することで、認証方法を個別に移行したりテストしたりしたうえで、従来のポリシーで認証方法を無効にするということができます。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management3.png"></p><p>2024 年後半には、レガシー ポリシーで認証方法を管理する機能を廃止する予定です。統合された認証方法への移行にあたっては、<a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">セキュリティ対策を強化するために、これを機に SMS や音声通話の認証を取りやめ</a>、Microsoft Authenticator や FIDO2 セキュリティ キーなど、より安全な認証方法を有効にすることをお勧めします (まだの方は、ぜひご検討ください)。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-methods-manage">認証方法の管理</a> と <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-authentication-methods-manage">認証方法ポリシーへの移行</a> の詳細を確認し、できるだけ早く移行ください !</p><h2 id="疑わしいアクティビティのレポート"><a href="#疑わしいアクティビティのレポート" class="headerlink" title="疑わしいアクティビティのレポート"></a>疑わしいアクティビティのレポート</h2><p>Azure Active Directory (Azure AD) には、Microsoft Authenticator アプリや電話で受け取った疑わしい MFA 要求をユーザーが報告できる “MFA の不正アクセス アラート” 機能がありました。この機能によりブロック ストに追加されたユーザーはそのリストから消されるまで MFA 要求を受け取らないようになりますが、ブロック リストからの削除は管理者の手動作業でした。また、不正アクセスのアラートとブロック リストの管理にはすべてグローバル管理者権限が必要でした。今回、不正アクセスのアラート機能を疑わしいアクティビティのレポート機能と共に刷新し、この機能の設定を認証方法ポリシーに移動するとともに、他の認証関連の設定と同じ場所で設定できるようにしました。また、ユーザーが不審なプロンプトを報告した際に、より包括的なアクションをとれるようにアラート イベントを Identity Protection に統合しました。</p><p>疑わしいアクティビティのレポート機能を有効にし、全ユーザーか一部ユーザーをその対象とするには、認証方法の画面にある新しい “設定” から行うか、または認証方法の Microsoft Graph API を使用ください。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management4.png"></p><p>この機能が有効になると、ユーザーが Microsoft Authenticator アプリのプッシュ通知や音声での MFA 要求を疑わしいと報告した場合、そのユーザー アカウントはユーザー リスク高とマークされます。その後、リスクベースのポリシーを使用して、これらのユーザーの回復方法をより細かく制御することができます。例えば、セルフサービスのパスワード リセットによる即時のパスワード変更を要求したり、リスクが改善されるまですべての認証に MFA を要求したり、リスクが改善されるまで認証をブロックするなどが挙げられます。</p><p><img src="/blog/azure-active-directory/modernizing-authentication-management/modernizing-authentication-management5.png"></p><p>もし Azure AD Premium P2 ライセンスをお持ちでない場合は、レガシー MFA ブロック リストと同様の機能として、リスク イベントを使用して、リスクが改善されるまでアカウントを無効にすることも可能です。</p><p>疑わしいアクティビティのレポート機能は、プレビュー中は従来の MFA の不正なアクセスのアラート機能と並行して機能するため、不正なアクセスのアラート機能を有効にして自動ブロックしている場合は、ユーザーの修復を行う際に、疑わしいアクティビティのレポート機能の適用範囲内のユーザーのリスクを改善することに加えて、MFA のブロック リストからユーザーを削除する必要もあります。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-mfa-mfasettings#report-suspicious-activity">疑わしいアクティビティのレポート機能</a> の構成と <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-policies">リスクベースのポリシー</a> の詳細を確認いただき、今すぐ疑わしいアクティビティのレポート機能をお試しください。</p><p>いつものように、フィードバックをお聞かせください。よろしくお願いします。</p><p>Alex Weinert (<a href="https://twitter.com/Alex_T_Weinert">@Alex_T_Weinert</a>)<br>VP Director of Identity Security, Microsoft</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 長谷川 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 9 日に米国の Microsoft Entra (Azure AD) Blog で公開された &lt;a href=&quot;https://techcommuni</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra Verified ID で LinkedIn 上での職場を証明する新しい方法の紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-a-new-way-to-verify-your-workplace-on-linkedIn-with-microsoft-entra-verified-id/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-a-new-way-to-verify-your-workplace-on-linkedIn-with-microsoft-entra-verified-id/</id>
    <published>2023-05-11T23:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.743Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 張替 です。</p><p>本記事は、2023 年 4 月 12 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/introducing-a-new-way-to-verify-your-workplace-on-linkedin-with/ba-p/3627349">Introducing a new way to verify your workplace on LinkedIn with Microsoft Entra Verified ID - Microsoft Community Hub</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>本日、LinkedIn をお使いの何百万もの方々が、Microsoft Entra Verified ID の資格情報を使用して、職場の認証ができるようになることをお知らせします。職場の認証は、LinkedIn メンバーのプロフィールに表示され、一覧にある勤務先が正確であることを確認するとともに、他のメンバーや組織に対して信頼と信憑性の印として機能します。</p><h2 id="職場の認証を行うための従業員-ID-の発行方法"><a href="#職場の認証を行うための従業員-ID-の発行方法" class="headerlink" title="職場の認証を行うための従業員 ID の発行方法"></a>職場の認証を行うための従業員 ID の発行方法</h2><p>組織は、わずか数分で Verified ID を使用して、ブランドやビジネス ニーズに合わせたデジタル従業員 ID を作成することが可能です。LinkedIn メンバーは、プロフィール上の「職場を認証する」ボタンをクリックし、携帯電話で数回タップするだけで、組織が発行するデジタル従業員 ID を受け取ることができます。従業員 ID の認証情報が LinkedIn と共有されると、職場の認証がプロフィールに表示されます。</p><p><img src="/blog/azure-active-directory/introducing-a-new-way-to-verify-your-workplace-on-linkedIn-with-microsoft-entra-verified-id/introducing-a-new-way-to-verify-your-workplace-on-linkedIn-with-microsoft-entra-verified-id1.png" alt="LinkedIn モバイル アプリの画面で、メンバーのプロフィールには「職場」の横にチェックマークが表示され、メンバーが職場の認証をしたことが示されます。"></p><p>職場の認証の詳細と実装方法については、マイクロソフトの ID およびネットワーク アクセス担当のプレジデントである Joy Chik による <a href="https://www.microsoft.com/en-us/security/blog/2023/04/12/linkedin-and-microsoft-entra-introduce-a-new-way-to-verify-your-workplace/">このブログ記事</a> をぜひお読みください。</p><h2 id="LinkedIn-で従業員-ID-を発行して勤務先を確認するための準備を整える"><a href="#LinkedIn-で従業員-ID-を発行して勤務先を確認するための準備を整える" class="headerlink" title="LinkedIn で従業員 ID を発行して勤務先を確認するための準備を整える"></a>LinkedIn で従業員 ID を発行して勤務先を確認するための準備を整える</h2><p>組織のグローバル管理者の方で、LinkedIn での職場認証の準備をされたい方は、<a href="https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR5RXCPyJ0yZAs6VJmUULNKZUQlJVOEFIVEpPS1Y1M1hMSUZMN0c1WEpPTS4u">こちらのフォーム</a> からパイロット プログラムにご登録をお願いします。</p><h2 id="今すぐ検証済み-ID-を発行しましょう"><a href="#今すぐ検証済み-ID-を発行しましょう" class="headerlink" title="今すぐ検証済み ID を発行しましょう"></a>今すぐ検証済み ID を発行しましょう</h2><p>Verified ID の資格情報は、多くのシナリオで信頼性や信憑性、検証可能性を高め、コスト、時間および連携のストレスを削減することが可能です。すぐに Verified IDを使用して従業員 ID を発行可能です。わずか数分で完了します。始めるには、以下の <a href="https://learn.microsoft.com/en-us/azure/active-directory/verifiable-credentials/">チュートリアル</a> をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 張替 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 12 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>パブリック プレビュー Authenticator Lite (Outlook)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/public-preview-authenticator-lite/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/public-preview-authenticator-lite/</id>
    <published>2023-05-11T22:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.911Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 張替 です。</p><p>本記事は、2023 年 4 月 18 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/public-preview-authenticator-lite-in-outlook/ba-p/3773139">Public Preview: Authenticator Lite (in Outlook)</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>2 年前、私たちは <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">“認証に電話網を使うのはそろそろやめよう (It’s Time to Hang Up on Phone Transports for Authentication)”</a> と題した記事を公開しました。本日、テキスト メッセージ (SMS) や音声ベースの認証からの移行を支援するツールとして、<strong>Authenticator Lite</strong> のパブリック プレビューを開始します。弊社としては、パスワードレス、フィッシング対策、使いやすさ、進化する攻撃への適応性など、最新の強力な認証を使用してすべてのユーザーがサインインできるようにすることを重要視しています。</p><p>最新の強力な認証で弊社が最も推奨するのは、最も堅牢なセキュリティ機能を提供し、最も頻繁に更新され、加えて無料の <a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-authentication-authenticator-app">Authenticator</a> です。Microsoft Authenticator アプリは、安全で簡単な認証方法として世界中で 1 億人以上のユーザーに信頼されており、Azure にサインインする際の強力な認証方法として最も一般的なものとなっています。</p><p>先進的かつ強力な認証は非常に重要であるため、これをより利用しやすくするために、この度 Outlook クライアントに直接その機能を組み込みました！この Outlook に組み込まれたユーザー体験は <a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite">Authenticator Lite</a> と呼ばれ、このパブリック プレビューが開始されたことをここで発表いたします！まだ Authenticator をダウンロードしていないユーザーでも、iOS または Android デバイスの Outlook アプリを使用して、職場や学校のアカウントの MFA を無料で完了できるようになりました。ユーザーは認証要求を承認し、TOTP コードを取得できるようになります。これにより、電話網に依存する認証からユーザーをスムーズに移行させつつ、Authenticator の安全性を享受できるようになります。</p><p>パブリック プレビューでは、管理者はユーザーのグループに対してこの機能を有効または無効にするか、Microsoft managed (Microsoft に設定を任せる) の状態のままにするかを選択できます。Authenticator Lite を有効にするグループを設定するには、Entra ポータルの Authenticator 設定ページから行います。 また、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite">Microsoft Graph を使用して機能を有効にする</a> ことも可能です。</p><div class="alert is-info"><p class="alert-title">Note</p><p>サポート チームによる補足: 以下の画面にあるコンパニオン アプリケーションとは Outlook のこと、つまり Authenticator Lite が組み込まれたアプリのことを示しています。</p></div><p><img src="/blog/azure-active-directory/public-preview-authenticator-lite/1.png"></p><p>Authenticator Lite は、その名のとおり、Authenticator の機能の一部を Outlook に拡張するものです。認証時の通知では、番号一致のプロンプトに加え、デバイスで有効な場合は生体認証または PIN の確認が含まれます。Authenticator Lite の通知設定の詳細については、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite#enable-authenticator-lite">こちら</a> をご覧ください。</p><p>Authenticator Liteが有効になると、Authenticator アプリを搭載していない<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite#prerequisites">最新バージョンの Outlook</a> を使用しているユーザーは、デバイスでアプリを起動する際に、MFA の方法として Outlook を登録するよう促されます。</p><p><img src="/blog/azure-active-directory/public-preview-authenticator-lite/2.png"></p><p>ユーザーが登録されると、次回の認証時に、Outlook アプリでプッシュ通知を使って認証するよう促されます。</p><p><img src="/blog/azure-active-directory/public-preview-authenticator-lite/3.png"></p><p>登録済みのユーザーは、Outlook の設定の「Authenticator」から TOTP コードを取得することもできます。</p><p><img src="/blog/azure-active-directory/public-preview-authenticator-lite/4.png"></p><p>ユーザーに対してこの機能を有効にするための詳細については、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/how-to-mfa-authenticator-lite#prerequisites">こちら</a> を参照ください。Outlook でこの機能を利用するための展開処理が現在進行中であり、お客様は順次本機能を利用可能となります。</p><p>本機能は、<a href="https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-authentication-default-enablement">“Microsoft managed”</a> の状態でテナントに展開されます。パブリック プレビューの期間中は機能を “Microsoft managed” のままにしてもユーザーへの影響はなく、明示的に状態を有効に変更しない限り、この機能はオフのままです。2023 年 4 月下旬、プレビューの表示を削除し、一般提供 (GA) 開始となります。2023 年 5 月 26 日、この機能が “Microsoft managed” に設定されたままであれば、お客様のテナントでは Microsoft によって Authenticator Lite が有効になります。5 月 26 日にこの機能が有効になることを望まない場合は、5 月 26 日より前に状態を “無効” に設定するか、有効にしたいユーザーと無効にしたいユーザーをそれぞれグループに割り当てるよう対応ください。 </p><p>ご質問やご意見がございましたら、<a href="https://feedback.azure.com/d365community">aka.ms/AzureADFeedback</a> までご連絡くださいますようお願いいたします。</p><p>Alex Weinert<br>VP Director of Identity Security, Microsoft<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 張替 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 18 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>モバイル デバイスでの Azure AD 証明書ベースの認証が GA となりました！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/</id>
    <published>2023-05-06T22:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.423Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 5 月 4 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-certificate-based-authentication-cba-on-mobile-now/ba-p/1144695">Azure AD Certificate-Based Authentication (CBA) on Mobile now Generally Available!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>Ignite 2022 では、<a href="https://jpazureid.github.io/blog/azure-active-directory/identity-innovation-for-a-more-secure-nation/">大統領令 14028</a>「国家のサイバーセキュリティの改善」に対するマイクロソフトのコミットメントの一環として、Azure Active Directory (Azure AD) の証明書ベース認証 (CBA) の GA を発表しました。このたび、<strong>モバイルでの Azure AD CBA サポート</strong> の <strong>GA</strong> を発表できることを嬉しく思います。</p><p>iOS および Android デバイスにおいて、デバイス上の証明書に加え、USB や NFC 経由で YubiKeys のような外部ハードウェア セキュリティ キーの両方をサポートします。BYOD (Bring Your Own Device) が増加する中、この機能により、ユーザーのモバイル デバイスに証明書をプロビジョニングしなくても、モバイルに対してフィッシング耐性のある多要素認証 (MFA) を要求できるようになります。</p><p>今回は、モバイルでの Azure AD CBA のサポートについて、Microsoft Entra のプロダクト マネージャーである Vimala Ranganathan を招き、モバイルでのフィッシング耐性ある MFA の詳細を解説してもらいます。</p><p>お客様のフィードバックや提案をお待ちしています！Twitter (@azuread) までご連絡ください。</p><p>Alex Simons (<a href="https://twitter.com/alex_a_simons">@Alex_A_Simons</a>)<br>Corporate Vice President<br>Microsoft Identity Division</p><hr><p>みなさん、こんにちは。  </p><p>USB と NFC を介したハードウェア セキュリティ キー上の証明書を使用して、iOS および Android デバイス上で <strong>Azure AD CBA</strong> の <strong>GA</strong> を開始したことについて、さらに詳しくお伝えしたいと思います。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic1.png"></p><p>米国のサイバーセキュリティに関する <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">大統領令 14028</a> は、すべてのデバイス プラットフォームでフィッシング耐性のある MFA の使用を要求しています。お客様は、ハードウェア セキュリティ キーに証明書をプロビジョニングし、それを iOS や Android デバイス上で Azure AD での認証に使用することができるようになりました。モバイル デバイスにおけるマイクロソフトの証明書ベースのソリューションは、ハードウェア セキュリティキーと相まって、シンプルかつ便利で、Federal Information Processing Standards (FIPS) 認定のフィッシング耐性ある MFA 方式です。  </p><p>iOS 16 と iPadOS 16.1 で、Apple は NFC または CCID クラスに準拠したリーダーを使用した物理的なスマートカード認証のネイティブ サポートを追加しました。これにより、Azure AD に対して CCID 互換のスマートカードを認証に使用できるようになりました。</p><p>最新の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/msal-overview">Microsoft Authentication Library</a> (MSAL) を使用する Microsoft のファーストパーティ アプリを含むすべてのネイティブ アプリで、モバイル デバイス上での <a href="https://www.yubico.com/products/">YubiKey</a> を使用した Azure AD CBA がサポートされます。また、最新の MSAL を利用していないすべてのアプリでも、最新の Microsoft Authenticator (<a href="https://play.google.com/store/apps/details?id=com.azure.authenticator&gl=US">Android</a> または <a href="https://apps.apple.com/app/microsoft-authenticator/id983156458">iOS/iPadOS</a>) を使用したブローカー認証のフローで Yubikey を用いた Azure AD CBA がサポートされます。</p><h2 id="iOS-デバイス上での-YubiKey-を使用した-Azure-AD-CBA"><a href="#iOS-デバイス上での-YubiKey-を使用した-Azure-AD-CBA" class="headerlink" title="iOS デバイス上での YubiKey を使用した Azure AD CBA"></a>iOS デバイス上での YubiKey を使用した Azure AD CBA</h2><p>iOS が YubiKey を認識しない場合は、<a href="https://apps.apple.com/us/app/yubico-authenticator/id1476679808%22HYPERLINK%20%22https://apps.apple.com/us/app/yubico-authenticator/id1476679808">Yubico Authenticator App</a> を使用して YubiKey の公開証明書を iOS キーチェーンにコピーします (スマートカード証明書の秘密鍵が YubiKey からコピーされることはありません)。</p><p>サインインするには、ユーザーは証明書選択画面から YubiKey の証明書を選択し、YubiKey を挿入するか、NFC 対応の YubiKey をタップして、YubiKey Authenticator 経由で PIN を入力し、認証フローを完了します。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic2.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic3.png"></p><h2 id="Android-デバイス上での-YubiKey-を使用した-Azure-AD-CBA"><a href="#Android-デバイス上での-YubiKey-を使用した-Azure-AD-CBA" class="headerlink" title="Android デバイス上での YubiKey を使用した Azure AD CBA"></a>Android デバイス上での YubiKey を使用した Azure AD CBA</h2><p>Android モバイルでの YubiKey による Azure AD CBA は、最新の MSAL を使用することで利用可能であり、YubiKey Authenticator アプリは Android においては必要ありません。  </p><p>Azure AD CBA を行うには、物理的なスマートカード上の証明書使用するか、USB 経由で YubiKey を接続するか、もしくは NFC を使用して、YubiKey から証明書を選択し、PIN を入力します。これでアプリケーションへの認証が完了します。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic4.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic5.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic6.png"></p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-cba-on-mobile-now/pic7.png"></p><p>また、Azure AD CBA と YubiKeys については、こちらで詳しく解説しています:</p><ul><li>Azure AD CBA: <a href="http://aka.ms/aadcba">http://aka.ms/aadcba</a></li><li>iOS 上での Azure AD CBA: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-certificate-based-authentication-mobile-ios">iOS デバイスにおける Azure Active Directory の証明書ベースの認証</a></li><li>Android 上での Azure AD CBA: <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/concept-certificate-based-authentication-mobile-android">Android デバイスにおける Azure Active Directory の証明書ベースの認証</a></li><li>YubiKey: <a href="https://www.yubico.com/why-yubico/">Meet the YubiKey - Strong Two-Factor Authentication Solution</a></li></ul><h2 id="今後について"><a href="#今後について" class="headerlink" title="今後について"></a>今後について</h2><p><a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure Active Directory Community</a> でフィードバックをお寄せください！弊社では今後、証明書の選択画面に表示される証明書をフィルタリングする機能を追加するとともに、モバイル上での Azure AD CBA にて他のスマートカード プロバイダーを利用できるようにする対応にも取り組んでいます。  </p><p>大統領令 14028 に対するマイクロソフトのコミットメントについては、<a href="https://www.microsoft.com/en-us/security/blog/2022/02/17/us-government-sets-forth-zero-trust-architecture-strategy-and-requirements/">こちら</a> をご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 5 月 4 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された &lt;a href=&quot;https://tech</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Entra (Azure AD) 向け Windows Local Administrator Password Solution のご紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/</id>
    <published>2023-05-04T22:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.767Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 4 月 21 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/introducing-windows-local-administrator-password-solution-with/ba-p/1942487">Introducing Windows Local Administrator Password Solution with Microsoft Entra (Azure AD)</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>本日、皆様に素晴らしいニュースをお伝えしたいと思います！包括的なセキュリティソリューションを提供するという私たちのビジョンの一環として、弊社では Windows および Microsoft Intune チームと協力して、<strong>Windows Local Administrator Password Solution (LAPS) for Azure AD</strong> (Microsoft Entra の一部）の <strong>パブリック プレビュー</strong> をリリースしました。</p><p>今回は、このリリースのプロダクト マネージャーの一人である Sandeep Deo に、これらのアップデートの概要と、Microsoft Entra (Azure AD) で Windows LAPS を使い始める方法について説明してもらいます。Sandeep のブログ記事は以下からご覧いただけます。</p><p>Alex Simons (@Alex_A_Simons)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p><hr><p>皆さん、こんにちは。</p><p>今回、LAPS のアップデートと、Microsoft Entra (Azure AD) および Microsoft Intune を使用して、Azure AD に参加する Windows デバイスのセキュリティを確保する方法をご紹介します。</p><p>すべての Windows デバイスにはローカル管理者アカウントが組み込まれており、PtH (Pass-the-Hash) 攻撃や横断的なトラバーサル攻撃を軽減するためにセキュリティを確保する必要があります。多くのお客様は、ドメイン参加した Windows マシンのローカル管理者のパスワード管理に、スタンドアロン型のオンプレミス製品である LAPS を使用されていると存じます。しかし、Azure AD に直接参加するよう Windows 環境を刷新するにあたり、同様に LAPS のサポートが必要だというフィードバックを多くいただいておりました。</p><p>本日、弊社では Azure AD 参加したデバイスとハイブリッド Azure AD 参加したデバイスの両方で、Windows LAPS を利用できるようにします。さらに、<a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-4-%E6%9C%88-11-%E6%97%A5-kb5025221-os-%E3%83%93%E3%83%AB%E3%83%89-19042-2846-19044-2846-19045-2846-b00c3356-baac-4a41-8342-7f97ec83445a">Windows 10 20H2 以降、Windows 11 21H2 以降</a>、および <a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-4-%E6%9C%88-11-%E6%97%A5-kb5025239-os-%E3%83%93%E3%83%AB%E3%83%89-22621-1555-5eaaaf42-bc4d-4881-8d38-97e0082a6982">Windows Server 2019 以降</a> で、<a href="https://support.microsoft.com/ja-jp/topic/2023-%E5%B9%B4-4-%E6%9C%88-11-%E6%97%A5-kb5025230-os-%E3%83%93%E3%83%AB%E3%83%89-20348-1668-28a5446e-6389-4a5b-ae3f-e942a604f2d3">最新のセキュリティ更新プログラム (2023 年 4 月 11 日リリース) を使用する Windows</a> に Windows LAPS が既定で組み込まれるようになりました。</p><p>このプレビュー内で利用可能となった重要な機能は以下のとおりです:</p><ul><li>Windows LAPS を有効にするには、<strong>テナント全体のポリシーとクライアント側のポリシーを使用し、ローカル管理者パスワードは Azure AD にバックアップされる</strong>。</li><li><strong>Microsoft Intune ポータルでクライアントサイド ポリシー</strong> を設定し、<strong>ローカル管理者のパスワード管理のために、アカウント名、パスワードの有効期限、長さ、複雑さ、手動パスワード リセットなどを設定する</strong>。</li><li><strong>Microsoft Entra/Microsoft Intune ポータルまたは Microsoft Graph API/PowerShell を使用して保存されたパスワード</strong> を復元する。</li><li><strong>Microsoft Entra ポータルまたは Microsoft Graph API/PowerShell</strong> を使用して、すべての LAPS 対応デバイスを確認する。</li><li><strong>パスワードの回復を承認するには、カスタム ロールと管理単位で、Azure AD ロールベース アクセス コントロール (RBAC) ポリシー</strong> を作成する。</li><li><strong>Microsoft Entra ポータルまたは Microsoft Graph API/PowerShell を使用して監査ログ</strong> を表示し、<strong>パスワードの更新と回復のイベントを監視</strong> します。</li></ul><p><strong>パスワード回復の権限を持つディレクトリ ロールには条件付きアクセスポリシーを構成するすること</strong> がお勧めです。</p><p>これらのシナリオを実現するための簡単な手順を以下に説明していきます。</p><h2 id="LAPS-のセットアップ"><a href="#LAPS-のセットアップ" class="headerlink" title="LAPS のセットアップ"></a>LAPS のセットアップ</h2><p><strong>Azure AD のデバイス</strong> メニューで <strong>デバイスの設定を選択</strong> し、<strong>LAPS の設定で はい を選択して保存をクリック</strong> します。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic01.png"></p><p><strong>Microsoft Intune エンドポイント セキュリティ</strong> のメニューで、<strong>アカウント保護</strong> を選択し、<strong>ポリシーの作成</strong> を選択して、Windows 10 以降のWindows LAPS プロファイルを作成します。プロファイルの作成中、<strong>Azure AD をバックアップ先のディレクトリ</strong> として選択します。LAPS の他のクライアント ポリシーを構成することも可能です。<strong>割り当て</strong> に Azure AD のグループを指定して、最後に <strong>確認及び作成</strong> を選択します。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic02.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic03.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic04.png"></p><div class="alert is-info"><p class="alert-title">Note</p><p>本記事執筆時点では、上記スクリーンショットのとおり、(Windows Insider のみ) という文言が一部のポータル上に表示されております。しかし、本記事のとおり Windows LAPS はパブリック プレビュー状態となりますので、Windows Insider は必要ありません。最新の Windows Update を適用した通常バージョンの Windows にて Windows LAPS をご利用いただけます。</p></div><h2 id="ローカル管理者パスワードの復旧"><a href="#ローカル管理者パスワードの復旧" class="headerlink" title="ローカル管理者パスワードの復旧"></a>ローカル管理者パスワードの復旧</h2><p><strong>Azure AD のデバイスの概要</strong> ページで、<strong>ローカル管理者パスワードの回復</strong> を選択します。これにより、LAPS が有効なすべてのデバイスが列挙され、デバイス名の横にある <strong>ローカル管理者パスワードの表示</strong> をクリックすると、パスワードを確認できます。また、デバイス名を入力してフィルタリングし、列挙されたリストから <strong>ローカル管理者パスワードの表示</strong> を選択するという方法もあります。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic05.png"></p><p>また、ローカル管理者パスワードの回復を承認するにあたっては、Azure AD で <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/custom-create">カスタム ロール</a> または <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/administrative-units">管理単位</a> を作成することもできます。</p><h2 id="ローカル管理者パスワードを手動でリセットする"><a href="#ローカル管理者パスワードを手動でリセットする" class="headerlink" title="ローカル管理者パスワードを手動でリセットする"></a>ローカル管理者パスワードを手動でリセットする</h2><p><strong>Microsoft Intune エンドポイント セキュリティのすべてのデバイス</strong> ページで、<strong>検索</strong> フィールドにデバイス名を入力します。次に、特定のデバイスの概要ページで、デバイスへのアクションとして「ローカル管理者パスワードのローテーション」を選択します。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic06.png"></p><h2 id="ローカル管理者のパスワードの更新と回復を監査する"><a href="#ローカル管理者のパスワードの更新と回復を監査する" class="headerlink" title="ローカル管理者のパスワードの更新と回復を監査する"></a>ローカル管理者のパスワードの更新と回復を監査する</h2><p><strong>Azure AD デバイスの概要</strong> ページで、<strong>監査ログ</strong> を選び、<strong>アクティビティのフィルター</strong> を使用して <strong>Update device local administrator password</strong> または <strong>Recover device local administrator password</strong> を検索し、監査イベントを表示します。</p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic07.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic08.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic09.png"></p><p><img src="/blog/azure-active-directory/introducing-windows-local-administrator-password-solution-with/pic10.png"></p><p>個々の監査イベントをクリックすると、アクティビティ、ターゲット、変更されたプロパティなどの詳細を確認することができます。</p><p>この新しいセキュリティ機能を利用するために、Microsoft Entra (Azure AD) および Microsoft Intune で Windows LAPS を導入することを強くお勧めします。これにより、これらの機密性の高いパスワードの安全性が格段に向上します。Windows LAPS for Microsoft Entra (Azure AD) の利用を開始するには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/devices/howto-manage-local-admin-passwords">ここにアクセス</a> ください。</p><p>いつものように皆様のフィードバックと提案お待ちしております。<a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Microsoft Entra (Azure AD) のフォーラム</a> でコメントを共有ください。皆様からのご連絡をお待ちしております。</p><p>Sandeep Deo (@MsftSandeep)<br>Principal Product Manager<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 21 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された &lt;a href=&quot;https://tec</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD のセキュリティを強化するために今すぐできること (Quick Win)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/quick-wins-to-strengthen-your-azure-ad-security/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/quick-wins-to-strengthen-your-azure-ad-security/</id>
    <published>2023-05-01T23:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.931Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 五十嵐 です。</p><p>本記事は、2023 年 4 月 3 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/quick-wins-to-strengthen-your-azure-ad-security/ba-p/3767905">Quick Wins to Strengthen Your Azure AD Security</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>どの組織も、インフラの安全性と信頼性を高めるために、攻撃の対象範囲を縮小するべく取り組んでいらっしゃると存じます。</p><p><a href="https://www.microsoft.com/en-us/security/blog/2021/06/09/crsp-the-emergency-team-fighting-cyber-attacks-beside-customers/">Microsoft Global Compromise Recovery Security Practice (CRSP)</a> のチーム メンバーとして、セキュリティの態勢を改善し、侵入を平均よりも難しくすることで、低スキルの攻撃者がすぐに攻撃を諦めて次のターゲットに移る事例をこれまで数多く見てきました。</p><p>サイバー セキュリティの環境が変化する中、<a href="https://learn.microsoft.com/ja-jp/security/ciso-workshop/ciso-workshop-module-3?view=o365-worldwide#part-6-build-an-identity-perimeter-1357">ID は新しいセキュリティ境界</a> であり、侵害されたユーザーが壊滅的なサイバー攻撃のきっかけであったという話をよく聞きます。</p><p>ID について語るとき、Microsoft Entra 製品群の一部である Azure Active Directory (Azure AD) は、ほとんどの組織で利用されている重要な ID システムであり、アプリケーションやリソースなどに対するユーザーの認証と認可のための中心点として機能します。 これは、組織のゼロ トラスト戦略の中核をなすものです。</p><p>このブログでは、Azure AD の攻撃範囲を縮小するための <strong>Quick Win</strong> (すぐに実施できる対応) をいくつかご紹介します。技術的な観点からすると、これらの対応はすぐに実行できるもので、本番で展開するためのテストも最小限のものとなります。</p><h2 id="1-作業用とクラウド管理用のアカウントの分離"><a href="#1-作業用とクラウド管理用のアカウントの分離" class="headerlink" title="1. 作業用とクラウド管理用のアカウントの分離"></a>1. 作業用とクラウド管理用のアカウントの分離</h2><p>ID は、新しいセキュリティの境界線です。もし 1 つの鍵で組織に入れてしまうのであれば、攻撃者は簡単にその組織を制圧できてしまいます。普段の業務用と管理用に同じアカウントを使用すると、組織のセキュリティが危険にさらされます。このことを念頭に置いて、普段の業務用と管理用のアカウントを分離する必要があります。普段の業務に使用される ID から特権を剥奪し、クラウドの管理用アカウントは個別に作成したうえで、その ID にも極力特権を与えないようにしましょう。</p><h2 id="2-緊急アクセス用アカウントの安全な管理"><a href="#2-緊急アクセス用アカウントの安全な管理" class="headerlink" title="2. 緊急アクセス用アカウントの安全な管理"></a>2. 緊急アクセス用アカウントの安全な管理</h2><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access">緊急アクセス用アカウント</a> (<strong>Break-Glass アカウント</strong>) は高い権限を持ち、他の管理アカウントが使用できないときという緊急のシナリオの時だけ利用されます。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access#create-emergency-access-accounts">ベスト プラクティス</a> に従って少なくとも 2 つ緊急アクセス用アカウントを作成し、それらのアカウントはどのユーザーとも紐づかないようにしてください。</p><p>緊急アクセス用アカウントの認証情報は安全に保存され、有効期限がなく、通常の業務に使用されることはありません。少なくとも 1 つの緊急アクセス用アカウントは、電話ベースの多要素認証 (MFA) を使用しないようにし、条件付きアクセスにおいても管理者/ユーザーによるクラウド アプリへのアクセスを制限/許可するポリシーから除外するよう対応ください。Azure AD の監査ログを使用して、サインインとすべての監査アクティビティを <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access#monitor-sign-in-and-audit-logs">監視する</a> 必要もあります。</p><h2 id="3-特権アカウントの多要素認証"><a href="#3-特権アカウントの多要素認証" class="headerlink" title="3. 特権アカウントの多要素認証"></a>3. 特権アカウントの多要素認証</h2><p>マイクロソフトでは、すべてのユーザーに対して MFA を有効にすることを推奨しています。<a href="https://www.microsoft.com/en-us/security/blog/2019/08/20/one-simple-action-you-can-take-to-prevent-99-9-percent-of-account-attacks/">MFA はアカウント侵害攻撃の 99.9% 以上をブロックすることができます</a>。MFA をすべてのユーザーで有効にする際には、レガシー認証プロトコルに与える影響を徹底的にテストし、最終的にブロックする必要があります。したがって、こちらは中期から長期のセキュリティ強化目標と考えることができるでしょう。</p><p>中長期の取り組みが進む中で、クラウド上に管理アカウントを別途用意することになると思われます。当面のステップとして、まず、高い権限を持つすべてのユーザーに対して MFA を適用することから始めましょう。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/plan-conditional-access">条件付きアクセス ポリシー</a> を使用して、これらのユーザーに対して MFA を展開することが可能です。テナントに入れなくなってしまった場合の緊急事態に備えて、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-emergency-access#exclude-at-least-one-account-from-phone-based-multi-factor-authentication">緊急アクセス用管理者アカウントがポリシーから除外されていること</a> を確認ください。MFA と条件付きアクセス ポリシーの使用は、攻撃者の時間とコストを増加させ、最終的に攻撃者の注目をそらせることにつながります。</p><h2 id="4-条件付きアクセスで-SaaS-Software-as-a-Service-アプリケーションを管理するためのゼロ-トラスト原則"><a href="#4-条件付きアクセスで-SaaS-Software-as-a-Service-アプリケーションを管理するためのゼロ-トラスト原則" class="headerlink" title="4. 条件付きアクセスで SaaS (Software-as-a-Service) アプリケーションを管理するためのゼロ トラスト原則"></a>4. 条件付きアクセスで SaaS (Software-as-a-Service) アプリケーションを管理するためのゼロ トラスト原則</h2><p><a href="https://www.microsoft.com/en-us/security/blog/2020/04/30/zero-trust-deployment-guide-azure-active-directory/">ゼロ トラストのコンセプト</a> は、全体的なセキュリティを強化するのに役立ちます。リソースを保護し、最新の認証の原則に従うことで、組織はリソースのセキュリティをより確実に確保できます。</p><p>常に検証を行い、最小限の権限でアクセスし、侵入を想定することが、<a href="https://www.microsoft.com/ja-jp/security/business/zero-trust">ゼロ トラスト</a> のすべてです。企業ネットワークとカフェの公衆インターネットという単純な例で考えてみましょう。 <a href="https://www.microsoft.com/en-us/security/blog/2019/10/23/perimeter-based-network-defense-transform-zero-trust-model/">従来のアプローチでは、企業ネットワークはネットワークの面で多くの投資がなされることで安全な状態にある</a> とされていました。しかし、新しいゼロ トラストのアプローチでは、ID、場所、デバイス準拠など、利用可能なすべてのデータポイントを明示的に検証することが必要です。</p><p>取り急ぎの対応として、すでに Azure AD と統合されているアプリで試験運用を開始することをお勧めします。条件付きアクセス ポリシーとゼロ トラスト原則に基づく強固なアクセス モデルの構築を開始するためには、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/conditional-access/plan-conditional-access">展開ガイダンス</a> と <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/resilience-overview">ベスト プラクティス</a> を確認ください。</p><h2 id="5-アプリケーションへの-Azure-AD-SSO-を評価"><a href="#5-アプリケーションへの-Azure-AD-SSO-を評価" class="headerlink" title="5. アプリケーションへの Azure AD SSO を評価"></a>5. <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/five-steps-to-full-application-integration-with-azure-ad">アプリケーションへの Azure AD SSO</a> を評価</h2><p>SSO (<strong>シングル サインオン</strong>) は、ユーザーに利便性と安全性をもたらします。ユーザーが頻繁に認証情報を求められると、毎日何度も認証情報を入力することになり、ユーザーは詳細を確認せずに画面に認証情報を入力してしまうことになります。さらに、すべてのアプリケーションに認証情報の痕跡が残ることになります。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/active-directory-faq#azure-ad----------------------------------------------------">Azure AD は最新の認証プロトコルと強力な認証機構をサポートしています</a>。Cisco のようなデバイスを Azure AD と統合して認証することも可能です。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/saas-apps/tutorial-list">Azure AD ギャラリーには、何千ものビジネス生産性アプリケーションがあらかじめ統合されています</a>。まず最初のステップとして、組織で導入される新しいアプリケーションを <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/plan-an-application-integration">統合する</a> ことを検討ください。加えて、ID ライフサイクルの管理向上のために、アプリケーションへの Azure AD ユーザー プロビジョニングを利用しましょう。  </p><p>次に取り組む作業としては、クレームに基づいて動作しているアプリケーションを確認することです。さらに、複数の ID プロバイダーをサポートするアプリケーションがないかも確認できれば、それを SSO のテストと展開の最初の候補とすることもできます。</p><h2 id="6-Azure-AD-で-ID-ガバナンスを有効化"><a href="#6-Azure-AD-で-ID-ガバナンスを有効化" class="headerlink" title="6. Azure AD で ID ガバナンスを有効化"></a>6. Azure AD で ID ガバナンスを有効化</h2><p>ID ガバナンスは、組織のセキュリティのバランスをとる確立された方法であり、ID のライフサイクルを標準化された方法で管理することでそれを実現します。ID ガバナンスを活用すると、「誰が何にアクセスできるのか」を体系的に定義できます。このソリューションを活用しても、組織の生産性に悪影響を及ぼすことはありません。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-overview">エンタイトルメント管理</a> では、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-create">アクセス パッケージ</a> というものを作成でき、ユーザーが新しいプロジェクト/チームに参加する際に必要となるグループ、アプリ、チーム、SharePoint サイトへのアクセスを、手動で付与するのでなく、ユーザーが自らリクエストできるようになります。エンタイトルメント管理は社外とのコラボレーション シナリオもサポートしておりますので、詳細は <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-external-users">B2B シナリオのためのエンタイトルメント管理</a> を参照ください。</p><p>さらに、過剰な権限は、セキュリティを脆弱にします。組織のリソースへのアクセス権をレビューして維持や剥奪を判断したい場合は、Azure AD の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/governance/access-reviews-overview">アクセス レビュー</a> をぜひ活用ください。</p><p>今後新たに付与するアクセス権に対してこの機能の評価を始め、徐々にすべてのビジネスにおいてアクセス パッケージを使用するように移行することがおすすめです。</p><h2 id="7-Azure-AD-Identity-Protection-によるユーザーとサインインのリスク検出"><a href="#7-Azure-AD-Identity-Protection-によるユーザーとサインインのリスク検出" class="headerlink" title="7. Azure AD Identity Protection によるユーザーとサインインのリスク検出"></a>7. Azure AD Identity Protection によるユーザーとサインインのリスク検出</h2><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/overview-identity-protection">Identity Protection</a> は、Azure AD、Microsoft アカウント、および XBOX から収集したインテリジェンスを活用する Azure AD の強力な機能です。Identity Protection がサインイン要求を処理すると、お客様ではその結果を使用してアクセスを許可するか拒否するかなどの決定を下すことができます。</p><p>Identity Protection はユーザーやサインインのリスクを判断し、組織が適切な対処を実施できるよう支援します。<br>例えば、ユーザーが匿名 IP アドレスから接続していることが判明したときは、サインイン リスクが中または高の場合に MFA を強制したり、ユーザーの資格情報がダーク ウェブに流出していると Identity Protection が判断したときは、ユーザーにパスワードを変更するよう強制したりすることができます。</p><p>お客様においては、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-simulate-risk">リスク検出をシミュレートする</a> ことで、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies#enable-policies">レポート専用モード</a> で Identity Protection の評価を開始できます。 Identity Protection により検出されたリスクを監視し、その詳細を理解するという意味では、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/howto-use-azure-monitor-workbooks#identity-protection-risk-analysis">Identity Protection Risk Analysis ワークブック</a> が最適な方法です。</p><h2 id="8-Azure-RBAC-による最小特権の適用"><a href="#8-Azure-RBAC-による最小特権の適用" class="headerlink" title="8. Azure RBAC による最小特権の適用"></a>8. Azure RBAC による最小特権の適用</h2><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/roles/security-planning">ロールのセキュリティ</a> をどのように確保するかは、どの組織にとっても重要です。特権 ID が攻撃の手段として使われることは、セキュリティ侵害のシナリオでよく見られることです。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-configure">特権 ID 管理 (PIM)</a> を用いることで、時間制限のあるアクセスを実現でき、特権ロールを有効にするためにさらに承認手続きを追加することでさらにセキュリティを向上させることができます。例えば「ドメイン名の管理者」ロールは、Azure AD にドメインを登録する際に必要な特権ですが、使用頻度が非常にまれな特権です。ユーザーはこの特権を 24 時間 365 日保持する必要はありません。代わりに、必要なときに有効化することでその業務を行うことができますし、ポリシーに基づいて一定時間後にユーザーは特権を剥奪されます。</p><p>PIM は、ロールを有効化する際に、MFA やロールのアクティブ化の正当性の要求、ロールが有効になったときの管理者への通知、アクセス レビューの有効化、アクティビティの監査など、追加の制御や情報を要求できます。さらに、PIM は Microsoft 365 だけでなく、Azure リソースにも使用することができます。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-deployment-plan">PIM の導入</a> は、組織が有効な割り当てと資格ある割り当ての両方を評価する際の重要な最初のステップです。例えば、緊急管理者アカウントはグローバル管理者権限を恒久的に保持すべきですが、その他の役割は必要なときに得られるようにすべきです。</p><h2 id="9-パスワード保護の機能で弱いパスワードを撤廃"><a href="#9-パスワード保護の機能で弱いパスワードを撤廃" class="headerlink" title="9. パスワード保護の機能で弱いパスワードを撤廃"></a>9. パスワード保護の機能で弱いパスワードを撤廃</h2><p>“Summer2022!” は、大文字、数字、特殊文字からなるパスワードで、通常の最小文字数要件を満たしているように見えます。しかしながら、このようなパスワードは辞書ベースのパスワード攻撃に脆弱です。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-password-ban-bad-on-premises-deploy">Azure AD のパスワード保護</a> は、組織がこのようなパスワードの使用を阻止できる素晴らしい機能です。パスワード保護では、グローバルおよびカスタムの禁止パスワード リストがご利用いただけます。</p><p>この機能は、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/authentication/howto-password-ban-bad-on-premises-deploy#deployment-requirements">軽量エージェントを介してドメイン コントローラー上で</a> 使用することもできます。セットアップは簡単で、監査モードもサポートしているため、管理者は組織内の安全でないパスワードの使用状況を把握し、パスワード ポリシーやユーザーへのガイダンスへの改善を計画することができます。</p><h2 id="10-ユーザー同意の制限"><a href="#10-ユーザー同意の制限" class="headerlink" title="10. ユーザー同意の制限"></a>10. ユーザー同意の制限</h2><p>ユーザーは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/user-admin-consent-overview">同意</a> の機能を使用して、保護されたリソースにアクセスするためのアクセス許可をアプリケーションに付与することができます。例えば、サポート担当者が問題の説明を電子メールで受け取ると、それに基づいてインシデントを発行するチケット システムを例にとって説明しましょう。これがうまく動くためには、チケット システムはユーザーのメールボックスを読み取る権限が必要です。既定では、ユーザーがアプリケーションに同意しない限り、Azure AD は要求されたアクセス許可をアプリケーションに付与しません。</p><p>お客様は管理者として、ユーザーが同意できなくする (同意機能を無効化する)、確認済みの発行元のアプリケーションにのみ同意を許可する、または任意のアプリケーションにユーザーの同意を許可するのいずれかを選択できます。マイクロソフトは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/configure-user-consent?tabs=azure-portal&pivots=portal">ユーザーの同意を確認済みの発行元のアプリケーションのみに制限し</a>、同意できるアクセス許可を管理者が選択したものに制限することを推奨しています。</p><p>お客様におかれましては、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/develop/application-consent-experience">同意のフレームワークとアプリケーションの同意エクスペリエンス</a> について把握するべく、まずは管理者の <a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/manage-consent-requests">同意の要求について評価</a> を開始することをお勧めします。管理者にて同意を安全に行う必要性が理解できたら、ユーザーの啓発に加えて、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/configure-admin-consent-workflow">管理者の同意</a> が必要なフローについても確認いただき、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/manage-apps/manage-consent-requests#evaluate-a-request-for-tenant-wide-admin-consent">テナント全体の管理者の同意要求を評価する</a> などの取り組みも実施いただければと思います。</p><h2 id="11-Azure-AD-と接続されたシステムの継続的なモニタリング"><a href="#11-Azure-AD-と接続されたシステムの継続的なモニタリング" class="headerlink" title="11. Azure AD と接続されたシステムの継続的なモニタリング"></a>11. Azure AD と接続されたシステムの継続的なモニタリング</h2><p>ID システムはインフラのバックボーンであるため、Azure AD とそれに付随する Azure AD Connect や AD Federation Services (AD FS) のようなシステムの監視業務はすべてのリソースにとって最も重要であり、継続的なプロセスです。</p><p>ユーザーのサインインを監視するための Identity Protection の使用については前述のとおりです。追加のステップとして、<a href="https://learn.microsoft.com/ja-jp/defender-cloud-apps/tutorial-ueba#enable-identity-protection">Identity Protection を Defender for Cloud Apps と統合する</a> ことも可能です。統合はすぐに行え、画面上のボタンを有効にするだけです。これにより、Azure AD Identity Protection は Defender for Cloud Apps にシグナルを送信し、Defender for Cloud Apps は情報を処理して <strong>セキュリティ運用チーム</strong> 向けにアラートを生成するようになります。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/whatis-azure-ad-connect#what-is-azure-ad-connect-health">Azure AD Connect Health</a> は、監視のためのもう一つの重要な機能です。<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-health-alert-catalog#alerts-for-active-directory-federation-services">重大な AD FS システムの問題</a>、<a href="https://learn.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-health-adfs#performance-monitoring-for-ad-fs">パフォーマンスと接続性</a> など、重要な健全性のアラートを提供することで、ハイブリッド ID 環境におけるオンプレミス ID システムの信頼性を確保できるようにします。さらに、AD FS サーバーからのサインイン失敗やロックアウトの傾向も提示が可能です。 軽量なエージェントで動作するため、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/hybrid/whatis-azure-ad-connect#why-use-azure-ad-connect-health">導入</a> は非常に簡単です。</p><p>加えて、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory/fundamentals/identity-secure-score">ID セキュリティ スコア</a> の推奨事項についても対応ください。ID セキュリティ スコア は、Azure AD の全体的なセキュリティの状態を表示します。片手間で評価しすぐに改善できるような、影響度が低く実装コストが低い項目も中にはあります。定期的に ID セキュリティ スコアをレビューすることで、現在のセキュリティの状態についての見識を得るとともに、その内容を評価して修復するようご計画ください。</p><p>セキュリティは組織にとって最優先事項であり、<a href="https://www.microsoft.com/en-us/security/business/security-insider/reports/cyber-signals-issue-1-identity/?culture=en-in&country=IN">ID は新たな戦場となります</a>。まず、貴社にてセキュリティを担当するチームがございましたら、このブログに記載されているポイントに従って、Azure AD の構成と実際の状況を比較し、問題個所を特定いただければ幸いです。次のステップは、対応の優先順位を決めることです。項目によっては展開に多少の計画が必要かもしれませんが、「作業用とクラウド管理用のアカウントの分離」「緊急アクセス用アカウントの安全な管理」「Azure RBAC による最小特権の適用」は、セキュリティへの影響が大きく、すぐに実施できる項目であるため、重要度が最も高い項目となり得ます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 五十嵐 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 3 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD の Go Local データ保存機能が日本でパブリック プレビューを開始</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-go-local-data-residency-goes-public-preview-in-japan/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-go-local-data-residency-goes-public-preview-in-japan/</id>
    <published>2023-05-01T22:00:00.000Z</published>
    <updated>2023-06-19T07:52:31.443Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2023 年 4 月 24 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/azure-ad-go-local-data-residency-goes-public-preview-in-japan/ba-p/3751028">Azure AD Go Local Data Residency Goes Public Preview in Japan</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p><a href="https://www.microsoft.com/ja-jp/security/business/microsoft-entra">Microsoft Entra</a> の一部である <a href="https://azure.microsoft.com/ja-jp/services/active-directory/external-identities/b2c/">Azure Active Directory (Azure AD) B2C</a> を用いることで、世界中の企業や個人は主なセキュリティおよびプライバシー要件に対応でき、これまで以上に多くのことを達成できるようになります。この要件には、データの保存場所についても言えるはずです。本日、Go Local のデータ保存機能 (データを特定の地域に保存する機能) が日本向けにパブリック プレビューとなりましたことをお知らせします。</p><p>Azure AD では、データの保存場所はテナント作成時に選択した国/地域によって決定されます。Go Local の追加機能は、Azure AD Premium P1 および P2 のお客様が、ディレクトリのデータを特定の地域に保存するよう指定できる機能です。</p><p>本日、特定地域へのデータ保持を利用可能な地域の一覧に日本が追加されました。この Go-Local の追加機能を有効にするだけで、Azure AD B2C のデータが日本に保存されるようになります。</p><p>このアップデートにより、日本のお客様のデジタル トランスフォーメーションをさらに加速できることとなります。弊社は、信頼できるクラウドの原則とコンプライアンスにおけるリーダーシップに引き続き注力しております。これにより、世界中のすべてのお客様に、ご自身のアプリケーションがコンプライアンスを達成できるよう必要なセキュリティ基盤を提供してまいります。 </p><p>どの地域においても Go Local は有料の追加機能であり、月間アクティブ ユーザーあたり 0.02 ドルの費用がかかります。</p><p>日本で Go Local の利用を開始するには、Azure REST API または Azure ポータルを使用して新しい Azure AD B2C テナントを作成する際に、GoLocal アドオンを有効に設定ください。</p><p>詳しくは、<a href="https://learn.microsoft.com/ja-jp/azure/active-directory-b2c/data-residency#data-residency">利用可能なリージョンとデータの保存場所</a> をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2023 年 4 月 24 日に米国の Microsoft Entra (Azure AD) の Discussion で公開された &lt;a href=&quot;https://tec</summary>
      
    
    
    
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Azure AD B2C" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2C/"/>
    
  </entry>
  
</feed>
